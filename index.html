<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nova</title>
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  
  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0a0e1a;
      --bg-gradient: linear-gradient(135deg, #0a0e1a 0%, #1a1f3a 100%);
      --panel: #131729;
      --panel2: #0f1424;
      --text: #f0f4ff;
      --muted: #8b9dc3;
      --border: rgba(139, 157, 195, 0.15);
      --hover: rgba(91, 141, 239, 0.1);
      --active: rgba(91, 141, 239, 0.2);
      --accent: #5b8def;
      --accent-glow: rgba(91, 141, 239, 0.4);
      --online: #00ff88;
      --offline: #555;
      --alert: #ff4444;
      --success: #00ff88;
      --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --coin-gold: #ffd700;
    }

    /* Light Mode Variables */
    body.light-mode {
      --bg: #f5f7fa;
      --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #e8ecf1 100%);
      --panel: #ffffff;
      --panel2: #f8f9fb;
      --text: #1a1f36;
      --muted: #4a5568;
      --border: rgba(74, 85, 104, 0.2);
      --hover: rgba(91, 141, 239, 0.1);
      --active: rgba(91, 141, 239, 0.15);
      --accent: #3b7dd8;
      --accent-glow: rgba(59, 125, 216, 0.4);
      --card-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      overflow: hidden;
      position: relative;
      transition: background 0.3s ease, color 0.3s ease;
    }

    /* Performance Mode */
    body.performance-mode .bg-container * {
      animation: none !important;
      transition: none !important;
    }

    body.performance-mode .particle,
    body.performance-mode .orb,
    body.performance-mode .gradient-wave,
    body.performance-mode .scanline {
      display: none !important;
    }

    /* Enhanced Animated Background */
    .bg-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 0;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .custom-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      display: none;
      z-index: 1;
    }

    .custom-bg.active {
      display: block;
    }

    /* Animated gradient waves */
    .gradient-wave {
      position: absolute;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 20% 50%, rgba(91, 141, 239, 0.15) 0%, transparent 50%),
                  radial-gradient(circle at 80% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%),
                  radial-gradient(circle at 40% 20%, rgba(147, 51, 234, 0.1) 0%, transparent 50%);
      animation: waveMove 20s ease-in-out infinite;
    }

    @keyframes waveMove {
      0%, 100% { 
        transform: translate(-25%, -25%) rotate(0deg);
        opacity: 0.6;
      }
      33% { 
        transform: translate(-30%, -20%) rotate(120deg);
        opacity: 0.8;
      }
      66% { 
        transform: translate(-20%, -30%) rotate(240deg);
        opacity: 0.7;
      }
    }

    /* Advanced Floating orbs with trails */
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(40px);
      animation: floatOrb 15s ease-in-out infinite;
      opacity: 0.3;
    }

    .orb::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      filter: blur(20px);
      opacity: 0.5;
    }

    .orb-1 {
      width: 400px;
      height: 400px;
      background: linear-gradient(135deg, rgba(91, 141, 239, 0.4), rgba(147, 51, 234, 0.3));
      top: 10%;
      left: 10%;
      animation-delay: 0s;
      animation-duration: 25s;
    }

    .orb-2 {
      width: 500px;
      height: 500px;
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.3), rgba(91, 141, 239, 0.3));
      bottom: 10%;
      right: 10%;
      animation-delay: -8s;
      animation-duration: 30s;
    }

    .orb-3 {
      width: 300px;
      height: 300px;
      background: linear-gradient(135deg, rgba(147, 51, 234, 0.3), rgba(0, 255, 136, 0.2));
      top: 50%;
      left: 50%;
      animation-delay: -15s;
      animation-duration: 22s;
    }

    @keyframes floatOrb {
      0%, 100% {
        transform: translate(0, 0) scale(1) rotate(0deg);
      }
      25% {
        transform: translate(150px, -150px) scale(1.2) rotate(90deg);
      }
      50% {
        transform: translate(-150px, 150px) scale(0.9) rotate(180deg);
      }
      75% {
        transform: translate(100px, 100px) scale(1.1) rotate(270deg);
      }
    }

    /* Enhanced particle system */
    .particles {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .particle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: rgba(91, 141, 239, 0.6);
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(91, 141, 239, 0.8);
      animation: particleFloat linear infinite;
    }

    @keyframes particleFloat {
      0% {
        transform: translateY(100vh) translateX(0) scale(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) translateX(var(--drift)) scale(1);
        opacity: 0;
      }
    }

    /* Advanced grid pattern overlay with pulse */
    .grid-overlay {
      position: absolute;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(91, 141, 239, 0.05) 2px, transparent 2px),
        linear-gradient(90deg, rgba(91, 141, 239, 0.05) 2px, transparent 2px),
        linear-gradient(rgba(91, 141, 239, 0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(91, 141, 239, 0.02) 1px, transparent 1px);
      background-size: 100px 100px, 100px 100px, 20px 20px, 20px 20px;
      animation: gridPulse 8s ease-in-out infinite;
      background-position: 0 0, 0 0, 0 0, 0 0;
    }

    @keyframes gridPulse {
      0%, 100% {
        opacity: 0.3;
        transform: perspective(500px) rotateX(0deg);
      }
      50% {
        opacity: 0.6;
        transform: perspective(500px) rotateX(2deg);
      }
    }

    /* Animated scanlines */
    .scanline {
      position: absolute;
      width: 100%;
      height: 3px;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(91, 141, 239, 0.5) 50%, 
        transparent 100%);
      animation: scanlineMove 4s linear infinite;
      box-shadow: 0 0 15px rgba(91, 141, 239, 0.7);
    }

    @keyframes scanlineMove {
      0% {
        top: -3px;
      }
      100% {
        top: 100%;
      }
    }

    /* Energy rings */
    .energy-ring {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100px;
      height: 100px;
      border: 2px solid rgba(91, 141, 239, 0.3);
      border-radius: 50%;
      animation: energyExpand 6s ease-out infinite;
    }

    .energy-ring:nth-child(2) {
      animation-delay: 2s;
    }

    .energy-ring:nth-child(3) {
      animation-delay: 4s;
    }

    @keyframes energyExpand {
      0% {
        width: 100px;
        height: 100px;
        opacity: 1;
        transform: translate(-50%, -50%);
      }
      100% {
        width: 1000px;
        height: 1000px;
        opacity: 0;
        transform: translate(-50%, -50%);
      }
    }

    .app {
      display: grid;
      grid-template-rows: 64px 1fr;
      grid-template-columns: 280px 1fr;
      height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Grid View Mode */
    body.grid-mode .app {
      grid-template-columns: 280px 1fr;
    }

    body.grid-mode .scroller {
      display: grid !important;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
      overflow-y: auto;
      overflow-x: hidden;
    }

    body.grid-mode .game,
    body.grid-mode .movie,
    body.grid-mode .tvshow,
    body.grid-mode .shop-item {
      width: 100%;
    }

    header {
      grid-column: 1/-1;
      display: flex;
      align-items: center;
      padding: 0 24px;
      border-bottom: 1px solid var(--border);
      background: rgba(19, 23, 41, 0.8);
      backdrop-filter: blur(20px);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
      gap: 20px;
    }

    body.light-mode header {
      background: rgba(255, 255, 255, 0.9);
    }

    .brand {
      font-weight: 800;
      font-size: 22px;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #5b8def 0%, #00ff88 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: brandGlow 3s ease-in-out infinite;
    }

    @keyframes brandGlow {
      0%, 100% { filter: drop-shadow(0 0 8px rgba(91, 141, 239, 0.4)); }
      50% { filter: drop-shadow(0 0 16px rgba(91, 141, 239, 0.6)); }
    }

    .header-info {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 13px;
      font-weight: 600;
    }

    .info-item {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 6px 12px;
      background: rgba(91, 141, 239, 0.1);
      border: 1px solid var(--border);
      border-radius: 8px;
      min-width: 100px;
    }

    .info-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--muted);
      margin-bottom: 2px;
    }

    .info-value {
      font-size: 13px;
      font-weight: 700;
      color: var(--text);
    }

    #current-time {
      font-family: 'Courier New', monospace;
      letter-spacing: 0.05em;
    }

    .coin-display {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(255, 215, 0, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .coin-display:hover {
      background: rgba(255, 215, 0, 0.2);
      box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
    }

    .coin-icon {
      width: 24px;
      height: 24px;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.4);
    }

    aside {
      border-right: 1px solid var(--border);
      background: rgba(19, 23, 41, 0.6);
      backdrop-filter: blur(20px);
      padding: 20px;
      overflow-y: auto;
      box-shadow: 4px 0 24px rgba(0, 0, 0, 0.2);
    }

    body.light-mode aside {
      background: rgba(255, 255, 255, 0.8);
    }

    aside::-webkit-scrollbar {
      width: 6px;
    }

    aside::-webkit-scrollbar-track {
      background: transparent;
    }

    aside::-webkit-scrollbar-thumb {
      background: rgba(91, 141, 239, 0.3);
      border-radius: 3px;
    }

    .nav-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      margin: 6px 12px 12px;
      font-weight: 700;
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .nav a {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: var(--text);
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      font-weight: 500;
    }

    .nav a::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .nav a:hover::before {
      width: 300px;
      height: 300px;
    }

    .nav a:hover {
      background: var(--hover);
      border-color: var(--accent);
      transform: translateX(4px);
      box-shadow: 0 4px 16px rgba(91, 141, 239, 0.2);
    }

    .nav a.active {
      background: var(--active);
      border-color: var(--accent);
      box-shadow: 0 4px 16px rgba(91, 141, 239, 0.3);
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      flex: 0 0 auto;
      box-shadow: 0 0 8px var(--accent-glow);
      animation: dotPulse 2s ease-in-out infinite;
    }

    @keyframes dotPulse {
      0%, 100% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.2); opacity: 1; }
    }

    main {
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .page-section {
      display: none;
      padding: 24px;
      overflow-y: auto;
      height: 100%;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .page-section::-webkit-scrollbar {
      width: 8px;
    }

    .page-section::-webkit-scrollbar-track {
      background: transparent;
    }

    .page-section::-webkit-scrollbar-thumb {
      background: rgba(91, 141, 239, 0.3);
      border-radius: 4px;
    }

    .page-section.active {
      display: block;
    }

    .card {
      max-width: 100%;
      background: rgba(19, 23, 41, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 28px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      margin-bottom: 24px;
    }

    body.light-mode .card {
      background: rgba(255, 255, 255, 0.8);
    }

    .card:hover {
      border-color: rgba(91, 141, 239, 0.3);
      box-shadow: 0 12px 48px rgba(0, 0, 0, 0.6), 0 0 32px rgba(91, 141, 239, 0.1);
    }

    .card h1 {
      margin: 0 0 12px;
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--text) 0%, var(--accent) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 22px;
      font-weight: 700;
      color: var(--text);
    }

    .card p {
      margin: 0 0 18px;
      color: var(--muted);
      line-height: 1.6;
      font-size: 15px;
    }

    .actions {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      appearance: none;
      border: 1px solid var(--border);
      background: rgba(91, 141, 239, 0.1);
      color: var(--text);
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 700;
      text-decoration: none;
      display: inline-block;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(91, 141, 239, 0.4) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn:hover {
      background: rgba(91, 141, 239, 0.2);
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(91, 141, 239, 0.3), 0 0 40px rgba(91, 141, 239, 0.2);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Settings Page Styles */
    .settings-container {
      max-width: 800px;
    }

    .settings-group {
      margin-bottom: 32px;
    }

    .settings-group h2 {
      font-size: 20px;
      margin-bottom: 16px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .setting-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      background: rgba(91, 141, 239, 0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }

    .setting-item:hover {
      border-color: var(--accent);
      background: rgba(91, 141, 239, 0.1);
    }

    .setting-info {
      flex: 1;
    }

    .setting-title {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 4px;
    }

    .setting-desc {
      font-size: 13px;
      color: var(--muted);
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      width: 54px;
      height: 28px;
      background: rgba(91, 141, 239, 0.2);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid var(--border);
    }

    .toggle-switch.active {
      background: var(--accent);
      border-color: var(--accent);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active::after {
      left: 28px;
    }

    /* File Input Styling */
    .file-input-wrapper {
      position: relative;
      display: inline-block;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .file-input-label {
      display: inline-block;
      padding: 12px 20px;
      background: rgba(91, 141, 239, 0.15);
      border: 1px solid var(--accent);
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s ease;
    }

    .file-input-label:hover {
      background: rgba(91, 141, 239, 0.3);
      box-shadow: 0 4px 16px rgba(91, 141, 239, 0.3);
    }

    /* Search */
    .search-wrap {
      margin-top: 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-input, .clear-btn {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(91, 141, 239, 0.05);
      color: var(--text);
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .search-input {
      min-width: 220px;
      flex: 1;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(91, 141, 239, 0.2);
      background: rgba(91, 141, 239, 0.1);
    }

    .clear-btn {
      cursor: pointer;
      font-weight: 800;
      transition: all 0.3s ease;
    }

    .clear-btn:hover {
      background: rgba(255, 68, 68, 0.2);
      border-color: var(--alert);
      box-shadow: 0 4px 16px rgba(255, 68, 68, 0.3);
    }

    /* Rows */
    .row {
      margin-top: 24px;
    }

    .row-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--muted);
      margin-bottom: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-weight: 700;
    }

    .scroller {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      padding-bottom: 12px;
      -webkit-overflow-scrolling: touch;
    }

    .scroller::-webkit-scrollbar {
      height: 6px;
    }

    .scroller::-webkit-scrollbar-track {
      background: rgba(91, 141, 239, 0.05);
      border-radius: 3px;
    }

    .scroller::-webkit-scrollbar-thumb {
      background: rgba(91, 141, 239, 0.3);
      border-radius: 3px;
    }

    .game, .movie, .tvshow, .shop-item {
      width: 260px;
      background: rgba(19, 23, 41, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 0 0 auto;
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
    }

    body.light-mode .game,
    body.light-mode .movie,
    body.light-mode .tvshow,
    body.light-mode .shop-item {
      background: rgba(255, 255, 255, 0.8);
    }

    .game:hover, .movie:hover, .tvshow:hover, .shop-item:hover {
      transform: translateY(-8px) scale(1.02);
      border-color: var(--accent);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4), 0 0 40px rgba(91, 141, 239, 0.2);
    }

    .favorite-btn {
      position: absolute;
      top: 24px;
      right: 24px;
      background: rgba(19, 23, 41, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      z-index: 10;
      transition: all 0.3s ease;
    }

    .favorite-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 16px rgba(255, 215, 0, 0.4);
    }

    .favorite-btn.active {
      background: rgba(255, 215, 0, 0.2);
      border-color: var(--coin-gold);
    }

    .thumb {
      height: 180px;
      object-fit: contain;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 14px;
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }

    .game:hover .thumb, .movie:hover .thumb, .tvshow:hover .thumb, .shop-item:hover .thumb {
      box-shadow: 0 8px 24px rgba(91, 141, 239, 0.3);
    }

    .game strong, .movie strong, .tvshow strong, .shop-item strong {
      font-size: 15px;
      font-weight: 700;
    }

    .shop-item .price {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 18px;
      font-weight: 800;
      color: var(--coin-gold);
    }

    .shop-item .price .coin-icon {
      width: 20px;
      height: 20px;
      font-size: 12px;
    }

    .game-btn, .movie-btn, .tvshow-btn, .buy-btn {
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(91, 141, 239, 0.15);
      font-weight: 800;
      cursor: pointer;
      color: #ffffff;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .buy-btn {
      background: rgba(255, 215, 0, 0.15);
      border-color: rgba(255, 215, 0, 0.3);
    }

    .buy-btn:hover {
      background: rgba(255, 215, 0, 0.3);
      border-color: var(--coin-gold);
      box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
    }

    .buy-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .game-btn::before, .movie-btn::before, .tvshow-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(91, 141, 239, 0.5) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.5s ease, height 0.5s ease;
    }

    .game-btn:hover::before, .movie-btn:hover::before, .tvshow-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .game-btn:hover, .movie-btn:hover, .tvshow-btn:hover {
      background: rgba(91, 141, 239, 0.3);
      border-color: var(--accent);
      box-shadow: 0 4px 20px rgba(91, 141, 239, 0.4), 0 0 30px rgba(91, 141, 239, 0.3);
      transform: translateY(-2px);
    }

    .empty {
      margin: 0;
      color: var(--muted);
      font-weight: 700;
      font-size: 14px;
    }

    /* Notification Styles */
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(19, 23, 41, 0.95);
      backdrop-filter: blur(20px);
      border: 2px solid var(--accent);
      border-radius: 16px;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 8px 32px rgba(91, 141, 239, 0.3);
      transform: translateX(150%);
      transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 10000;
      max-width: 400px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      border-color: var(--success);
    }

    .notification.warning {
      border-color: #ffaa00;
    }

    .notification.error {
      border-color: var(--alert);
    }

    .notification-icon {
      font-size: 24px;
    }

    .notification-text {
      font-weight: 700;
      font-size: 14px;
      color: var(--text);
    }

    /* Badge Styles */
    .badge-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .badge {
      background: rgba(19, 23, 41, 0.6);
      backdrop-filter: blur(10px);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .badge.unlocked {
      border-color: var(--coin-gold);
      box-shadow: 0 4px 16px rgba(255, 215, 0, 0.3);
    }

    .badge.locked {
      opacity: 0.4;
      filter: grayscale(100%);
    }

    .badge:hover {
      transform: translateY(-4px);
    }

    .badge-icon {
      font-size: 48px;
      margin-bottom: 8px;
    }

    .badge-name {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .badge-desc {
      font-size: 11px;
      color: var(--muted);
    }

    /* Status Update Styles */
    .status-update {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(91, 141, 239, 0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .status-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text);
      outline: none;
      font-weight: 500;
    }

    /* Keyboard Shortcut Display */
    .shortcut-key {
      display: inline-block;
      padding: 4px 8px;
      background: rgba(91, 141, 239, 0.1);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      font-weight: 700;
      margin: 0 4px;
    }

    .shortcut-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(91, 141, 239, 0.05);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .shortcut-action {
      font-weight: 600;
    }

    .shortcut-keys {
      display: flex;
      gap: 4px;
    }

    /* Category Filter */
    .category-filter {
      display: flex;
      gap: 8px;
      margin: 16px 0;
      flex-wrap: wrap;
    }

    .category-btn {
      padding: 8px 16px;
      background: rgba(91, 141, 239, 0.1);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: all 0.3s ease;
    }

    .category-btn:hover {
      background: rgba(91, 141, 239, 0.2);
      border-color: var(--accent);
    }

    .category-btn.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    /* Daily Reward Modal */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10001;
      animation: fadeIn 0.3s ease;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: rgba(19, 23, 41, 0.95);
      backdrop-filter: blur(20px);
      border: 2px solid var(--coin-gold);
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      text-align: center;
      box-shadow: 0 16px 64px rgba(255, 215, 0, 0.4);
      animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .reward-icon {
      font-size: 80px;
      margin-bottom: 20px;
      animation: bounce 1s ease infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .reward-title {
      font-size: 32px;
      font-weight: 800;
      color: var(--coin-gold);
      margin-bottom: 12px;
    }

    .reward-text {
      font-size: 18px;
      color: var(--muted);
      margin-bottom: 24px;
    }

    /* Player Overlay */
    .player {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      z-index: 9999;
      animation: fadeIn 0.3s ease;
    }

    .player.open {
      display: block;
    }

    .player-topbar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      color: #fff;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .player-exit {
      padding: 10px 20px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 68, 68, 0.2);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .player-exit:hover {
      background: rgba(255, 68, 68, 0.4);
      box-shadow: 0 4px 20px rgba(255, 68, 68, 0.4);
      transform: scale(1.05);
    }

    .player-frame {
      position: absolute;
      top: 60px;
      left: 0;
      width: 100%;
      height: calc(100% - 60px);
      border: 0;
    }

    /* Form Styling */
    form {
      max-width: 600px;
      margin-top: 12px;
    }

    label {
      display: inline-block;
      margin-bottom: 8px;
      font-weight: 800;
      color: var(--text);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    select, textarea, input[type="text"], input[type="file"] {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 18px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(91, 141, 239, 0.05);
      color: var(--text);
      outline: none;
      font-weight: 600;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    select:focus, textarea:focus, input[type="text"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(91, 141, 239, 0.2);
      background: rgba(91, 141, 239, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 140px;
    }

    select option {
      background: var(--panel);
      color: var(--text);
    }

    #status {
      margin-top: 16px;
      color: var(--muted);
      font-weight: 700;
      padding: 12px;
      border-radius: 12px;
      background: rgba(91, 141, 239, 0.05);
    }

    .status-ok {
      color: var(--success);
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
    }

    .status-bad {
      color: var(--alert);
      background: rgba(255, 68, 68, 0.1);
      border: 1px solid rgba(255, 68, 68, 0.3);
    }

    /* Google Sites Button */
    .google-sites-button {
      font-family: 'Inter', 'Roboto', Arial, sans-serif;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      padding: 14px 32px;
      border-radius: 12px;
      border: 1px solid var(--accent);
      cursor: pointer;
      color: var(--text);
      background: rgba(91, 141, 239, 0.15);
      box-shadow: 0 4px 16px rgba(91, 141, 239, 0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .google-sites-button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(91, 141, 239, 0.5) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.6s ease, height 0.6s ease;
    }

    .google-sites-button:hover::before {
      width: 400px;
      height: 400px;
    }

    .google-sites-button:hover {
      background: rgba(91, 141, 239, 0.3);
      box-shadow: 0 8px 32px rgba(91, 141, 239, 0.4), 0 0 50px rgba(91, 141, 239, 0.3);
      transform: translateY(-4px);
    }

    .google-sites-button:active {
      transform: translateY(-2px);
    }

    /* Chat Styles */
    .chat-layout {
      display: flex;
      width: 100%;
      height: 100%;
    }

    .sidebar {
      width: 300px;
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      background: rgba(19, 23, 41, 0.6);
      backdrop-filter: blur(20px);
      overflow-y: auto;
    }

    body.light-mode .sidebar {
      background: rgba(255, 255, 255, 0.8);
    }

    .sidebar::-webkit-scrollbar {
      width: 6px;
    }

    .sidebar::-webkit-scrollbar-thumb {
      background: rgba(91, 141, 239, 0.3);
      border-radius: 3px;
    }

    .contact-item {
      padding: 14px 18px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      display: flex;
      align-items: center;
      font-weight: 500;
    }

    .contact-item.selected {
      border-left: 3px solid var(--accent);
      background: rgba(91, 141, 239, 0.15);
      box-shadow: inset 0 0 20px rgba(91, 141, 239, 0.1);
    }

    .contact-item:hover {
      background: var(--hover);
      transform: translateX(4px);
    }

    .avatar-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid var(--border);
      object-fit: cover;
      margin-right: 14px;
      transition: all 0.3s ease;
    }

    .contact-item:hover .avatar-circle {
      border-color: var(--accent);
      box-shadow: 0 0 16px var(--accent-glow);
    }

    .chat-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--bg);
      position: relative;
      background-size: cover !important;
      background-position: center !important;
    }

    .chat-header {
      padding: 16px 28px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      background: rgba(11, 18, 32, 0.9);
      backdrop-filter: blur(20px);
      z-index: 2;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    .chat-header-title {
      font-size: 16px;
      color: var(--accent);
      flex: 1;
      font-weight: 700;
    }

    .chat-msgs-box {
      flex: 1;
      overflow-y: auto;
      padding: 28px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1;
      background: rgba(11, 18, 32, 0.4);
    }

    .chat-msgs-box::-webkit-scrollbar {
      width: 8px;
    }

    .chat-msgs-box::-webkit-scrollbar-thumb {
      background: rgba(91, 141, 239, 0.3);
      border-radius: 4px;
    }

    .msg {
      padding: 12px 18px;
      border-radius: 16px;
      max-width: 70%;
      font-size: 14px;
      word-wrap: break-word;
      position: relative;
      animation: msgSlide 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    @keyframes msgSlide {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .msg.user {
      align-self: flex-end;
      background: linear-gradient(135deg, var(--accent) 0%, #4a7bd8 100%);
      color: #fff;
      box-shadow: 0 4px 16px rgba(91, 141, 239, 0.3);
    }

    .msg.other {
      align-self: flex-start;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border);
      backdrop-filter: blur(10px);
    }

    .chat-pfp-trigger {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #222;
      margin-bottom: 6px;
      cursor: pointer;
      border: 2px solid var(--border);
      display: block;
      transition: all 0.3s ease;
    }

    .chat-pfp-trigger:hover {
      border-color: var(--accent);
      box-shadow: 0 0 12px var(--accent-glow);
      transform: scale(1.1);
    }

    .chat-input-area {
      padding: 24px;
      border-top: 1px solid var(--border);
      background: rgba(11, 18, 32, 0.9);
      backdrop-filter: blur(20px);
      z-index: 2;
    }

    .chat-input {
      width: 100%;
      background: rgba(91, 141, 239, 0.05);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 14px 18px;
      border-radius: 14px;
      outline: none;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .chat-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 20px rgba(91, 141, 239, 0.2);
      background: rgba(91, 141, 239, 0.1);
    }

    .section-divider {
      padding: 18px;
      font-size: 11px;
      opacity: 0.5;
      letter-spacing: 2px;
      border-top: 1px solid var(--border);
      font-weight: 700;
    }

    #friend-search {
      margin: 0 18px 12px;
      background: rgba(91, 141, 239, 0.05);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 14px;
      font-size: 13px;
      border-radius: 10px;
      width: calc(100% - 36px);
      transition: all 0.3s ease;
      font-weight: 500;
    }

    #friend-search:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 16px rgba(91, 141, 239, 0.2);
    }

    .settings-icon {
      cursor: pointer;
      opacity: 0.6;
      font-size: 20px;
      margin-left: 12px;
      transition: all 0.3s ease;
      filter: drop-shadow(0 0 4px transparent);
    }

    .settings-icon:hover {
      opacity: 1;
      transform: rotate(90deg) scale(1.1);
      filter: drop-shadow(0 0 8px var(--accent-glow));
    }

    /* Profile Styles */
    .profile-container {
      max-width: 700px;
      margin: 0 auto;
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 24px;
      margin-bottom: 32px;
    }

    .profile-pic-wrapper {
      position: relative;
    }

    .profile-pic {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--accent);
      box-shadow: 0 8px 24px rgba(91, 141, 239, 0.4);
      transition: all 0.3s ease;
    }

    .profile-pic:hover {
      box-shadow: 0 12px 32px rgba(91, 141, 239, 0.6);
      transform: scale(1.05);
    }

    .change-pic-btn {
      position: absolute;
      bottom: 4px;
      right: 4px;
      background: var(--accent);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(91, 141, 239, 0.4);
      transition: all 0.3s ease;
    }

    .change-pic-btn:hover {
      transform: scale(1.1) rotate(15deg);
      box-shadow: 0 6px 20px rgba(91, 141, 239, 0.6);
    }

    .profile-info h2 {
      margin: 0 0 8px 0;
      font-size: 28px;
      font-weight: 800;
    }

    .profile-info .status {
      color: var(--muted);
      font-size: 15px;
      font-weight: 600;
    }

    .requests-section {
      margin-top: 32px;
    }

    .requests-section h3 {
      font-size: 20px;
      margin-bottom: 16px;
      color: var(--text);
    }

    .request-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      background: rgba(19, 23, 41, 0.6);
      border: 1px solid var(--border);
      border-radius: 14px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }

    body.light-mode .request-item {
      background: rgba(255, 255, 255, 0.8);
    }

    .request-item:hover {
      border-color: var(--accent);
      box-shadow: 0 4px 20px rgba(91, 141, 239, 0.2);
      transform: translateX(4px);
    }

    .request-user {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .request-actions {
      display: flex;
      gap: 10px;
    }

    .accept-btn {
      background: rgba(0, 255, 136, 0.2);
      color: var(--success);
      border: 1px solid var(--success);
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 800;
      transition: all 0.3s ease;
    }

    .accept-btn:hover {
      background: rgba(0, 255, 136, 0.3);
      box-shadow: 0 4px 16px rgba(0, 255, 136, 0.3);
      transform: translateY(-2px);
    }

    .decline-btn {
      background: rgba(255, 68, 68, 0.2);
      color: var(--alert);
      border: 1px solid var(--alert);
      padding: 10px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 800;
      transition: all 0.3s ease;
    }

    .decline-btn:hover {
      background: rgba(255, 68, 68, 0.3);
      box-shadow: 0 4px 16px rgba(255, 68, 68, 0.3);
      transform: translateY(-2px);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .app {
        grid-template-columns: 1fr;
      }

      aside {
        display: none;
      }

      .sidebar {
        width: 100%;
      }

      .header-info {
        display: none;
      }
    }
  </style>
</head>

<body>
  <!-- Enhanced Animated Background -->
  <div class="bg-container">
    <div class="custom-bg" id="customBg"></div>
    <div class="gradient-wave"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
    <div class="grid-overlay"></div>
    <div class="scanline"></div>
    <div class="energy-ring"></div>
    <div class="energy-ring"></div>
    <div class="energy-ring"></div>
    <div class="particles" id="particles"></div>
  </div>

  <div class="app">
    <header>
      <div class="brand">Nova</div>
      
      <div class="header-info">
        <div class="info-item">
          <span class="info-label">Device</span>
          <span class="info-value" id="device-type">PC</span>
        </div>
        <div class="info-item">
          <span class="info-label">Time</span>
          <span class="info-value" id="current-time">00:00:00</span>
        </div>
        <div class="info-item">
          <span class="info-label">Memory</span>
          <span class="info-value" id="memory-usage">-- MB</span>
        </div>
      </div>

      <div class="coin-display" onclick="showPage('achievements')" title="View Achievements & Rewards">
        <div class="coin-icon">ü™ô</div>
        <span id="coin-count">0</span>
      </div>
    </header>

    <aside>
      <div class="nav-title">Pages</div>
      <nav class="nav" id="nav">
        <a href="#home" data-page="home">
          <span class="dot"></span><span>Home</span>
        </a>
        <a href="#unblocked-google" data-page="unblocked-google">
          <span class="dot"></span><span>Unblocked Google</span>
        </a>
        <a href="#games" data-page="games">
          <span class="dot"></span><span>Games</span>
        </a>
        <a href="#shop" data-page="shop">
          <span class="dot"></span><span>Shop</span>
        </a>
        <a href="#achievements" data-page="achievements">
          <span class="dot"></span><span>Achievements</span>
        </a>
        <a href="#requests" data-page="requests">
          <span class="dot"></span><span>Requests</span>
        </a>
        <a href="#water" data-page="water">
          <span class="dot"></span><span>Water</span>
        </a>
        <a href="#movies" data-page="movies">
          <span class="dot"></span><span>Movies</span>
        </a>
        <a href="#tvshows" data-page="tvshows">
          <span class="dot"></span><span>TV Shows</span>
        </a>
        <a href="#chat" data-page="chat">
          <span class="dot"></span><span>Chat</span>
        </a>
        <a href="#profile" data-page="profile">
          <span class="dot"></span><span>Profile</span>
        </a>
        <a href="#settings" data-page="settings">
          <span class="dot"></span><span>Settings</span>
        </a>
      </nav>
    </aside>

    <main>
      <!-- HOME PAGE -->
      <div id="home" class="page-section active">
        <div class="card">
          <h1>Welcome to Nova</h1>
          <p>Your enhanced gaming and entertainment hub</p>
          
          <!-- Recently Played Section -->
          <div class="row">
            <div class="row-title"><span>üïê Recently Played</span></div>
            <p class="empty" id="recentlyPlayedEmpty">No recent activity</p>
            <div class="scroller" id="recentlyPlayedScroller"></div>
          </div>

          <!-- Favorites Section -->
          <div class="row" style="margin-top: 32px;">
            <div class="row-title"><span>‚≠ê Your Favorites</span></div>
            <p class="empty" id="favoritesEmpty">No favorites yet. Click the star on any game or movie!</p>
            <div class="scroller" id="favoritesScroller"></div>
          </div>

          <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border); display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            <a class="btn" href="https://sites.google.com/oasiscs.org/rebornwater" target="_blank" rel="noopener noreferrer">Dominic's Site</a>
            <span style="color: var(--muted); font-size: 14px;">Credits to Dominic for the UI on the Chat Page</span>
          </div>
        </div>
      </div>

      <!-- ACHIEVEMENTS PAGE -->
      <div id="achievements" class="page-section">
        <div class="card">
          <h1>üèÜ Achievements & Rewards</h1>
          <p>Track your progress and claim daily rewards</p>

          <!-- Daily Reward Section -->
          <div style="margin-top: 24px; padding: 24px; background: rgba(255, 215, 0, 0.1); border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 16px;">
            <h2 style="margin: 0 0 12px 0; color: var(--coin-gold);">üí∞ Daily Rewards</h2>
            <p style="margin: 0 0 16px 0;">Claim your reward every 12 hours!</p>
            <div style="display: flex; align-items: center; gap: 16px;">
              <button class="btn" id="claimRewardBtn" onclick="claimDailyReward()">Claim 5 Coins</button>
              <span id="rewardTimer" style="color: var(--muted); font-weight: 700;"></span>
            </div>
          </div>

          <!-- Badges Section -->
          <div style="margin-top: 32px;">
            <h2>üéñÔ∏è Your Badges</h2>
            <div class="badge-container" id="badgeContainer"></div>
          </div>
        </div>
      </div>

      <!-- SETTINGS PAGE -->
      <div id="settings" class="page-section">
        <div class="card settings-container">
          <h1>Settings</h1>
          <p>Customize your Nova experience</p>

          <div class="settings-group">
            <h2>üé® Appearance</h2>
            
            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Dark Mode / Light Mode</div>
                <div class="setting-desc">Toggle between dark and light themes</div>
              </div>
              <div class="toggle-switch" id="theme-toggle" onclick="toggleTheme()">
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Custom Background</div>
                <div class="setting-desc">Upload your own background image</div>
              </div>
              <div class="file-input-wrapper">
                <input type="file" id="bg-upload" accept="image/*" onchange="uploadBackground(event)">
                <label for="bg-upload" class="file-input-label">Choose File</label>
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Reset Background</div>
                <div class="setting-desc">Remove custom background and restore default</div>
              </div>
              <button class="btn" onclick="resetBackground()">Reset</button>
            </div>
          </div>

          <div class="settings-group">
            <h2>‚ö° Performance</h2>
            
            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Performance Mode</div>
                <div class="setting-desc">Disable animations for better performance</div>
              </div>
              <div class="toggle-switch" id="performance-toggle" onclick="togglePerformance()">
              </div>
            </div>
          </div>

          <div class="settings-group">
            <h2>üéÆ Display</h2>
            
            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Scroll or Grid Mode</div>
                <div class="setting-desc">Display games in scrollable row or grid layout</div>
              </div>
              <div class="toggle-switch" id="grid-toggle" onclick="toggleGridMode()">
              </div>
            </div>
          </div>

          <div class="settings-group">
            <h2>üîî Notifications</h2>
            
            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Enable Notifications</div>
                <div class="setting-desc">Receive notifications for rewards and achievements</div>
              </div>
              <div class="toggle-switch active" id="notifications-toggle" onclick="toggleNotifications()">
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Notification Frequency</div>
                <div class="setting-desc">How often you receive notifications</div>
              </div>
              <select id="notification-frequency" onchange="updateNotificationFrequency()">
                <option value="all">All Notifications</option>
                <option value="important">Important Only</option>
                <option value="minimal">Minimal</option>
                <option value="none">None</option>
              </select>
            </div>
          </div>

          <div class="settings-group">
            <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
            
            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Enable Keyboard Shortcuts</div>
                <div class="setting-desc">Use keyboard shortcuts to navigate</div>
              </div>
              <div class="toggle-switch active" id="shortcuts-toggle" onclick="toggleShortcuts()">
              </div>
            </div>

            <div style="margin-top: 16px;">
              <div class="shortcut-item">
                <span class="shortcut-action">Home Page</span>
                <div class="shortcut-keys">
                  <span class="shortcut-key" id="shortcut-home">Alt</span>
                  <span>+</span>
                  <span class="shortcut-key">H</span>
                </div>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-action">Games</span>
                <div class="shortcut-keys">
                  <span class="shortcut-key" id="shortcut-games">Alt</span>
                  <span>+</span>
                  <span class="shortcut-key">G</span>
                </div>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-action">Settings</span>
                <div class="shortcut-keys">
                  <span class="shortcut-key" id="shortcut-settings">Alt</span>
                  <span>+</span>
                  <span class="shortcut-key">S</span>
                </div>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-action">Search</span>
                <div class="shortcut-keys">
                  <span class="shortcut-key" id="shortcut-search">Ctrl</span>
                  <span>+</span>
                  <span class="shortcut-key">K</span>
                </div>
              </div>
              <div class="shortcut-item">
                <span class="shortcut-action">Profile</span>
                <div class="shortcut-keys">
                  <span class="shortcut-key" id="shortcut-profile">Alt</span>
                  <span>+</span>
                  <span class="shortcut-key">P</span>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-group">
            <h2>üîí Browser</h2>
            
            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Prevent Ctrl+W</div>
                <div class="setting-desc">Block accidental tab closing with Ctrl+W</div>
              </div>
              <div class="toggle-switch" id="ctrlw-toggle" onclick="toggleCtrlW()">
              </div>
            </div>
          </div>

          <div class="settings-group">
            <h2>üíæ Data</h2>
            
            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Export Settings</div>
                <div class="setting-desc">Save your settings to a file</div>
              </div>
              <button class="btn" onclick="exportSettings()">Export</button>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Import Settings</div>
                <div class="setting-desc">Load settings from a file</div>
              </div>
              <div class="file-input-wrapper">
                <input type="file" id="settings-import" accept=".json" onchange="importSettings(event)">
                <label for="settings-import" class="file-input-label">Import</label>
              </div>
            </div>

            <div class="setting-item">
              <div class="setting-info">
                <div class="setting-title">Reset All Settings</div>
                <div class="setting-desc">Clear all settings and return to defaults</div>
              </div>
              <button class="btn" style="background: rgba(255, 68, 68, 0.2); border-color: var(--alert);" onclick="resetAllSettings()">Reset All</button>
            </div>
          </div>
        </div>
      </div>

      <!-- UNBLOCKED GOOGLE PAGE -->
      <div id="unblocked-google" class="page-section">
        <div class="card">
          <h1>Unblocked Google</h1>
          <p>This doesn't show up on your search history and everything is completely unblocked</p>
          <br>
          <button class="google-sites-button" onclick="openUnblockedGoogle()">Open Unblocked Google</button>
        </div>
      </div>

      <!-- GAMES PAGE -->
      <div id="games" class="page-section">
        <div class="card">
          <h1>Games</h1>
          <div class="search-wrap">
            <input id="games-search" class="search-input" type="text" placeholder="Search games..." autocomplete="off" />
            <button id="games-clear" class="clear-btn" type="button">Clear</button>
          </div>

          <!-- Category Filter -->
          <div class="category-filter">
            <button class="category-btn active" onclick="filterGamesByCategory('all')">All</button>
            <button class="category-btn" onclick="filterGamesByCategory('action')">Action</button>
            <button class="category-btn" onclick="filterGamesByCategory('horror')">Horror</button>
            <button class="category-btn" onclick="filterGamesByCategory('sports')">Sports</button>
            <button class="category-btn" onclick="filterGamesByCategory('puzzle')">Puzzle</button>
            <button class="category-btn" onclick="filterGamesByCategory('adventure')">Adventure</button>
          </div>

          <div class="row">
            <div class="row-title"><span>Top Games</span></div>
            <div class="scroller" id="topGamesScroller"></div>
          </div>

          <div class="row" style="margin-top:22px;">
            <div class="row-title"><span>Games</span></div>
            <p class="empty" id="gamesEmpty" style="display:none;">No games match your search.</p>
            <div class="scroller" id="allGamesScroller"></div>
          </div>
        </div>
      </div>

      <!-- SHOP PAGE -->
      <div id="shop" class="page-section">
        <div class="card">
          <h1>Nova Coin Shop</h1>
          <p>Purchase offline game downloads with your Nova Coins. Make sure to login so your coins save</p>

          <div class="row">
            <div class="row-title"><span>Available Downloads</span></div>
            <div class="scroller" id="shopScroller"></div>
          </div>

          <div class="row" style="margin-top:32px;">
            <div class="row-title"><span>Your Purchases</span></div>
            <div id="purchasedItems">
              <p class="empty">You haven't purchased anything yet...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- REQUESTS PAGE -->
      <div id="requests" class="page-section">
        <div class="card">
          <h1>Requests</h1>
          <p>Submit a request or report a bug</p>

          <form id="requestForm">
            <label><strong>Request Type</strong></label><br>
            <select name="request_type" required>
              <option value="">Select an option</option>
              <option>Game Request</option>
              <option>Movie Request</option>
              <option>TV Show Request</option>
              <option>Anime Request</option>
              <option>Feature Suggestion</option>
              <option>Report a Bug</option>
              <option>Other</option>
            </select>

            <label><strong>Details</strong></label><br>
            <textarea name="details" required rows="5" placeholder="Describe your request..."></textarea>

            <label><strong>Name (optional)</strong></label><br>
            <input type="text" name="name" placeholder="Your name">

            <button class="btn" type="submit">Submit Request</button>
            <p id="status"></p>
          </form>
        </div>
      </div>

      <!-- WATER PAGE -->
      <div id="water" class="page-section">
        <div class="card">
          <h1>Water</h1>
          <p>Password is funni</p>
          <br>
          <button class="google-sites-button" onclick="openWaterGame()">Click this</button>
        </div>
      </div>

      <!-- MOVIES PAGE -->
      <div id="movies" class="page-section">
        <div class="card">
          <h1>Movies</h1>
          <div class="search-wrap">
            <input id="movies-search" class="search-input" placeholder="Search movies..." />
            <button id="movies-clear" class="clear-btn">Clear</button>
          </div>

          <div class="row">
            <div class="row-title">Top Movies</div>
            <div class="scroller" id="topMoviesScroller"></div>
          </div>

          <div class="row">
            <div class="row-title">All Movies</div>
            <p class="empty" id="moviesEmpty" style="display:none;">No movies match your search.</p>
            <div class="scroller" id="allMoviesScroller"></div>
          </div>
        </div>
      </div>

      <!-- TV SHOWS PAGE -->
      <div id="tvshows" class="page-section">
        <div class="card">
          <h1>TV Shows</h1>
          <div class="search-wrap">
            <input id="tvshows-search" class="search-input" placeholder="Search TV shows..." />
            <button id="tvshows-clear" class="clear-btn">Clear</button>
          </div>

          <div class="row">
            <div class="row-title">All TV Shows</div>
            <div class="scroller" id="allTVShowsScroller"></div>
          </div>
        </div>
      </div>

      <!-- CHAT PAGE -->
      <div id="chat" class="page-section" style="padding:0;">
        <div class="chat-layout">
          <div class="sidebar">
            <div class="section-divider">CHANNELS</div>
            <div id="chatroom-list">
              <div class="contact-item" onclick="openChat('Live Chatroom', this, 'global')">
                <div class="avatar-circle" style="display:flex;align-items:center;justify-content:center;background:var(--accent);color:#000;font-weight:bold;">#</div>
                <span>Public Channel</span>
              </div>
            </div>

            <div class="section-divider">GROUPS</div>
            <div id="group-list"></div>

            <div class="section-divider">CONTACTS</div>
            <input type="text" id="friend-search" placeholder="Search friends..." onkeyup="filterFriends()" />
            <div id="friend-list"></div>

            <button class="btn" style="margin-top:auto;border:none;background:rgba(91,141,239,0.15);width:calc(100% - 36px);margin-left:18px;margin-right:18px;margin-bottom:18px;" onclick="addFriend()">+ Add Friend</button>
          </div>

          <div id="chat-pane" class="chat-main">
            <div class="chat-header">
              <img id="header-pfp" class="avatar-circle" style="display:none;cursor:pointer;" onclick="viewProfileFromChat()" />
              <div id="active-chat-user" class="chat-header-title" style="cursor:pointer;" onclick="viewProfileFromChat()">Select a contact</div>
              <button id="make-group-btn" class="btn" style="display:none;margin-right:10px;" onclick="createGroup()">Make Group</button>
              <button id="manage-group-btn" class="btn" style="display:none;margin-right:10px;" onclick="alert('Group management coming soon!')">Manage</button>
              <div class="settings-icon" onclick="changeChatBG()" title="Change Chat Background">‚öôÔ∏è</div>
            </div>

            <div id="chat-msgs" class="chat-msgs-box"></div>

            <div class="chat-input-area">
              <input type="text" id="chat-input" class="chat-input" placeholder="Type a message..." onkeydown="if(event.key==='Enter') sendMsg()" />
            </div>
          </div>
        </div>
      </div>

      <!-- PROFILE PAGE -->
      <div id="profile" class="page-section">
        <div class="card profile-container">
          <div class="profile-header">
            <div class="profile-pic-wrapper">
              <img id="profile-pic" class="profile-pic" src="https://via.placeholder.com/120" alt="Profile Picture">
              <button class="change-pic-btn" onclick="document.getElementById('pfp-upload').click()">üì∑</button>
              <input type="file" id="pfp-upload" accept="image/*" style="display:none;" onchange="uploadProfilePic(event)">
            </div>
            <div class="profile-info">
              <h2 id="profile-username">Guest</h2>
              <p class="status" id="profile-status">Offline</p>
              
              <!-- Status Update -->
              <div class="status-update" style="margin-top: 12px;">
                <input type="text" id="status-input" class="status-input" placeholder="What's on your mind?" maxlength="100">
                <button class="btn" onclick="updateStatus()" style="padding: 8px 16px;">Update</button>
              </div>
            </div>
          </div>

          <div class="card" style="margin-bottom:20px;">
            <h3 style="margin-top:0;">Login / Register</h3>
            <input type="text" id="login-username" placeholder="Enter username" style="margin-bottom:10px;">
            <div style="display:flex;gap:10px;">
              <button class="btn" onclick="loginUser()">Login</button>
              <button class="btn" onclick="registerUser()">Register</button>
              <button class="btn" onclick="logoutUser()">Logout</button>
            </div>
          </div>

          <div class="requests-section">
            <h3>Friend Requests</h3>
            <div id="requests-list">
              <p class="empty">No pending requests</p>
            </div>
          </div>
        </div>
      </div>

      <!-- USER PROFILE VIEW PAGE -->
      <div id="user-profile" class="page-section">
        <div class="card profile-container">
          <button class="btn" onclick="goBackFromUserProfile()" style="margin-bottom: 20px;">‚Üê Back</button>
          <div class="profile-header">
            <div class="profile-pic-wrapper">
              <img id="user-profile-pic" class="profile-pic" src="https://via.placeholder.com/120" alt="Profile Picture">
            </div>
            <div class="profile-info">
              <h2 id="user-profile-username">Loading...</h2>
              <p class="status" id="user-profile-status">Offline</p>
              <p class="status" id="user-profile-custom-status" style="margin-top: 8px; font-style: italic;"></p>
            </div>
          </div>

          <div class="card" style="margin-top:20px;">
            <h3 style="margin-top:0;">Actions</h3>
            <div style="display:flex;gap:10px;flex-wrap:wrap;" id="user-profile-actions">
              <button class="btn" onclick="sendFriendRequestToUser()">Add Friend</button>
              <button class="btn" onclick="messageUser()">Send Message</button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- PLAYER OVERLAY -->
  <div class="player" id="player">
    <div class="player-topbar">
      <div id="playerName">Content</div>
      <button id="closeBtn" class="player-exit">Exit</button>
    </div>
    <iframe id="playerFrame" class="player-frame"></iframe>
  </div>

  <!-- NOTIFICATION -->
  <div class="notification" id="notification">
    <div class="notification-icon">üì¢</div>
    <div class="notification-text" id="notificationText">Notification</div>
  </div>

  <!-- DAILY REWARD MODAL -->
  <div class="modal" id="rewardModal">
    <div class="modal-content">
      <div class="reward-icon">üéâ</div>
      <div class="reward-title">Daily Reward Claimed!</div>
      <div class="reward-text">You received <strong>5 Nova Coins</strong></div>
      <button class="btn" onclick="closeRewardModal()">Awesome!</button>
    </div>
  </div>

  <script>
// ============================================
// INITIALIZE EMAILJS
// ============================================

(function() {
  emailjs.init("WVn4FyckWoY68y1Kp");
})();

// ============================================
// FIREBASE CONFIG
// ============================================

const firebaseConfig = {
  apiKey: "AIzaSyB-IbnRdC9RwT4eZPtpgH9F1fj5OKeRw9U",
  authDomain: "unblocked-hub-chat.firebaseapp.com",
  databaseURL: "https://unblocked-hub-chat-default-rtdb.firebaseio.com",
  projectId: "unblocked-hub-chat",
  storageBucket: "unblocked-hub-chat.firebasestorage.app",
  messagingSenderId: "192995986961",
  appId: "1:192995986961:web:6ee8f3ce513ac3b744ebb0",
  measurementId: "G-QDX7PP5JXL"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

window.myName = null;
let activeChat = null, chatType = "none", myFriends = [];
let viewedUserName = null;
let previousPage = null;

// ============================================
// SETTINGS SYSTEM
// ============================================

const SETTINGS_KEY = 'nova_settings';
let preventCtrlW = false;
let keyboardShortcutsEnabled = true;
let notificationsEnabled = true;
let notificationFrequency = 'all';

// Load settings on startup
function loadSettings() {
  const saved = localStorage.getItem(SETTINGS_KEY);
  if (saved) {
    try {
      const settings = JSON.parse(saved);
      
      if (settings.lightMode) {
        document.body.classList.add('light-mode');
        document.getElementById('theme-toggle').classList.add('active');
      }
      
      if (settings.performanceMode) {
        document.body.classList.add('performance-mode');
        document.getElementById('performance-toggle').classList.add('active');
      }
      
      if (settings.gridMode) {
        document.body.classList.add('grid-mode');
        document.getElementById('grid-toggle').classList.add('active');
      }
      
      if (settings.preventCtrlW) {
        preventCtrlW = true;
        document.getElementById('ctrlw-toggle').classList.add('active');
      }

      if (settings.keyboardShortcuts !== undefined) {
        keyboardShortcutsEnabled = settings.keyboardShortcuts;
        if (!keyboardShortcutsEnabled) {
          document.getElementById('shortcuts-toggle').classList.remove('active');
        }
      }

      if (settings.notifications !== undefined) {
        notificationsEnabled = settings.notifications;
        if (!notificationsEnabled) {
          document.getElementById('notifications-toggle').classList.remove('active');
        }
      }

      if (settings.notificationFrequency) {
        notificationFrequency = settings.notificationFrequency;
        document.getElementById('notification-frequency').value = notificationFrequency;
      }
      
      if (settings.customBackground) {
        const bgEl = document.getElementById('customBg');
        bgEl.style.backgroundImage = `url(${settings.customBackground})`;
        bgEl.classList.add('active');
      }
    } catch (e) {
      console.error('Failed to load settings:', e);
    }
  }
}

function saveSettings() {
  const settings = {
    lightMode: document.body.classList.contains('light-mode'),
    performanceMode: document.body.classList.contains('performance-mode'),
    gridMode: document.body.classList.contains('grid-mode'),
    preventCtrlW: preventCtrlW,
    keyboardShortcuts: keyboardShortcutsEnabled,
    notifications: notificationsEnabled,
    notificationFrequency: notificationFrequency,
    customBackground: document.getElementById('customBg').style.backgroundImage.slice(5, -2)
  };
  localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
}

function toggleTheme() {
  document.body.classList.toggle('light-mode');
  document.getElementById('theme-toggle').classList.toggle('active');
  saveSettings();
}

function togglePerformance() {
  document.body.classList.toggle('performance-mode');
  document.getElementById('performance-toggle').classList.toggle('active');
  saveSettings();
}

function toggleGridMode() {
  document.body.classList.toggle('grid-mode');
  document.getElementById('grid-toggle').classList.toggle('active');
  saveSettings();
}

function toggleCtrlW() {
  preventCtrlW = !preventCtrlW;
  document.getElementById('ctrlw-toggle').classList.toggle('active');
  saveSettings();
}

function toggleShortcuts() {
  keyboardShortcutsEnabled = !keyboardShortcutsEnabled;
  document.getElementById('shortcuts-toggle').classList.toggle('active');
  saveSettings();
  if (keyboardShortcutsEnabled) {
    showNotification('Keyboard shortcuts enabled', 'success');
  } else {
    showNotification('Keyboard shortcuts disabled', 'warning');
  }
}

function toggleNotifications() {
  notificationsEnabled = !notificationsEnabled;
  document.getElementById('notifications-toggle').classList.toggle('active');
  saveSettings();
}

function updateNotificationFrequency() {
  notificationFrequency = document.getElementById('notification-frequency').value;
  saveSettings();
  showNotification(`Notification frequency set to ${notificationFrequency}`, 'success');
}

function uploadBackground(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const bgEl = document.getElementById('customBg');
    bgEl.style.backgroundImage = `url(${e.target.result})`;
    bgEl.classList.add('active');
    saveSettings();
    showNotification('Custom background applied!', 'success');
  };
  reader.readAsDataURL(file);
}

function resetBackground() {
  const bgEl = document.getElementById('customBg');
  bgEl.style.backgroundImage = '';
  bgEl.classList.remove('active');
  saveSettings();
  showNotification('Background reset to default!', 'success');
}

function exportSettings() {
  const settings = localStorage.getItem(SETTINGS_KEY);
  if (!settings) {
    showNotification('No settings to export!', 'warning');
    return;
  }

  const blob = new Blob([settings], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'nova-settings.json';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showNotification('Settings exported!', 'success');
}

function importSettings(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const settings = JSON.parse(e.target.result);
      localStorage.setItem(SETTINGS_KEY, e.target.result);
      showNotification('Settings imported! Refreshing...', 'success');
      setTimeout(() => location.reload(), 1500);
    } catch (err) {
      showNotification('Invalid settings file!', 'error');
    }
  };
  reader.readAsText(file);
}

function resetAllSettings() {
  if (confirm('Are you sure you want to reset all settings? This cannot be undone.')) {
    localStorage.removeItem(SETTINGS_KEY);
    showNotification('Settings reset! Refreshing...', 'success');
    setTimeout(() => location.reload(), 1500);
  }
}

// ============================================
// KEYBOARD SHORTCUTS
// ============================================

document.addEventListener('keydown', (e) => {
  // Ctrl+W Prevention
  if (preventCtrlW && e.ctrlKey && e.key === 'w') {
    e.preventDefault();
    showNotification('Closing tabs is disabled in settings!', 'warning');
    return;
  }

  if (!keyboardShortcutsEnabled) return;

  // Ctrl+K for search
  if (e.ctrlKey && e.key === 'k') {
    e.preventDefault();
    const searchInput = document.querySelector('.page-section.active .search-input');
    if (searchInput) searchInput.focus();
    return;
  }

  // Alt + Letter shortcuts
  if (e.altKey) {
    switch(e.key.toLowerCase()) {
      case 'h':
        e.preventDefault();
        showPage('home');
        break;
      case 'g':
        e.preventDefault();
        showPage('games');
        break;
      case 's':
        e.preventDefault();
        showPage('shop');
        break;
      case 'm':
        e.preventDefault();
        showPage('movies');
        break;
      case 't':
        e.preventDefault();
        showPage('tvshows');
        break;
      case 'c':
        e.preventDefault();
        showPage('chat');
        break;
      case 'p':
        e.preventDefault();
        showPage('profile');
        break;
    }
  }
});

// ============================================
// NOTIFICATION SYSTEM
// ============================================

function showNotification(text, type = 'success') {
  if (!notificationsEnabled) return;
  if (notificationFrequency === 'minimal' && type === 'success') return;

  const notification = document.getElementById('notification');
  const notificationText = document.getElementById('notificationText');
  
  notification.className = 'notification';
  notification.classList.add(type);
  notificationText.textContent = text;
  
  notification.classList.add('show');
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

// ============================================
// DEVICE & SYSTEM INFO
// ============================================

function detectDevice() {
  const ua = navigator.userAgent;
  let device = 'PC';
  
  if (/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(ua)) {
    device = 'Tablet';
  } else if (/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(ua)) {
    device = 'Phone';
  }
  
  document.getElementById('device-type').textContent = device;
}

function updateClock() {
  const now = new Date();
  let hours = now.getHours();
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  const ampm = hours >= 12 ? 'PM' : 'AM';
  hours = hours % 12;
  hours = hours ? hours : 12;
  const hoursStr = String(hours).padStart(2, '0');
  document.getElementById('current-time').textContent = `${hoursStr}:${minutes}:${seconds} ${ampm}`;
}

function updateMemoryUsage() {
  if (performance.memory) {
    const usedMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(1);
    document.getElementById('memory-usage').textContent = `${usedMB} MB`;
  } else {
    document.getElementById('memory-usage').textContent = 'N/A';
  }
}

detectDevice();
setInterval(updateClock, 1000);
setInterval(updateMemoryUsage, 2000);
updateClock();
updateMemoryUsage();

// ============================================
// PARTICLE SYSTEM
// ============================================

function createParticles() {
  const particlesContainer = document.getElementById('particles');
  const particleCount = 30;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    
    const size = Math.random() * 3 + 1;
    const left = Math.random() * 100;
    const duration = Math.random() * 20 + 15;
    const delay = Math.random() * 10;
    const drift = (Math.random() - 0.5) * 200;
    
    particle.style.cssText = `
      width: ${size}px;
      height: ${size}px;
      left: ${left}%;
      --drift: ${drift}px;
      animation-duration: ${duration}s;
      animation-delay: ${delay}s;
    `;
    
    particlesContainer.appendChild(particle);
  }
}

createParticles();

// ============================================
// BADGE SYSTEM
// ============================================

const BADGES = [
  { id: 'first_login', name: 'Welcome!', desc: 'Logged in for the first time', icon: 'üëã', condition: () => window.myName !== null },
  { id: 'coin_collector', name: 'Coin Collector', desc: 'Earned 100 Nova Coins', icon: 'ü™ô', condition: () => novaCoins >= 100 },
  { id: 'social_butterfly', name: 'Social Butterfly', desc: 'Added 5 friends', icon: 'ü¶ã', condition: () => myFriends.length >= 5 },
  { id: 'game_master', name: 'Game Master', desc: 'Played 10 different games', icon: 'üéÆ', condition: () => (JSON.parse(localStorage.getItem('played_games') || '[]')).length >= 10 },
  { id: 'movie_buff', name: 'Movie Buff', desc: 'Watched 5 movies', icon: 'üé¨', condition: () => (JSON.parse(localStorage.getItem('watched_movies') || '[]')).length >= 5 },
  { id: 'chat_champion', name: 'Chat Champion', desc: 'Sent 100 messages', icon: 'üí¨', condition: () => parseInt(localStorage.getItem('message_count') || '0') >= 100 },
  { id: 'early_bird', name: 'Early Bird', desc: 'Claimed 7 daily rewards', icon: 'üåÖ', condition: () => parseInt(localStorage.getItem('daily_streak') || '0') >= 7 },
  { id: 'customizer', name: 'Customizer', desc: 'Changed your profile picture', icon: 'üé®', condition: () => localStorage.getItem('pfp_changed') === 'true' },
  { id: 'shopaholic', name: 'Shopaholic', desc: 'Made your first purchase', icon: 'üõçÔ∏è', condition: () => purchasedGames.length > 0 },
  { id: 'mega_rich', name: 'Mega Rich', desc: 'Have 500 Nova Coins', icon: 'üí∞', condition: () => novaCoins >= 500 }
];

function loadBadges() {
  const earned = JSON.parse(localStorage.getItem('earned_badges') || '[]');
  const container = document.getElementById('badges-container');
  
  container.innerHTML = '';
  
  BADGES.forEach(badge => {
    const isEarned = earned.includes(badge.id);
    const div = document.createElement('div');
    div.className = `badge-item ${isEarned ? 'earned' : 'locked'}`;
    div.innerHTML = `
      <div class="badge-icon">${badge.icon}</div>
      <div class="badge-info">
        <div class="badge-name">${badge.name}</div>
        <div class="badge-desc">${badge.desc}</div>
      </div>
      ${isEarned ? '<div class="badge-checkmark">‚úì</div>' : ''}
    `;
    container.appendChild(div);
  });
}

function checkBadges() {
  const earned = JSON.parse(localStorage.getItem('earned_badges') || '[]');
  let newBadges = [];
  
  BADGES.forEach(badge => {
    if (!earned.includes(badge.id) && badge.condition()) {
      earned.push(badge.id);
      newBadges.push(badge);
    }
  });
  
  if (newBadges.length > 0) {
    localStorage.setItem('earned_badges', JSON.stringify(earned));
    newBadges.forEach(badge => {
      showNotification(`üéâ Badge Earned: ${badge.name}!`, 'success');
    });
    loadBadges();
  }
}

setInterval(checkBadges, 5000);

// ============================================
// NOVA COINS SYSTEM
// ============================================

let novaCoins = 0;
let purchasedGames = [];
let coinEarningInterval = null;

const COIN_EARN_RATE = 1;
const COIN_EARN_INTERVAL = 60000;

function loadCoinData() {
  if (!window.myName) return;
  
  db.ref("users/" + window.myName + "/coins").on("value", (snap) => {
    novaCoins = snap.val() || 0;
    updateCoinDisplay();
  });
  
  db.ref("users/" + window.myName + "/purchasedGames").on("value", (snap) => {
    purchasedGames = snap.val() || [];
    updatePurchasedItems();
  });
}

function updateCoinDisplay() {
  document.getElementById('coin-count').textContent = novaCoins;
}

function addCoins(amount) {
  if (!window.myName) return;
  
  novaCoins += amount;
  db.ref("users/" + window.myName + "/coins").set(novaCoins);
  updateCoinDisplay();
}

function startCoinEarning() {
  if (coinEarningInterval) return;
  
  coinEarningInterval = setInterval(() => {
    if (window.myName) {
      addCoins(COIN_EARN_RATE);
      if (notificationFrequency === 'all') {
        showNotification(`+${COIN_EARN_RATE} Nova Coin earned!`, 'success');
      }
    }
  }, COIN_EARN_INTERVAL);
}

function stopCoinEarning() {
  if (coinEarningInterval) {
    clearInterval(coinEarningInterval);
    coinEarningInterval = null;
  }
}

// ============================================
// DAILY REWARD SYSTEM
// ============================================

function checkDailyReward() {
  if (!window.myName) return;
  
  const lastClaim = localStorage.getItem('last_daily_claim');
  const today = new Date().toDateString();
  
  if (lastClaim !== today) {
    const streak = parseInt(localStorage.getItem('daily_streak') || '0') + 1;
    localStorage.setItem('daily_streak', streak);
    localStorage.setItem('last_daily_claim', today);
    
    const reward = 5;
    addCoins(reward);
    
    document.getElementById('rewardModal').style.display = 'flex';
  }
}

function closeRewardModal() {
  document.getElementById('rewardModal').style.display = 'none';
}

// ============================================
// SHOP SYSTEM
// ============================================

const SHOP_ITEMS = [
  { id: 'minecraft', name: 'Minecraft', price: 50, url: 'https://jeremyryanknight2012.github.io/My-Website/games/minecraft.html', thumb: 'https://jeremyryanknight2012.github.io/My-Website/thumbnails/minecraft.png' },
  { id: 'doom', name: 'DOOM', price: 30, url: 'https://jeremyryanknight2012.github.io/My-Website/games/doom.html', thumb: 'https://jeremyryanknight2012.github.io/My-Website/thumbnails/doom.png' },
  { id: 'portal', name: 'Portal', price: 40, url: 'https://jeremyryanknight2012.github.io/My-Website/games/portal.html', thumb: 'https://jeremyryanknight2012.github.io/My-Website/thumbnails/portal.png' },
  { id: 'gta5', name: 'GTA V', price: 75, url: 'https://jeremyryanknight2012.github.io/My-Website/games/gta5.html', thumb: 'https://jeremyryanknight2012.github.io/My-Website/thumbnails/gta5.png' }
];

function renderShop() {
  const scroller = document.getElementById('shopScroller');
  scroller.innerHTML = '';
  
  SHOP_ITEMS.forEach(item => {
    const isPurchased = purchasedGames.includes(item.id);
    const card = document.createElement('div');
    card.className = 'game-card';
    card.innerHTML = `
      <img src="${item.thumb}" alt="${item.name}">
      <div class="game-title">${item.name}</div>
      <div class="game-price">${item.price} ü™ô</div>
      <button class="btn" onclick="${isPurchased ? `playGame('${item.url}', '${item.name}')` : `purchaseGame('${item.id}')`}" 
              ${!isPurchased && novaCoins < item.price ? 'disabled' : ''}>
        ${isPurchased ? 'Play' : 'Purchase'}
      </button>
    `;
    scroller.appendChild(card);
  });
}

function purchaseGame(gameId) {
  if (!window.myName) {
    showNotification('Please login to purchase!', 'warning');
    return;
  }
  
  const item = SHOP_ITEMS.find(i => i.id === gameId);
  if (!item) return;
  
  if (novaCoins < item.price) {
    showNotification('Not enough Nova Coins!', 'error');
    return;
  }
  
  novaCoins -= item.price;
  purchasedGames.push(gameId);
  
  db.ref("users/" + window.myName + "/coins").set(novaCoins);
  db.ref("users/" + window.myName + "/purchasedGames").set(purchasedGames);
  
  showNotification(`${item.name} purchased!`, 'success');
  renderShop();
}

function updatePurchasedItems() {
  const container = document.getElementById('purchasedItems');
  
  if (purchasedGames.length === 0) {
    container.innerHTML = '<p class="empty">You haven\'t purchased anything yet...</p>';
    return;
  }
  
  container.innerHTML = '<div class="scroller"></div>';
  const scroller = container.querySelector('.scroller');
  
  purchasedGames.forEach(gameId => {
    const item = SHOP_ITEMS.find(i => i.id === gameId);
    if (!item) return;
    
    const card = document.createElement('div');
    card.className = 'game-card';
    card.innerHTML = `
      <img src="${item.thumb}" alt="${item.name}">
      <div class="game-title">${item.name}</div>
      <button class="btn" onclick="playGame('${item.url}', '${item.name}')">Play</button>
    `;
    scroller.appendChild(card);
  });
}

// ============================================
// RECENTLY PLAYED SYSTEM
// ============================================

function trackRecentlyPlayed(gameId, name, url, thumb) {
  let recent = JSON.parse(localStorage.getItem('recently_played') || '[]');
  
  recent = recent.filter(g => g.id !== gameId);
  recent.unshift({ id: gameId, name, url, thumb, lastPlayed: Date.now() });
  recent = recent.slice(0, 6);
  
  localStorage.setItem('recently_played', JSON.stringify(recent));
  loadRecentlyPlayed();
}

function loadRecentlyPlayed() {
  const recent = JSON.parse(localStorage.getItem('recently_played') || '[]');
  const scroller = document.getElementById('recentlyPlayedScroller');
  
  if (recent.length === 0) {
    scroller.innerHTML = '<p class="empty">No recently played games</p>';
    return;
  }
  
  scroller.innerHTML = '';
  recent.forEach(game => {
    const card = document.createElement('div');
    card.className = 'game-card';
    card.onclick = () => playGame(game.url, game.name);
    card.innerHTML = `
      <img src="${game.thumb}" alt="${game.name}">
      <div class="game-title">${game.name}</div>
    `;
    scroller.appendChild(card);
  });
}

// ============================================
// USER DATA
// ============================================

function loadUserData() {
  const username = localStorage.getItem("nexus_user");
  if (username) {
    document.getElementById('username').textContent = username;
  }
}

// ============================================
// PAGE NAVIGATION
// ============================================

function showPage(pageId) {
  document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
  const targetPage = document.getElementById(pageId);
  if (targetPage) {
    targetPage.classList.add('active');
  }
  
  document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
  const navLink = document.querySelector(`.nav a[data-page="${pageId}"]`);
  if (navLink) navLink.classList.add('active');

  if (pageId === 'chat' && window.myName) {
    setupChat();
  } else if (pageId === 'profile') {
    loadProfile();
  } else if (pageId === 'shop') {
    renderShop();
  } else if (pageId === 'achievements') {
    checkDailyReward();
  }
}

window.addEventListener('load', () => {
  loadSettings();
  loadUserData();
  loadBadges();
  
  // Set up navigation click handlers
  document.querySelectorAll('.nav a').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const page = link.dataset.page;
      if (page) {
        window.location.hash = page;
        showPage(page);
      }
    });
  });
  
  const hash = window.location.hash.substring(1);
  if (hash && document.getElementById(hash)) {
    showPage(hash);
  } else {
    showPage('home');
  }
  
  const storedUsername = localStorage.getItem("nexus_user");
  if (storedUsername) {
    db.ref("users/" + storedUsername).once("value", (snap) => {
      if (snap.exists()) {
        window.myName = storedUsername;
        updateProfileDisplay();
        loadCoinData();
        startCoinEarning();
      }
    });
  }
  
  checkDailyReward();
  setInterval(checkDailyReward, 60000);
});

// ============================================
// GAMES DATA WITH CATEGORIES
// ============================================

const TOP_GAMES = [
  { id:"roblox", name:"Roblox", url:"https://jeremyryanknight2012.github.io/My-Website/games/roblox.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/roblox.png", category:"adventure" },
  { id:"1v1lol", name:"1v1.LOL", url:"https://jeremyryanknight2012.github.io/My-Website/games/1v1lol.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/1v1lol.png", category:"action" },
  { id:"retrobowl", name:"Retro Bowl", url:"https://jeremyryanknight2012.github.io/My-Website/games/retrobowl.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/retrobowl.png", category:"sports" },
  { id:"ultrakill", name:"Ultrakill", url:"https://jeremyryanknight2012.github.io/My-Website/games/ultrakill.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/ultrakill.png", category:"action" }
];

const ALL_GAMES = [
  { id:"2playerbattle", name:"2 Player Battle", url:"https://turbowarp.org/292728003/embed", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/2playerbattle.png", category:"action" },
  { id:"3dtuning", name:"3D Tuning", url:"https://www.3dtuning.com/en-US/", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/3dtuning.png", category:"puzzle" },
  { id:"10minutestilldawn", name:"10 Minutes Till Dawn", url:"https://jeremyryanknight2012.github.io/My-Website/games/10minutestilldawn.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/10minutestilldawn.png", category:"action" },
  { id:"amongus", name:"Among Us", url:"https://jeremyryanknight2012.github.io/My-Website/games/amongus.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/amongus.png", category:"puzzle" },
  { id:"armedforces", name:"Armed Forces", url:"https://jeremyryanknight2012.github.io/My-Website/games/armedforces.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/armedforces.png", category:"action" },
  { id:"badparenting", name:"Bad Parenting", url:"https://jeremyryanknight2012.github.io/My-Website/games/badparenting.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/badparenting.png", category:"horror" },
  { id:"balatro", name:"Balatro", url:"https://jeremyryanknight2012.github.io/My-Website/games/balatro.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/balatro.png", category:"puzzle" },
  { id:"bankrobbery2", name:"Bank Robbery 2", url:"https://jeremyryanknight2012.github.io/My-Website/games/bankrobbery2.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/bankrobbery2.png", category:"action" },
  { id:"baseballbros", name:"Baseball Bros", url:"https://jeremyryanknight2012.github.io/My-Website/games/baseballbros.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/baseballbros.png", category:"sports" },
  { id:"basketbros", name:"Basket Bros", url:"https://jeremyryanknight2012.github.io/My-Website/games/basketbros.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/basketbros.png", category:"sports" },
  { id:"basketrandom", name:"Basket Random", url:"https://jeremyryanknight2012.github.io/My-Website/games/basketrandom.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/basketrandom.png", category:"sports" },
  { id:"bendyandtheinkmachine", name:"Bendy and the Ink Machine", url:"https://jeremyryanknight2012.github.io/My-Website/games/bendy.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/bendy.png", category:"horror" },
  { id:"bitlife", name:"BitLife", url:"https://jeremyryanknight2012.github.io/My-Website/games/bitlife.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/bitlife.png", category:"puzzle" },
  { id:"bloxorz", name:"Bloxorz", url:"https://jeremyryanknight2012.github.io/My-Website/games/bloxorz.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/bloxorz.png", category:"puzzle" },
  { id:"blumgi", name:"Blumgi", url:"https://jeremyryanknight2012.github.io/My-Website/games/blumgi.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/blumgi.png", category:"action" },
  { id:"bonzibuddy", name:"Bonzi Buddy", url:"https://jeremyryanknight2012.github.io/My-Website/games/bonzibuddy.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/bonzibuddy.png", category:"other" },
  { id:"boxingrandom", name:"Boxing Random", url:"https://jeremyryanknight2012.github.io/My-Website/games/boxingrandom.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/boxingrandom.png", category:"sports" },
  { id:"burritobison", name:"Burrito Bison", url:"https://jeremyryanknight2012.github.io/My-Website/games/burritobison.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/burritobison.png", category:"action" },
  { id:"cats", name:"CATS", url:"https://jeremyryanknight2012.github.io/My-Website/games/cats.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/cats.png", category:"action" },
  { id:"chromedino", name:"Chrome Dino", url:"https://jeremyryanknight2012.github.io/My-Website/games/chromedino.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/chromedino.png", category:"action" },
  { id:"cluster", name:"Cluster Rush", url:"https://jeremyryanknight2012.github.io/My-Website/games/clusterrush.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/clusterrush.png", category:"action" },
  { id:"cookieclicker", name:"Cookie Clicker", url:"https://jeremyryanknight2012.github.io/My-Website/games/cookieclicker.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/cookieclicker.png", category:"puzzle" },
  { id:"csgo", name:"CS:GO", url:"https://jeremyryanknight2012.github.io/My-Website/games/csgo.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/csgo.png", category:"action" },
  { id:"cubefield", name:"Cubefield", url:"https://jeremyryanknight2012.github.io/My-Website/games/cubefield.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/cubefield.png", category:"action" },
  { id:"cupcake", name:"2048 Cupcakes", url:"https://jeremyryanknight2012.github.io/My-Website/games/cupcake.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/cupcake.png", category:"puzzle" },
  { id:"demonfall", name:"Demonfall", url:"https://jeremyryanknight2012.github.io/My-Website/games/demonfall.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/demonfall.png", category:"adventure" },
  { id:"dogeminer", name:"Doge Miner", url:"https://jeremyryanknight2012.github.io/My-Website/games/dogeminer.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/dogeminer.png", category:"puzzle" },
  { id:"doodle", name:"Doodle Jump", url:"https://jeremyryanknight2012.github.io/My-Website/games/doodlejump.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/doodlejump.png", category:"action" },
  { id:"driftboss", name:"Drift Boss", url:"https://jeremyryanknight2012.github.io/My-Website/games/driftboss.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/driftboss.png", category:"action" },
  { id:"drifthunters", name:"Drift Hunters", url:"https://jeremyryanknight2012.github.io/My-Website/games/drifthunters.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/drifthunters.png", category:"action" },
  { id:"drivemad", name:"Drive Mad", url:"https://jeremyryanknight2012.github.io/My-Website/games/drivemad.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/drivemad.png", category:"action" },
  { id:"ducklife", name:"Duck Life", url:"https://jeremyryanknight2012.github.io/My-Website/games/ducklife.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/ducklife.png", category:"adventure" },
  { id:"ducklife2", name:"Duck Life 2", url:"https://jeremyryanknight2012.github.io/My-Website/games/ducklife2.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/ducklife2.png", category:"adventure" },
  { id:"ducklife3", name:"Duck Life 3", url:"https://jeremyryanknight2012.github.io/My-Website/games/ducklife3.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/ducklife3.png", category:"adventure" },
  { id:"ducklife4", name:"Duck Life 4", url:"https://jeremyryanknight2012.github.io/My-Website/games/ducklife4.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/ducklife4.png", category:"adventure" },
  { id:"edgesurf", name:"Edge Surf", url:"https://jeremyryanknight2012.github.io/My-Website/games/edgesurf.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/edgesurf.png", category:"action" },
  { id:"eggycar", name:"Eggy Car", url:"https://jeremyryanknight2012.github.io/My-Website/games/eggycar.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/eggycar.png", category:"action" },
  { id:"emulatorjs", name:"Emulator JS", url:"https://jeremyryanknight2012.github.io/My-Website/games/emulatorjs.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/emulatorjs.png", category:"other" },
  { id:"factoryballsforever", name:"Factory Balls Forever", url:"https://jeremyryanknight2012.github.io/My-Website/games/factoryballsforever.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/factoryballsforever.png", category:"puzzle" },
  { id:"fallguyster", name:"Fall Guyster", url:"https://jeremyryanknight2012.github.io/My-Website/games/fallguyster.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fallguyster.png", category:"action" },
  { id:"farmmerge", name:"Farm Merge Valley", url:"https://jeremyryanknight2012.github.io/My-Website/games/farmmergevalley.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/farmmergevalley.png", category:"puzzle" },
  { id:"fifa23", name:"FIFA 23", url:"https://jeremyryanknight2012.github.io/My-Website/games/fifa23.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fifa23.png", category:"sports" },
  { id:"flappybird", name:"Flappy Bird", url:"https://jeremyryanknight2012.github.io/My-Website/games/flappybird.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/flappybird.png", category:"action" },
  { id:"fnaf", name:"Five Nights at Freddy's", url:"https://jeremyryanknight2012.github.io/My-Website/games/fnaf.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fnaf.png", category:"horror" },
  { id:"fnaf2", name:"Five Nights at Freddy's 2", url:"https://jeremyryanknight2012.github.io/My-Website/games/fnaf2.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fnaf2.png", category:"horror" },
  { id:"fnaf3", name:"Five Nights at Freddy's 3", url:"https://jeremyryanknight2012.github.io/My-Website/games/fnaf3.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fnaf3.png", category:"horror" },
  { id:"fnaf4", name:"Five Nights at Freddy's 4", url:"https://jeremyryanknight2012.github.io/My-Website/games/fnaf4.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fnaf4.png", category:"horror" },
  { id:"football", name:"Football Legends", url:"https://jeremyryanknight2012.github.io/My-Website/games/footballlegends.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/footballlegends.png", category:"sports" },
  { id:"fortnite", name:"Fortnite", url:"https://jeremyryanknight2012.github.io/My-Website/games/fortnite.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fortnite.png", category:"action" },
  { id:"freezenova", name:"Freeze Nova", url:"https://jeremyryanknight2012.github.io/My-Website/games/freezenova.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/freezenova.png", category:"other" },
  { id:"fruitninja", name:"Fruit Ninja", url:"https://jeremyryanknight2012.github.io/My-Website/games/fruitninja.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/fruitninja.png", category:"action" },
  { id:"geometrydash", name:"Geometry Dash", url:"https://jeremyryanknight2012.github.io/My-Website/games/geometrydash.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/geometrydash.png", category:"action" },
  { id:"getaway", name:"Getaway Shootout", url:"https://jeremyryanknight2012.github.io/My-Website/games/getawayshootout.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/getawayshootout.png", category:"action" },
  { id:"googlesnake", name:"Google Snake", url:"https://jeremyryanknight2012.github.io/My-Website/games/googlesnake.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/googlesnake.png", category:"puzzle" },
  { id:"grannyshouse", name:"Granny's House", url:"https://jeremyryanknight2012.github.io/My-Website/games/grannyshouse.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/grannyshouse.png", category:"horror" },
  { id:"happywheels", name:"Happy Wheels", url:"https://jeremyryanknight2012.github.io/My-Website/games/happywheels.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/happywheels.png", category:"action" },
  { id:"hillclimb", name:"Hill Climb Racing", url:"https://jeremyryanknight2012.github.io/My-Website/games/hillclimbracing.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/hillclimbracing.png", category:"action" },
  { id:"holeio", name:"Hole.io", url:"https://jeremyryanknight2012.github.io/My-Website/games/holeio.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/holeio.png", category:"action" },
  { id:"impossiblequiz", name:"The Impossible Quiz", url:"https://jeremyryanknight2012.github.io/My-Website/games/impossiblequiz.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/impossiblequiz.png", category:"puzzle" },
  { id:"jetpackjoyride", name:"Jetpack Joyride", url:"https://jeremyryanknight2012.github.io/My-Website/games/jetpackjoyride.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/jetpackjoyride.png", category:"action" },
  { id:"krunker", name:"Krunker", url:"https://jeremyryanknight2012.github.io/My-Website/games/krunker.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/krunker.png", category:"action" },
  { id:"learntofly", name:"Learn to Fly", url:"https://jeremyryanknight2012.github.io/My-Website/games/learntofly.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/learntofly.png", category:"action" },
  { id:"madalin", name:"Madalin Stunt Cars", url:"https://jeremyryanknight2012.github.io/My-Website/games/madalinstuntcars.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/madalinstuntcars.png", category:"action" },
  { id:"minesweeper", name:"Minesweeper", url:"https://jeremyryanknight2012.github.io/My-Website/games/minesweeper.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/minesweeper.png", category:"puzzle" },
  { id:"monkeymart", name:"Monkey Mart", url:"https://jeremyryanknight2012.github.io/My-Website/games/monkeymart.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/monkeymart.png", category:"puzzle" },
  { id:"moomooio", name:"MooMoo.io", url:"https://jeremyryanknight2012.github.io/My-Website/games/moomooio.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/moomooio.png", category:"action" },
  { id:"motox3m", name:"Moto X3M", url:"https://jeremyryanknight2012.github.io/My-Website/games/motox3m.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/motox3m.png", category:"action" },
  { id:"mountainbikerider", name:"Mountain Bike Rider", url:"https://jeremyryanknight2012.github.io/My-Website/games/mountainbikerider.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/mountainbikerider.png", category:"sports" },
  { id:"neonbricks", name:"Neon Bricks", url:"https://jeremyryanknight2012.github.io/My-Website/games/neonbricks.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/neonbricks.png", category:"puzzle" },
  { id:"obstacletower", name:"Obstacle Tower", url:"https://jeremyryanknight2012.github.io/My-Website/games/obstacletower.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/obstacletower.png", category:"action" },
  { id:"ovo", name:"OvO", url:"https://jeremyryanknight2012.github.io/My-Website/games/ovo.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/ovo.png", category:"action" },
  { id:"pacman", name:"Pac-Man", url:"https://jeremyryanknight2012.github.io/My-Website/games/pacman.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/pacman.png", category:"action" },
  { id:"papasburgeria", name:"Papa's Burgeria", url:"https://jeremyryanknight2012.github.io/My-Website/games/papasburgeria.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/papasburgeria.png", category:"puzzle" },
  { id:"papaspizzeria", name:"Papa's Pizzeria", url:"https://jeremyryanknight2012.github.io/My-Website/games/papaspizzeria.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/papaspizzeria.png", category:"puzzle" },
  { id:"paperio", name:"Paper.io", url:"https://jeremyryanknight2012.github.io/My-Website/games/paperio.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/paperio.png", category:"action" },
  { id:"parachute", name:"Parachute", url:"https://jeremyryanknight2012.github.io/My-Website/games/parachute.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/parachute.png", category:"action" },
  { id:"parkourrace", name:"Parkour Race", url:"https://jeremyryanknight2012.github.io/My-Website/games/parkourrace.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/parkourrace.png", category:"action" },
  { id:"penaltyshootout", name:"Penalty Shootout", url:"https://jeremyryanknight2012.github.io/My-Website/games/penaltyshootout.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/penaltyshootout.png", category:"sports" },
  { id:"pong", name:"Pong", url:"https://jeremyryanknight2012.github.io/My-Website/games/pong.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/pong.png", category:"action" },
  { id:"poppy", name:"Project Playtime", url:"https://jeremyryanknight2012.github.io/My-Website/games/projectplaytime.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/projectplaytime.png", category:"horror" },
  { id:"powerline", name:"Powerline.io", url:"https://jeremyryanknight2012.github.io/My-Website/games/powerlineio.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/powerlineio.png", category:"action" },
  { id:"railrush", name:"Rail Rush", url:"https://jeremyryanknight2012.github.io/My-Website/games/railrush.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/railrush.png", category:"action" },
  { id:"riddle", name:"Riddle School", url:"https://jeremyryanknight2012.github.io/My-Website/games/riddleschool.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/riddleschool.png", category:"puzzle" },
  { id:"run3", name:"Run 3", url:"https://jeremyryanknight2012.github.io/My-Website/games/run3.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/run3.png", category:"action" },
  { id:"shellshockers", name:"Shell Shockers", url:"https://jeremyryanknight2012.github.io/My-Website/games/shellshockers.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/shellshockers.png", category:"action" },
  { id:"skiing", name:"Skiing Fred", url:"https://jeremyryanknight2012.github.io/My-Website/games/skiingfred.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/skiingfred.png", category:"action" },
  { id:"slicemaster", name:"Slice Master", url:"https://jeremyryanknight2012.github.io/My-Website/games/slicemaster.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/slicemaster.png", category:"puzzle" },
  { id:"slitherio", name:"Slither.io", url:"https://jeremyryanknight2012.github.io/My-Website/games/slitherio.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/slitherio.png", category:"action" },
  { id:"slopegame", name:"Slope", url:"https://jeremyryanknight2012.github.io/My-Website/games/slopegame.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/slopegame.png", category:"action" },
  { id:"smashhit", name:"Smash Hit", url:"https://jeremyryanknight2012.github.io/My-Website/games/smashhit.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/smashhit.png", category:"action" },
  { id:"smashkarts", name:"Smash Karts", url:"https://jeremyryanknight2012.github.io/My-Website/games/smashkarts.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/smashkarts.png", category:"action" },
  { id:"sonicgame", name:"Sonic the Hedgehog", url:"https://jeremyryanknight2012.github.io/My-Website/games/sonicgame.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/sonicgame.png", category:"action" },
  { id:"soulknight", name:"Soul Knight", url:"https://jeremyryanknight2012.github.io/My-Website/games/soulknight.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/soulknight.png", category:"action" },
  { id:"spaceinvaders", name:"Space Invaders", url:"https://jeremyryanknight2012.github.io/My-Website/games/spaceinvaders.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/spaceinvaders.png", category:"action" },
  { id:"stacktris", name:"Stacktris", url:"https://jeremyryanknight2012.github.io/My-Website/games/stacktris.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/stacktris.png", category:"puzzle" },
  { id:"stealhero", name:"Steal Hero", url:"https://jeremyryanknight2012.github.io/My-Website/games/stealhero.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/stealhero.png", category:"puzzle" },
  { id:"stickman", name:"Stickman Hook", url:"https://jeremyryanknight2012.github.io/My-Website/games/stickmanhook.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/stickmanhook.png", category:"action" },
  { id:"stumbleguys", name:"Stumble Guys", url:"https://jeremyryanknight2012.github.io/My-Website/games/stumbleguys.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/stumbleguys.png", category:"action" },
  { id:"subwaysurfers", name:"Subway Surfers", url:"https://jeremyryanknight2012.github.io/My-Website/games/subwaysurfers.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/subwaysurfers.png", category:"action" },
  { id:"suikagame", name:"Suika Game", url:"https://jeremyryanknight2012.github.io/My-Website/games/suikagame.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/suikagame.png", category:"puzzle" },
  { id:"superhot", name:"Superhot", url:"https://jeremyryanknight2012.github.io/My-Website/games/superhot.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/superhot.png", category:"action" },
  { id:"temple", name:"Temple Run 2", url:"https://jeremyryanknight2012.github.io/My-Website/games/templerun2.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/templerun2.png", category:"action" },
  { id:"tetris", name:"Tetris", url:"https://jeremyryanknight2012.github.io/My-Website/games/tetris.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/tetris.png", category:"puzzle" },
  { id:"thereisnogame", name:"There Is No Game", url:"https://jeremyryanknight2012.github.io/My-Website/games/thereisnogame.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/thereisnogame.png", category:"puzzle" },
  { id:"tilemaster", name:"Tile Master", url:"https://jeremyryanknight2012.github.io/My-Website/games/tilemaster.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/tilemaster.png", category:"puzzle" },
  { id:"timberman", name:"Timberman", url:"https://jeremyryanknight2012.github.io/My-Website/games/timberman.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/timberman.png", category:"action" },
  { id:"tiny", name:"Tiny Fishing", url:"https://jeremyryanknight2012.github.io/My-Website/games/tinyfishing.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/tinyfishing.png", category:"puzzle" },
  { id:"tower", name:"Tower Defense", url:"https://jeremyryanknight2012.github.io/My-Website/games/towerdefense.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/towerdefense.png", category:"action" },
  { id:"tunnelrush", name:"Tunnel Rush", url:"https://jeremyryanknight2012.github.io/My-Website/games/tunnelrush.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/tunnelrush.png", category:"action" },
  { id:"vexgame", name:"Vex", url:"https://jeremyryanknight2012.github.io/My-Website/games/vexgame.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/vexgame.png", category:"action" },
  { id:"volleyrandom", name:"Volley Random", url:"https://jeremyryanknight2012.github.io/My-Website/games/volleyrandom.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/volleyrandom.png", category:"sports" },
  { id:"wrestlingrandom", name:"Wrestling Random", url:"https://jeremyryanknight2012.github.io/My-Website/games/wrestlingrandom.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/wrestlingrandom.png", category:"sports" },
  { id:"zombsroyale", name:"Zombs Royale", url:"https://jeremyryanknight2012.github.io/My-Website/games/zombsroyale.html", thumb:"https://jeremyryanknight2012.github.io/My-Website/thumbnails/zombsroyale.png", category:"action" }
];

const CATEGORIES = ["all", "action", "adventure", "sports", "puzzle", "horror", "other"];

// ============================================
// GAMES PAGE FUNCTIONS
// ============================================

function loadTopGames() {
  const scroller = document.getElementById('topGamesScroller');
  scroller.innerHTML = '';
  TOP_GAMES.forEach((game) => {
    const card = createGameCard(game);
    scroller.appendChild(card);
  });
}

function loadAllGames(filter = "") {
  const scroller = document.getElementById('allGamesScroller');
  const empty = document.getElementById('gamesEmpty');
  scroller.innerHTML = '';
  
  const filtered = ALL_GAMES.filter(g => 
    g.name.toLowerCase().includes(filter.toLowerCase())
  );
  
  if (filtered.length === 0) {
    empty.style.display = 'block';
    scroller.style.display = 'none';
  } else {
    empty.style.display = 'none';
    scroller.style.display = 'grid';
    filtered.forEach((game) => {
      const card = createGameCard(game);
      scroller.appendChild(card);
    });
  }
}

function loadCategoryGames() {
  const container = document.getElementById('categoryGames');
  container.innerHTML = '';
  
  CATEGORIES.forEach(cat => {
    const categoryRow = document.createElement('div');
    categoryRow.className = 'row';
    categoryRow.innerHTML = `
      <div class="row-title">${cat.charAt(0).toUpperCase() + cat.slice(1)}</div>
      <div class="scroller" id="scroller-${cat}"></div>
    `;
    container.appendChild(categoryRow);
    
    const scroller = document.getElementById(`scroller-${cat}`);
    const games = cat === 'all' ? ALL_GAMES : ALL_GAMES.filter(g => g.category === cat);
    
    games.slice(0, 10).forEach(game => {
      scroller.appendChild(createGameCard(game));
    });
  });
}

function createGameCard(game) {
  const card = document.createElement('div');
  card.className = 'game-card';
  card.onclick = () => playGame(game.url, game.name);
  card.innerHTML = `
    <img src="${game.thumb}" alt="${game.name}">
    <div class="game-title">${game.name}</div>
  `;
  return card;
}

function searchGames() {
  const query = document.getElementById('games-search').value;
  loadAllGames(query);
}

function clearSearch() {
  document.getElementById('games-search').value = '';
  loadAllGames();
}

document.addEventListener('DOMContentLoaded', () => {
  loadTopGames();
  loadAllGames();
  loadRecentlyPlayed();
});

// ============================================
// MOVIES DATA
// ============================================

const MOVIES = [
  { name: "Terrifier 1", url: "https://www.2embed.cc/embed/8003", thumb: "https://m.media-amazon.com/images/M/MV5BYjk4MTg2MjYtMGZlMS00MTY5LWFlNjctNzY3OTVhY2RlZTM3XkEyXkFqcGc@._V1_.jpg" },
  { name: "Terrifier 2", url: "https://www.2embed.cc/embed/663712", thumb: "https://m.media-amazon.com/images/M/MV5BYWM2Mjg0Y2EtNTNlZS00NzNkLWJkNmMtNGM5YzM5ZjlhNGNlXkEyXkFqcGc@._V1_FMjpg_UX1000_.jpg" },
  { name: "Terrifier 3", url: "https://www.2embed.cc/embed/1034541", thumb: "https://m.media-amazon.com/images/M/MV5BYjM3MmRiNDItNmY5MC00YTY5LWI1YjMtYjdlMGRjMTIxNjhjXkEyXkFqcGc@._V1_.jpg" },
  { name: "Venom 3", url: "https://www.2embed.cc/embed/912649", thumb: "https://m.media-amazon.com/images/M/MV5BZDMyYWU4NzItZDY0MC00ODE2LTkyYTMtMzNkNDdmYmFhZDg0XkEyXkFqcGc@._V1_.jpg" },
  { name: "Deadpool 3", url: "https://www.2embed.cc/embed/533535", thumb: "https://m.media-amazon.com/images/M/MV5BZTk5ODY0MmQtMzA3Ni00NGY1LThiYzItZThiNjFiNDM4MTM3XkEyXkFqcGc@._V1_.jpg" },
  { name: "Moana 2", url: "https://www.2embed.cc/embed/1184918", thumb: "https://upload.wikimedia.org/wikipedia/en/7/74/Moana_2_poster.jpg" },
  { name: "Wicked", url: "https://www.2embed.cc/embed/402431", thumb: "https://upload.wikimedia.org/wikipedia/en/3/35/Wicked_2024_poster.jpg" },
  { name: "Mufasa", url: "https://www.2embed.cc/embed/762509", thumb: "https://upload.wikimedia.org/wikipedia/en/6/62/Mufasa_The_Lion_King_poster.jpg" },
  { name: "Sonic 3", url: "https://www.2embed.cc/embed/939335", thumb: "https://upload.wikimedia.org/wikipedia/en/a/a2/Sonic_the_Hedgehog_3_poster.jpg" },
  { name: "Spiderman: No Way Home", url: "https://www.2embed.cc/embed/634649", thumb: "https://m.media-amazon.com/images/M/MV5BMmFiZGZjMmEtMTA0Ni00MzA2LTljMTYtZGI2MGJmZWYzZTQ2XkEyXkFqcGc@._V1_.jpg" },
  { name: "Avengers: Endgame", url: "https://www.2embed.cc/embed/299534", thumb: "https://m.media-amazon.com/images/M/MV5BMTc5MDE2ODcwNV5BMl5BanBnXkFtZTgwMzI2NzQ2NzM@._V1_.jpg" },
  { name: "The Batman", url: "https://www.2embed.cc/embed/414906", thumb: "https://m.media-amazon.com/images/M/MV5BOGE2NWUwMDItMjA4Yi00N2Y3LWJjMzEtMDJjZTMzZTdlZGE5XkEyXkFqcGc@._V1_.jpg" },
  { name: "Joker", url: "https://www.2embed.cc/embed/475557", thumb: "https://m.media-amazon.com/images/M/MV5BN2JmMjViNTYtZjg2Yi00YzQ5LWE5NGUtNWZiNTE4ZDI4NzhiXkEyXkFqcGc@._V1_.jpg" },
  { name: "The Dark Knight", url: "https://www.2embed.cc/embed/155", thumb: "https://m.media-amazon.com/images/M/MV5BMTMxNTMwODM0NF5BMl5BanBnXkFtZTcwODAyMTk2Mw@@._V1_.jpg" },
  { name: "Inception", url: "https://www.2embed.cc/embed/27205", thumb: "https://m.media-amazon.com/images/M/MV5BMjAxMzY3NjcxNF5BMl5BanBnXkFtZTcwNTI5OTM0Mw@@._V1_.jpg" },
  { name: "Interstellar", url: "https://www.2embed.cc/embed/157336", thumb: "https://m.media-amazon.com/images/M/MV5BYzdjMDAxZGItMjI2My00ODA1LTlkNzItOWFjMDU5ZDJlYWY3XkEyXkFqcGc@._V1_.jpg" },
  { name: "The Matrix", url: "https://www.2embed.cc/embed/603", thumb: "https://m.media-amazon.com/images/M/MV5BN2NmN2VhMTQtMDNiOS00NDlhLTliMjgtODE2ZTY0ODQyNDRhXkEyXkFqcGc@._V1_.jpg" },
  { name: "Pulp Fiction", url: "https://www.2embed.cc/embed/680", thumb: "https://m.media-amazon.com/images/M/MV5BYTViYTE3ZGQtNDBlMC00ZTAyLTkyODMtZGRiZDg0MjA2YThkXkEyXkFqcGc@._V1_.jpg" },
  { name: "Fight Club", url: "https://www.2embed.cc/embed/550", thumb: "https://m.media-amazon.com/images/M/MV5BOTgyOGQ1NDItNGU3Ny00MjU3LTg2YWEtNmEyYjBiMjI1Y2M5XkEyXkFqcGc@._V1_.jpg" },
  { name: "The Shawshank Redemption", url: "https://www.2embed.cc/embed/278", thumb: "https://m.media-amazon.com/images/M/MV5BMDAyY2FhYjctNDc5OS00MDNlLThiMGUtY2UxYWVkNGY2ZjljXkEyXkFqcGc@._V1_.jpg" },
  { name: "Forrest Gump", url: "https://www.2embed.cc/embed/13", thumb: "https://m.media-amazon.com/images/M/MV5BNDYwNzVjMTItZmU5YS00YjQ5LTljYjgtMjY2NDVmYWMyNWFmXkEyXkFqcGc@._V1_.jpg" },
  { name: "The Godfather", url: "https://www.2embed.cc/embed/238", thumb: "https://m.media-amazon.com/images/M/MV5BYTJkNGQyZDgtZDQ0NC00MDM0LWEzZWQtYzUzZDEwMDljZWNjXkEyXkFqcGc@._V1_.jpg" },
  { name: "The Lord of the Rings: The Return of the King", url: "https://www.2embed.cc/embed/122", thumb: "https://m.media-amazon.com/images/M/MV5BMTZkMjBjNWMtZGI5OC00MGU0LTk4ZTItODg2NWM3NTVmNWQ4XkEyXkFqcGc@._V1_.jpg" },
  { name: "Star Wars: Episode V - The Empire Strikes Back", url: "https://www.2embed.cc/embed/1891", thumb: "https://m.media-amazon.com/images/M/MV5BMTkxNGFlNDktZmJkNC00MDdhLTg0MTEtZjZiYWI3MGE5NWIwXkEyXkFqcGc@._V1_.jpg" },
  { name: "Gladiator", url: "https://www.2embed.cc/embed/98", thumb: "https://m.media-amazon.com/images/M/MV5BYWQ4YmNjYjEtOWE1Zi00Y2U4LWI4NTAtMTU0MjkxNWQ1ZmJiXkEyXkFqcGc@._V1_.jpg" },
  { name: "Saving Private Ryan", url: "https://www.2embed.cc/embed/857", thumb: "https://m.media-amazon.com/images/M/MV5BNjczODkxNTAxN15BMl5BanBnXkFtZTcwMTcwNjUxMw@@._V1_.jpg" },
  { name: "The Lion King", url: "https://www.2embed.cc/embed/8587", thumb: "https://m.media-amazon.com/images/M/MV5BYTYxNGMyZTYtMjE3MS00MzNjLWFjNmYtMDk3N2FmM2JiM2M1XkEyXkFqcGc@._V1_.jpg" },
  { name: "Toy Story", url: "https://www.2embed.cc/embed/862", thumb: "https://m.media-amazon.com/images/M/MV5BMDU2ZWJlMjktMTRhMy00ZTA5LWEzNDgtYmNmZTEwZTViZWJkXkEyXkFqcGc@._V1_.jpg" }
];

// ============================================
// MOVIES PAGE FUNCTIONS
// ============================================

function loadMovies(filter = "") {
  const topScroller = document.getElementById('topMoviesScroller');
  const allScroller = document.getElementById('allMoviesScroller');
  const empty = document.getElementById('moviesEmpty');
  
  const filtered = MOVIES.filter(m => 
    m.name.toLowerCase().includes(filter.toLowerCase())
  );
  
  if (filter) {
    topScroller.style.display = 'none';
    document.querySelector('#movies .row:first-child').style.display = 'none';
  } else {
    topScroller.style.display = 'grid';
    document.querySelector('#movies .row:first-child').style.display = 'block';
    topScroller.innerHTML = '';
    MOVIES.slice(0, 4).forEach(movie => {
      topScroller.appendChild(createMovieCard(movie));
    });
  }
  
  if (filtered.length === 0) {
    empty.style.display = 'block';
    allScroller.style.display = 'none';
  } else {
    empty.style.display = 'none';
    allScroller.style.display = 'grid';
    allScroller.innerHTML = '';
    filtered.forEach(movie => {
      allScroller.appendChild(createMovieCard(movie));
    });
  }
}

function createMovieCard(movie) {
  const card = document.createElement('div');
  card.className = 'game-card';
  card.onclick = () => playGame(movie.url, movie.name);
  card.innerHTML = `
    <img src="${movie.thumb}" alt="${movie.name}">
    <div class="game-title">${movie.name}</div>
  `;
  return card;
}

function searchMovies() {
  const query = document.getElementById('movies-search').value;
  loadMovies(query);
}

function clearMoviesSearch() {
  document.getElementById('movies-search').value = '';
  loadMovies();
}

document.getElementById('movies-search')?.addEventListener('input', searchMovies);
document.getElementById('movies-clear')?.addEventListener('click', clearMoviesSearch);

loadMovies();

// ============================================
// TV SHOWS DATA
// ============================================

const TV_SHOWS = [
  { name: "Breaking Bad", url: "https://www.2embed.cc/embedtv/1396", thumb: "https://m.media-amazon.com/images/M/MV5BYTJkOWU2YWQtYWVjNC00NTliLTgxYjMtZGRiNmYwMjIxYTUxXkEyXkFqcGc@._V1_.jpg" },
  { name: "Stranger Things", url: "https://www.2embed.cc/embedtv/66732", thumb: "https://m.media-amazon.com/images/M/MV5BYWJhYmEzNDEtOWFjNC00MWFjLWJlMjQtZmYxMWVlMzI3ZjA5XkEyXkFqcGc@._V1_.jpg" },
  { name: "The Walking Dead", url: "https://www.2embed.cc/embedtv/1402", thumb: "https://m.media-amazon.com/images/M/MV5BYTdkN2U1ZGItNTdkMy00NjUzLTg4NDEtMzliNGMzNjllMDUyXkEyXkFqcGc@._V1_.jpg" },
  { name: "Game of Thrones", url: "https://www.2embed.cc/embedtv/1399", thumb: "https://m.media-amazon.com/images/M/MV5BN2IzYzBiOTQtNGZmMi00NDI5LTgxMzMtN2EzZjA1NjhlOGMxXkEyXkFqcGc@._V1_.jpg" },
  { name: "The Office", url: "https://www.2embed.cc/embedtv/2316", thumb: "https://m.media-amazon.com/images/M/MV5BMDNkOTE4NDQtMTNmYi00MWE0LWE4ZTktYTc0NzhhNWIzNzJiXkEyXkFqcGc@._V1_.jpg" },
  { name: "Friends", url: "https://www.2embed.cc/embedtv/1668", thumb: "https://m.media-amazon.com/images/M/MV5BNDVkYjU0MzctMWRmZi00NTkxLTgwZWEtOWVhYjZlYjllYmU4XkEyXkFqcGc@._V1_.jpg" },
  { name: "The Mandalorian", url: "https://www.2embed.cc/embedtv/82856", thumb: "https://m.media-amazon.com/images/M/MV5BN2M5YWFjN2YtYzU1NC00NGZlLWIwZWMtNWMxMmNiMDA3MjRhXkEyXkFqcGc@._V1_.jpg" },
  { name: "Wednesday", url: "https://www.2embed.cc/embedtv/119051", thumb: "https://m.media-amazon.com/images/M/MV5BM2ZmMjEyZmYtOGM4YS00YTNhLWE3ZDMtNzQxM2RhNjBlODIyXkEyXkFqcGc@._V1_.jpg" },
  { name: "Squid Game", url: "https://www.2embed.cc/embedtv/93405", thumb: "https://m.media-amazon.com/images/M/MV5BNmJmOTU1ZDgtYTgzMS00MWU1LWE1MmYtOTExNDkyMDI5YzE0XkEyXkFqcGc@._V1_.jpg" },
  { name: "The Last of Us", url: "https://www.2embed.cc/embedtv/100088", thumb: "https://m.media-amazon.com/images/M/MV5BZGUzYTI3M2EtZmM0Yy00NGUyLWI4ODEtN2Q3ZGJlYzhhZjU3XkEyXkFqcGc@._V1_.jpg" },
  { name: "Rick and Morty", url: "https://www.2embed.cc/embedtv/60625", thumb: "https://m.media-amazon.com/images/M/MV5BZjRjOTFkOTktZWUzMi00YzMyLThkMmYtMjEwNmQyNzliYTNmXkEyXkFqcGc@._V1_.jpg" },
  { name: "The Boys", url: "https://www.2embed.cc/embedtv/76479", thumb: "https://m.media-amazon.com/images/M/MV5BNGRmZjM1M2ItZWViOC00NTk2LWJlMDItMDU0YjBjYWE0MTJmXkEyXkFqcGc@._V1_.jpg" },
  { name: "House of the Dragon", url: "https://www.2embed.cc/embedtv/94997", thumb: "https://m.media-amazon.com/images/M/MV5BM2QzNWNlZjQtOTk4OC00Zjg0LWE3ZjItMGJjYWZmOGE4NzJiXkEyXkFqcGc@._V1_.jpg" },
  { name: "Better Call Saul", url: "https://www.2embed.cc/embedtv/60059", thumb: "https://m.media-amazon.com/images/M/MV5BZDA4YmE0OTYtMmRmNS00Mzk2LTlhM2MtNjk4NzBjZGE1MmIyXkEyXkFqcGc@._V1_.jpg" },
  { name: "The Crown", url: "https://www.2embed.cc/embedtv/1399", thumb: "https://m.media-amazon.com/images/M/MV5BZmY0MzBlNjctOWQxNi00NjBhLWFlNTQtN2VkNWNlYTE3MTI4XkEyXkFqcGc@._V1_.jpg" },
  { name: "Peaky Blinders", url: "https://www.2embed.cc/embedtv/60574", thumb: "https://m.media-amazon.com/images/M/MV5BM2MzODk3ZWEtZjY3Ni00MTAzLWE2ZDAtMGQzN2Q1NTQ4MWU1XkEyXkFqcGc@._V1_.jpg" }
];

// ============================================
// TV SHOWS PAGE FUNCTIONS
// ============================================

function loadTVShows(filter = "") {
  const scroller = document.getElementById('allTVShowsScroller');
  
  const filtered = TV_SHOWS.filter(show => 
    show.name.toLowerCase().includes(filter.toLowerCase())
  );
  
  scroller.innerHTML = '';
  filtered.forEach(show => {
    const card = document.createElement('div');
    card.className = 'game-card';
    card.onclick = () => playGame(show.url, show.name);
    card.innerHTML = `
      <img src="${show.thumb}" alt="${show.name}">
      <div class="game-title">${show.name}</div>
    `;
    scroller.appendChild(card);
  });
}

function searchTVShows() {
  const query = document.getElementById('tvshows-search').value;
  loadTVShows(query);
}

function clearTVShowsSearch() {
  document.getElementById('tvshows-search').value = '';
  loadTVShows();
}

document.getElementById('tvshows-search')?.addEventListener('input', searchTVShows);
document.getElementById('tvshows-clear')?.addEventListener('click', clearTVShowsSearch);

loadTVShows();

// ============================================
// PLAYER OVERLAY
// ============================================

function playGame(url, name) {
  const player = document.getElementById('player');
  const frame = document.getElementById('playerFrame');
  const playerName = document.getElementById('playerName');
  
  playerName.textContent = name;
  frame.src = url;
  player.classList.add('active');
  
  // Track recently played
  const game = ALL_GAMES.find(g => g.url === url) || MOVIES.find(m => m.url === url) || TV_SHOWS.find(s => s.url === url);
  if (game) {
    trackRecentlyPlayed(game.id || game.name, name, url, game.thumb);
  }
  
  // Track played games for badges
  let playedGames = JSON.parse(localStorage.getItem('played_games') || '[]');
  if (!playedGames.includes(url)) {
    playedGames.push(url);
    localStorage.setItem('played_games', JSON.stringify(playedGames));
  }
}

document.getElementById('closeBtn').addEventListener('click', () => {
  const player = document.getElementById('player');
  const frame = document.getElementById('playerFrame');
  player.classList.remove('active');
  frame.src = '';
});

// ============================================
// UNBLOCKED GOOGLE
// ============================================

function openUnblockedGoogle() {
  const url = document.getElementById('google-url').value.trim();
  if (!url) {
    showNotification('Please enter a URL', 'warning');
    return;
  }
  
  let fullUrl = url;
  if (!url.startsWith('http://') && !url.startsWith('https://')) {
    fullUrl = 'https://' + url;
  }
  
  playGame(fullUrl, 'Unblocked Site');
}

function openWaterGame() {
  playGame('https://sites.google.com/view/randomgooglesite1/home', 'Water');
}

// ============================================
// REQUESTS FORM
// ============================================

document.getElementById('requestForm')?.addEventListener('submit', (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);
  
  emailjs.send("service_ooej4fl", "template_3r2awkg", {
    request_type: data.request_type,
    details: data.details,
    name: data.name || 'Anonymous'
  }).then(() => {
    document.getElementById('status').textContent = 'Request submitted successfully!';
    document.getElementById('status').style.color = 'var(--success)';
    e.target.reset();
  }).catch(() => {
    document.getElementById('status').textContent = 'Failed to submit request.';
    document.getElementById('status').style.color = 'var(--alert)';
  });
});

// ============================================
// CHAT SYSTEM
// ============================================

function setupChat() {
  if (!window.myName) {
    showNotification('Please login to use chat', 'warning');
    return;
  }
  
  db.ref("users/" + window.myName + "/status").set("online");
  
  db.ref("users/" + window.myName + "/friends").on("value", (snap) => {
    myFriends = [];
    const friendList = document.getElementById('friend-list');
    friendList.innerHTML = '';
    
    if (!snap.exists()) {
      friendList.innerHTML = '<p class="empty">No friends yet</p>';
      return;
    }
    
    snap.forEach((f) => {
      const friendName = f.key;
      myFriends.push(friendName);
      
      const div = document.createElement('div');
      div.className = 'contact-item';
      div.onclick = () => openChat(friendName, div, 'private');
      
      db.ref("users/" + friendName).once("value", (userSnap) => {
        const userData = userSnap.val();
        const isOnline = userData.status === 'online';
        
        div.innerHTML = `
          <img class="avatar-circle" src="${userData.pfp || 'https://via.placeholder.com/34'}" alt="${friendName}">
          <span>${friendName}</span>
          <div class="status-dot ${isOnline ? 'online' : ''}"></div>
        `;
      });
      
      friendList.appendChild(div);
    });
  });
  
  loadGroups();
}

function openChat(name, element, type) {
  activeChat = name;
  chatType = type;
  
  document.querySelectorAll('.contact-item').forEach(el => el.classList.remove('active'));
  element?.classList.add('active');
  
  document.getElementById('active-chat-user').textContent = name;
  document.getElementById('chat-msgs').innerHTML = '';
  
  const headerPfp = document.getElementById('header-pfp');
  const makeGroupBtn = document.getElementById('make-group-btn');
  const manageGroupBtn = document.getElementById('manage-group-btn');
  
  if (type === 'private') {
    db.ref("users/" + name + "/pfp").once("value", (snap) => {
      headerPfp.src = snap.val() || 'https://via.placeholder.com/34';
      headerPfp.style.display = 'block';
    });
    makeGroupBtn.style.display = 'inline-block';
    manageGroupBtn.style.display = 'none';
  } else if (type === 'global') {
    headerPfp.style.display = 'none';
    makeGroupBtn.style.display = 'none';
    manageGroupBtn.style.display = 'none';
  } else if (type === 'group') {
    headerPfp.style.display = 'none';
    makeGroupBtn.style.display = 'none';
    manageGroupBtn.style.display = 'inline-block';
  }
  
  let chatRef;
  if (type === 'global') {
    chatRef = db.ref("global_chat");
  } else if (type === 'private') {
    const roomId = [window.myName, name].sort().join('_');
    chatRef = db.ref("chats/" + roomId);
  } else if (type === 'group') {
    chatRef = db.ref("groups/" + name + "/messages");
  }
  
  chatRef.limitToLast(50).on("child_added", (snap) => {
    displayMessage(snap.val());
  });
}

function displayMessage(msg) {
  const box = document.getElementById('chat-msgs');
  const div = document.createElement('div');
  div.className = msg.sender === window.myName ? 'chat-msg sent' : 'chat-msg received';
  
  db.ref("users/" + msg.sender + "/pfp").once("value", (snap) => {
    const pfpUrl = snap.val() || 'https://via.placeholder.com/34';
    
    div.innerHTML = `
      <img class="msg-avatar" src="${pfpUrl}" alt="${msg.sender}" onclick="viewUserProfile('${msg.sender}', 'chat')">
      <div class="msg-content">
        <div class="msg-sender">${msg.sender}</div>
        <div class="msg-text">${msg.text}</div>
        <div class="msg-time">${new Date(msg.timestamp).toLocaleTimeString()}</div>
      </div>
    `;
    
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
  });
  
  // Track message count for badges
  let msgCount = parseInt(localStorage.getItem('message_count') || '0');
  if (msg.sender === window.myName) {
    msgCount++;
    localStorage.setItem('message_count', msgCount);
  }
}

function sendMsg() {
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if (!text || !activeChat) return;
  
  const msg = {
    sender: window.myName,
    text: text,
    timestamp: Date.now()
  };
  
  if (chatType === 'global') {
    db.ref("global_chat").push(msg);
  } else if (chatType === 'private') {
    const roomId = [window.myName, activeChat].sort().join('_');
    db.ref("chats/" + roomId).push(msg);
  } else if (chatType === 'group') {
    db.ref("groups/" + activeChat + "/messages").push(msg);
  }
  
  input.value = '';
}

function addFriend() {
  const friendName = prompt("Enter friend's username:");
  if (!friendName) return;
  
  if (friendName === window.myName) {
    showNotification("You can't add yourself!", 'warning');
    return;
  }
  
  db.ref("users/" + friendName).once("value", (snap) => {
    if (snap.exists()) {
      db.ref("requests/" + friendName + "/" + window.myName).set(true);
      showNotification('Friend request sent!', 'success');
    } else {
      showNotification('User not found', 'error');
    }
  });
}

function loadGroups() {
  db.ref("groups").once("value", (snap) => {
    const groupList = document.getElementById('group-list');
    groupList.innerHTML = '';
    
    if (!snap.exists()) {
      groupList.innerHTML = '<p class="empty">No groups</p>';
      return;
    }
    
    snap.forEach((grp) => {
      const groupData = grp.val();
      if (groupData.members && groupData.members[window.myName]) {
        const div = document.createElement('div');
        div.className = 'contact-item';
        div.onclick = () => openChat(grp.key, div, 'group');
        div.innerHTML = `
          <div class="avatar-circle" style="display:flex;align-items:center;justify-content:center;background:var(--accent);color:#000;font-weight:bold;">#</div>
          <span>${groupData.name || grp.key}</span>
        `;
        groupList.appendChild(div);
      }
    });
  });
}

function createGroup() {
  if (!activeChat || chatType !== 'private') {
    showNotification('Select a friend first', 'warning');
    return;
  }
  
  const gn = prompt("Enter group name:");
  if (!gn) return;
  
  db.ref("groups").push({
    name: gn,
    owner: window.myName,
    members: { [window.myName]: true, [activeChat]: true },
  });
  
  showNotification('Group created!', 'success');
}

function changeChatBG() {
  const url = prompt("Enter Background Image URL:");
  if (url) document.getElementById("chat-pane").style.background = `url('${url}')`;
}

function viewProfileFromChat() {
  if (chatType === 'private' && activeChat) {
    viewUserProfile(activeChat, 'chat');
  } else if (chatType === 'global') {
    showNotification('This is the public channel', 'warning');
  } else if (chatType === 'group') {
    showNotification('Group profiles coming soon!', 'warning');
  }
}

function filterFriends() {
  const search = document.getElementById("friend-search").value.toLowerCase();
  document.querySelectorAll("#friend-list .contact-item").forEach((el) => {
    const name = el.textContent.toLowerCase();
    el.style.display = name.includes(search) ? "flex" : "none";
  });
}

// ============================================
// USER PROFILE VIEWING
// ============================================

function viewUserProfile(username, fromPage) {
  if (!username) return;
  
  viewedUserName = username;
  previousPage = fromPage || 'chat';
  
  db.ref("users/" + username).once("value", (snap) => {
    if (!snap.exists()) {
      showNotification('User not found', 'error');
      return;
    }
    
    const userData = snap.val();
    
    document.getElementById('user-profile-username').textContent = username;
    document.getElementById('user-profile-status').textContent = userData.status === 'online' ? 'Online' : 'Offline';
    document.getElementById('user-profile-pic').src = userData.pfp || 'https://via.placeholder.com/120';
    document.getElementById('user-profile-custom-status').textContent = userData.customStatus || '';
    
    showPage('user-profile');
  });
}

function goBackFromUserProfile() {
  if (previousPage) {
    showPage(previousPage);
  } else {
    showPage('chat');
  }
}

function sendFriendRequestToUser() {
  if (!window.myName) {
    showNotification('Please login first', 'warning');
    return;
  }
  
  if (!viewedUserName) return;
  
  db.ref("requests/" + viewedUserName + "/" + window.myName).set(true);
  showNotification(`Friend request sent to ${viewedUserName}!`, 'success');
}

function messageUser() {
  if (!window.myName) {
    showNotification('Please login first', 'warning');
    return;
  }
  
  if (!viewedUserName) return;
  
  showPage('chat');
  
  setTimeout(() => {
    const contactItems = document.querySelectorAll('#friend-list .contact-item');
    let found = false;
    
    contactItems.forEach(item => {
      if (item.textContent.includes(viewedUserName)) {
        item.click();
        found = true;
      }
    });
    
    if (!found) {
      showNotification('You need to be friends to send messages!', 'warning');
    }
  }, 500);
}

// ============================================
// PROFILE FUNCTIONS
// ============================================

function loginUser() {
  const username = document.getElementById('login-username').value.trim();
  if (!username) {
    showNotification('Please enter a username', 'warning');
    return;
  }

  db.ref("users/" + username).once("value", (snap) => {
    if (snap.exists()) {
      window.myName = username;
      localStorage.setItem("nexus_user", username);
      updateProfileDisplay();
      loadCoinData();
      startCoinEarning();
      showNotification('Logged in successfully!', 'success');
    } else {
      showNotification('User not found. Please register first.', 'warning');
    }
  });
}

function registerUser() {
  const username = document.getElementById('login-username').value.trim();
  if (!username) {
    showNotification('Please enter a username', 'warning');
    return;
  }

  db.ref("users/" + username).once("value", (snap) => {
    if (snap.exists()) {
      showNotification('Username already taken', 'warning');
    } else {
      db.ref("users/" + username).set({
        status: "online",
        pfp: "https://via.placeholder.com/120",
        customStatus: "",
        friends: {},
        coins: 0,
        purchasedGames: []
      });
      window.myName = username;
      localStorage.setItem("nexus_user", username);
      updateProfileDisplay();
      loadCoinData();
      startCoinEarning();
      showNotification('Registered successfully!', 'success');
    }
  });
}

function logoutUser() {
  if (window.myName) {
    db.ref("users/" + window.myName + "/status").set("offline");
  }
  stopCoinEarning();
  window.myName = null;
  localStorage.removeItem("nexus_user");
  novaCoins = 0;
  purchasedGames = [];
  updateCoinDisplay();
  updateProfileDisplay();
  showNotification('Logged out', 'success');
}

function updateProfileDisplay() {
  if (window.myName) {
    document.getElementById('profile-username').textContent = window.myName;
    document.getElementById('profile-status').textContent = 'Online';
    
    db.ref("users/" + window.myName + "/pfp").on("value", (snap) => {
      const pfpUrl = snap.val() || "https://via.placeholder.com/120";
      document.getElementById('profile-pic').src = pfpUrl;
    });
    
    db.ref("users/" + window.myName + "/customStatus").on("value", (snap) => {
      const status = snap.val() || '';
      document.getElementById('status-input').placeholder = status || "What's on your mind?";
    });
  } else {
    document.getElementById('profile-username').textContent = 'Guest';
    document.getElementById('profile-status').textContent = 'Offline';
    document.getElementById('profile-pic').src = 'https://via.placeholder.com/120';
  }
}

function uploadProfilePic(event) {
  if (!window.myName) {
    showNotification('Please login first', 'warning');
    return;
  }

  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64 = e.target.result;
    db.ref("users/" + window.myName + "/pfp").set(base64);
    document.getElementById('profile-pic').src = base64;
    localStorage.setItem('pfp_changed', 'true');
    showNotification('Profile picture updated!', 'success');
  };
  reader.readAsDataURL(file);
}

function updateStatus() {
  if (!window.myName) {
    showNotification('Please login first', 'warning');
    return;
  }
  
  const statusText = document.getElementById('status-input').value.trim();
  if (!statusText) {
    showNotification('Please enter a status', 'warning');
    return;
  }
  
  db.ref("users/" + window.myName + "/customStatus").set(statusText);
  document.getElementById('status-input').value = '';
  showNotification('Status updated!', 'success');
}

function loadProfile() {
  if (!window.myName) return;

  db.ref("requests/" + window.myName).on("value", (snap) => {
    const requestsList = document.getElementById('requests-list');
    requestsList.innerHTML = '';

    if (!snap.exists() || snap.numChildren() === 0) {
      requestsList.innerHTML = '<p class="empty">No pending requests</p>';
      return;
    }

    snap.forEach((req) => {
      const requester = req.key;
      const div = document.createElement('div');
      div.className = 'request-item';
      div.innerHTML = `
        <div class="request-user" style="cursor:pointer;" onclick="viewUserProfile('${requester}', 'profile')">
          <img class="avatar-circle" src="https://via.placeholder.com/34" id="req-pfp-${requester}">
          <span>${requester}</span>
        </div>
        <div class="request-actions">
          <button class="accept-btn" onclick="event.stopPropagation(); acceptRequest('${requester}')">Accept</button>
          <button class="decline-btn" onclick="event.stopPropagation(); declineRequest('${requester}')">Decline</button>
        </div>
      `;
      requestsList.appendChild(div);

      db.ref("users/" + requester + "/pfp").once("value", (pSnap) => {
        const img = document.getElementById(`req-pfp-${requester}`);
        if (img && pSnap.val()) img.src = pSnap.val();
      });
    });
  });
}

function acceptRequest(requester) {
  db.ref("users/" + window.myName + "/friends/" + requester).set(true);
  db.ref("users/" + requester + "/friends/" + window.myName).set(true);
  db.ref("requests/" + window.myName + "/" + requester).remove();
  showNotification(`You are now friends with ${requester}!`, 'success');
}

function declineRequest(requester) {
  db.ref("requests/" + window.myName + "/" + requester).remove();
  showNotification('Request declined', 'success');
}
  </script>
</body>
</html>
