<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nova</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0a0e1a;--panel:#131729;--panel2:#0f1424;--text:#f0f4ff;--muted:#8b9dc3;--border:rgba(139,157,195,0.15);--hover:rgba(91,141,239,0.1);--active:rgba(91,141,239,0.2);--accent:#5b8def;--accent-glow:rgba(91,141,239,0.4);--online:#00ff88;--offline:#555;--alert:#ff4444;--success:#00ff88;--card-shadow:0 8px 32px rgba(0,0,0,0.4);--coin-gold:#ffd700}
    body.light-mode{--bg:#f5f7fa;--panel:#ffffff;--panel2:#f8f9fb;--text:#1a1f36;--muted:#4a5568;--border:rgba(74,85,104,0.2);--accent:#3b7dd8;--accent-glow:rgba(59,125,216,0.4);--card-shadow:0 4px 16px rgba(0,0,0,0.1)}
    *{box-sizing:border-box}html,body{height:100%;margin:0;padding:0}
    body{font-family:'Inter',ui-sans-serif,system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);overflow:hidden;position:relative;transition:background 0.3s,color 0.3s}
    body.performance-mode .particle,body.performance-mode .orb,body.performance-mode .gradient-wave,body.performance-mode .scanline{display:none!important}
    .bg-container{position:fixed;top:0;left:0;width:100%;height:100%;overflow:hidden;z-index:0;pointer-events:none}
    .custom-bg{position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;display:none;z-index:1}.custom-bg.active{display:block}
    .gradient-wave{position:absolute;width:200%;height:200%;background:radial-gradient(circle at 20% 50%,rgba(91,141,239,0.15) 0%,transparent 50%),radial-gradient(circle at 80% 80%,rgba(0,255,136,0.1) 0%,transparent 50%);animation:waveMove 20s ease-in-out infinite}
    @keyframes waveMove{0%,100%{transform:translate(-25%,-25%) rotate(0deg);opacity:0.6}33%{transform:translate(-30%,-20%) rotate(120deg);opacity:0.8}66%{transform:translate(-20%,-30%) rotate(240deg);opacity:0.7}}
    .orb{position:absolute;border-radius:50%;filter:blur(40px);animation:floatOrb 15s ease-in-out infinite;opacity:0.3}
    .orb-1{width:400px;height:400px;background:linear-gradient(135deg,rgba(91,141,239,0.4),rgba(147,51,234,0.3));top:10%;left:10%;animation-duration:25s}
    .orb-2{width:500px;height:500px;background:linear-gradient(135deg,rgba(0,255,136,0.3),rgba(91,141,239,0.3));bottom:10%;right:10%;animation-delay:-8s;animation-duration:30s}
    .orb-3{width:300px;height:300px;background:linear-gradient(135deg,rgba(147,51,234,0.3),rgba(0,255,136,0.2));top:50%;left:50%;animation-delay:-15s;animation-duration:22s}
    @keyframes floatOrb{0%,100%{transform:translate(0,0) scale(1)}25%{transform:translate(150px,-150px) scale(1.2)}50%{transform:translate(-150px,150px) scale(0.9)}75%{transform:translate(100px,100px) scale(1.1)}}
    .particles{position:absolute;width:100%;height:100%}
    .particle{position:absolute;width:3px;height:3px;background:rgba(91,141,239,0.6);border-radius:50%;animation:particleFloat linear infinite}
    @keyframes particleFloat{0%{transform:translateY(100vh) translateX(0) scale(0);opacity:0}10%{opacity:1}90%{opacity:1}100%{transform:translateY(-100vh) translateX(var(--drift)) scale(1);opacity:0}}
    .grid-overlay{position:absolute;width:100%;height:100%;background-image:linear-gradient(rgba(91,141,239,0.05) 2px,transparent 2px),linear-gradient(90deg,rgba(91,141,239,0.05) 2px,transparent 2px);background-size:100px 100px;animation:gridPulse 8s ease-in-out infinite}
    @keyframes gridPulse{0%,100%{opacity:0.3}50%{opacity:0.6}}
    .scanline{position:absolute;width:100%;height:3px;background:linear-gradient(90deg,transparent,rgba(91,141,239,0.5),transparent);animation:scanlineMove 4s linear infinite;box-shadow:0 0 15px rgba(91,141,239,0.7)}
    @keyframes scanlineMove{0%{top:-3px}100%{top:100%}}
    .energy-ring{position:absolute;top:50%;left:50%;width:100px;height:100px;border:2px solid rgba(91,141,239,0.3);border-radius:50%;animation:energyExpand 6s ease-out infinite}
    .energy-ring:nth-child(2){animation-delay:2s}.energy-ring:nth-child(3){animation-delay:4s}
    @keyframes energyExpand{0%{width:100px;height:100px;opacity:1;transform:translate(-50%,-50%)}100%{width:1000px;height:1000px;opacity:0;transform:translate(-50%,-50%)}}
    .app{display:grid;grid-template-rows:64px 1fr;grid-template-columns:280px 1fr;height:100vh;position:relative;z-index:1}
    body.grid-mode .scroller{display:grid!important;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:20px;overflow-y:auto;overflow-x:hidden}
    header{grid-column:1/-1;display:flex;align-items:center;padding:0 24px;border-bottom:1px solid var(--border);background:rgba(19,23,41,0.8);backdrop-filter:blur(20px);box-shadow:0 4px 24px rgba(0,0,0,0.2);gap:20px}
    body.light-mode header{background:rgba(255,255,255,0.9)}
    .brand{font-weight:800;font-size:22px;letter-spacing:-0.5px;background:linear-gradient(135deg,#5b8def 0%,#00ff88 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:brandGlow 3s ease-in-out infinite}
    @keyframes brandGlow{0%,100%{filter:drop-shadow(0 0 8px rgba(91,141,239,0.4))}50%{filter:drop-shadow(0 0 16px rgba(91,141,239,0.6))}}
    .header-info{margin-left:auto;display:flex;align-items:center;gap:16px;font-size:13px;font-weight:600}
    .info-item{display:flex;flex-direction:column;align-items:flex-start;padding:6px 12px;background:rgba(91,141,239,0.1);border:1px solid var(--border);border-radius:8px;min-width:100px}
    .info-label{font-size:10px;text-transform:uppercase;letter-spacing:0.1em;color:var(--muted);margin-bottom:2px}
    .info-value{font-size:13px;font-weight:700;color:var(--text)}
    #current-time{font-family:'Courier New',monospace;letter-spacing:0.05em}
    .coin-display{display:flex;align-items:center;gap:8px;padding:8px 16px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:12px;font-weight:700;font-size:16px;cursor:pointer;transition:all 0.3s}
    .coin-display:hover{background:rgba(255,215,0,0.2);box-shadow:0 4px 16px rgba(255,215,0,0.3)}
    .coin-icon{width:24px;height:24px;background:linear-gradient(135deg,#ffd700,#ffed4e);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;box-shadow:0 2px 8px rgba(255,215,0,0.4)}
    aside{border-right:1px solid var(--border);background:rgba(19,23,41,0.6);backdrop-filter:blur(20px);padding:20px;overflow-y:auto;box-shadow:4px 0 24px rgba(0,0,0,0.2)}
    body.light-mode aside{background:rgba(255,255,255,0.8)}
    aside::-webkit-scrollbar{width:6px}aside::-webkit-scrollbar-track{background:transparent}aside::-webkit-scrollbar-thumb{background:rgba(91,141,239,0.3);border-radius:3px}
    .nav-title{font-size:11px;text-transform:uppercase;letter-spacing:0.15em;color:var(--muted);margin:6px 12px 12px;font-weight:700}
    .nav{display:flex;flex-direction:column;gap:8px}
    .nav a{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--text);padding:12px 14px;border-radius:12px;border:1px solid transparent;transition:all 0.3s;cursor:pointer;position:relative;overflow:hidden;font-weight:500}
    .nav a:hover{background:var(--hover);border-color:var(--accent);transform:translateX(4px);box-shadow:0 4px 16px rgba(91,141,239,0.2)}
    .nav a.active{background:var(--active);border-color:var(--accent);box-shadow:0 4px 16px rgba(91,141,239,0.3)}
    .nav a.admin-nav-item{border-color:rgba(255,68,68,0.3);background:rgba(255,68,68,0.05)}
    .nav a.admin-nav-item:hover{border-color:var(--alert);background:rgba(255,68,68,0.15)}
    .nav a.admin-nav-item.active{background:rgba(255,68,68,0.2);border-color:var(--alert)}
    .nav a.admin-nav-item .dot{background:var(--alert);box-shadow:0 0 8px rgba(255,68,68,0.6)}
    .dot{width:8px;height:8px;border-radius:999px;background:var(--accent);flex:0 0 auto;box-shadow:0 0 8px var(--accent-glow);animation:dotPulse 2s ease-in-out infinite}
    @keyframes dotPulse{0%,100%{transform:scale(1);opacity:0.7}50%{transform:scale(1.2);opacity:1}}
    main{overflow:hidden;display:flex;flex-direction:column;position:relative}
    .page-section{display:none;padding:24px;overflow-y:auto;height:100%;animation:fadeIn 0.4s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .page-section::-webkit-scrollbar{width:8px}.page-section::-webkit-scrollbar-track{background:transparent}.page-section::-webkit-scrollbar-thumb{background:rgba(91,141,239,0.3);border-radius:4px}
    .page-section.active{display:block}
    .card{max-width:100%;background:rgba(19,23,41,0.6);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:20px;padding:28px;box-shadow:var(--card-shadow);transition:all 0.3s;margin-bottom:24px}
    body.light-mode .card{background:rgba(255,255,255,0.8)}
    .card:hover{border-color:rgba(91,141,239,0.3);box-shadow:0 12px 48px rgba(0,0,0,0.6),0 0 32px rgba(91,141,239,0.1)}
    .card h1{margin:0 0 12px;font-size:28px;font-weight:800;background:linear-gradient(135deg,var(--text) 0%,var(--accent) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .card h2{margin:0 0 12px;font-size:22px;font-weight:700;color:var(--text)}
    .card p{margin:0 0 18px;color:var(--muted);line-height:1.6;font-size:15px}
    .btn{appearance:none;border:1px solid var(--border);background:rgba(91,141,239,0.1);color:var(--text);padding:12px 20px;border-radius:12px;font-weight:700;text-decoration:none;display:inline-block;cursor:pointer;font-size:13px;transition:all 0.3s;position:relative;overflow:hidden;letter-spacing:0.3px}
    .btn:hover{background:rgba(91,141,239,0.2);border-color:var(--accent);transform:translateY(-2px);box-shadow:0 8px 24px rgba(91,141,239,0.3)}
    .btn:active{transform:translateY(0)}.btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
    /* PROFILE BANNER */
    .profile-banner-wrapper{width:100%;height:160px;border-radius:16px;overflow:hidden;margin-bottom:0;position:relative;cursor:pointer;border:2px solid var(--border);transition:border-color 0.3s}
    .profile-banner-wrapper:hover{border-color:var(--accent)}
    .profile-banner{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:48px;font-weight:900;letter-spacing:8px;position:relative;transition:all 0.3s;background:linear-gradient(135deg,#3a3a4a 0%,#2a2a3a 100%)}
    .profile-banner-label{position:absolute;bottom:10px;right:12px;font-size:11px;font-weight:700;color:rgba(255,255,255,0.6);text-transform:uppercase;letter-spacing:0.1em}
    .profile-header-with-banner{position:relative;margin-bottom:28px}
    .profile-header-overlay{display:flex;align-items:flex-end;gap:20px;padding:0 20px 16px;margin-top:-48px;position:relative;z-index:2}
    .profile-pic-wrapper{position:relative;flex-shrink:0}
    .profile-pic{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid var(--bg);box-shadow:0 8px 24px rgba(0,0,0,0.4);transition:all 0.3s;background:var(--panel)}
    .change-pic-btn{position:absolute;bottom:4px;right:4px;background:var(--accent);border:none;border-radius:50%;width:32px;height:32px;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(91,141,239,0.4);transition:all 0.3s}
    .change-pic-btn:hover{transform:scale(1.1) rotate(15deg)}
    .profile-info{flex:1;padding-bottom:4px}.profile-info h2{margin:0 0 4px;font-size:24px;font-weight:800}
    .profile-info .status{color:var(--muted);font-size:14px;font-weight:600;margin:0}
    /* BANNER SHOP */
    .banner-preview{width:100%;height:70px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:900;letter-spacing:4px;margin-bottom:8px;border:1px solid var(--border)}
    .banner-shop-item{background:rgba(19,23,41,0.6);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:16px;padding:14px;display:flex;flex-direction:column;gap:8px;flex:0 0 auto;width:200px;transition:all 0.3s}
    .banner-shop-item:hover{border-color:var(--accent);transform:translateY(-4px);box-shadow:0 12px 32px rgba(91,141,239,0.2)}
    .banner-shop-item strong{font-size:13px;font-weight:700}
    .banner-price{display:flex;align-items:center;gap:6px;font-size:15px;font-weight:800;color:var(--coin-gold)}
    /* SETTINGS */
    .settings-container{max-width:800px}.settings-group{margin-bottom:32px}
    .settings-group h2{font-size:20px;margin-bottom:16px;color:var(--accent);display:flex;align-items:center;gap:10px}
    .setting-item{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:rgba(91,141,239,0.05);border:1px solid var(--border);border-radius:12px;margin-bottom:12px;transition:all 0.3s}
    .setting-item:hover{border-color:var(--accent);background:rgba(91,141,239,0.1)}
    .setting-info{flex:1}.setting-title{font-weight:700;font-size:15px;margin-bottom:4px}.setting-desc{font-size:13px;color:var(--muted)}
    .toggle-switch{position:relative;width:54px;height:28px;background:rgba(91,141,239,0.2);border-radius:14px;cursor:pointer;transition:all 0.3s;border:2px solid var(--border)}
    .toggle-switch.active{background:var(--accent);border-color:var(--accent)}
    .toggle-switch::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;background:white;border-radius:50%;transition:all 0.3s;box-shadow:0 2px 4px rgba(0,0,0,0.2)}
    .toggle-switch.active::after{left:28px}
    .file-input-wrapper{position:relative;display:inline-block}
    .file-input-wrapper input[type="file"]{position:absolute;opacity:0;width:0;height:0}
    .file-input-label{display:inline-block;padding:12px 20px;background:rgba(91,141,239,0.15);border:1px solid var(--accent);border-radius:12px;cursor:pointer;font-weight:700;transition:all 0.3s}
    .file-input-label:hover{background:rgba(91,141,239,0.3);box-shadow:0 4px 16px rgba(91,141,239,0.3)}
    .search-wrap{margin-top:16px;display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .search-input,.clear-btn{padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:rgba(91,141,239,0.05);color:var(--text);font-weight:600;transition:all 0.3s}
    .search-input{min-width:220px;flex:1}.search-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 20px rgba(91,141,239,0.2);background:rgba(91,141,239,0.1)}
    .clear-btn{cursor:pointer;font-weight:800}.clear-btn:hover{background:rgba(255,68,68,0.2);border-color:var(--alert)}
    .row{margin-top:24px}
    .row-title{font-size:13px;text-transform:uppercase;letter-spacing:0.15em;color:var(--muted);margin-bottom:14px;display:flex;align-items:center;justify-content:space-between;gap:12px;font-weight:700}
    .scroller{display:flex;gap:16px;overflow-x:auto;padding-bottom:12px;-webkit-overflow-scrolling:touch}
    .scroller::-webkit-scrollbar{height:6px}.scroller::-webkit-scrollbar-track{background:rgba(91,141,239,0.05);border-radius:3px}.scroller::-webkit-scrollbar-thumb{background:rgba(91,141,239,0.3);border-radius:3px}
    .game,.movie,.tvshow,.shop-item{width:260px;background:rgba(19,23,41,0.6);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:18px;padding:16px;display:flex;flex-direction:column;gap:12px;flex:0 0 auto;transition:all 0.3s;cursor:pointer;position:relative}
    body.light-mode .game,body.light-mode .movie,body.light-mode .tvshow,body.light-mode .shop-item{background:rgba(255,255,255,0.8)}
    .game:hover,.movie:hover,.tvshow:hover,.shop-item:hover{transform:translateY(-8px) scale(1.02);border-color:var(--accent);box-shadow:0 16px 48px rgba(0,0,0,0.4),0 0 40px rgba(91,141,239,0.2)}
    .favorite-btn{position:absolute;top:24px;right:24px;background:rgba(19,23,41,0.8);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;z-index:10;transition:all 0.3s}
    .favorite-btn:hover{transform:scale(1.1);box-shadow:0 4px 16px rgba(255,215,0,0.4)}.favorite-btn.active{background:rgba(255,215,0,0.2);border-color:var(--coin-gold)}
    .thumb{height:180px;object-fit:contain;background:rgba(0,0,0,0.3);border-radius:14px;border:1px solid var(--border);transition:all 0.3s}
    .game strong,.movie strong,.tvshow strong,.shop-item strong{font-size:15px;font-weight:700}
    .shop-item .price{display:flex;align-items:center;gap:8px;font-size:18px;font-weight:800;color:var(--coin-gold)}
    .shop-item .price .coin-icon{width:20px;height:20px;font-size:12px}
    .game-btn,.movie-btn,.tvshow-btn,.buy-btn{padding:12px;border-radius:12px;border:1px solid var(--border);background:rgba(91,141,239,0.15);font-weight:800;cursor:pointer;color:#ffffff;transition:all 0.3s;position:relative;overflow:hidden}
    .buy-btn{background:rgba(255,215,0,0.15);border-color:rgba(255,215,0,0.3)}.buy-btn:hover{background:rgba(255,215,0,0.3);border-color:var(--coin-gold);box-shadow:0 4px 20px rgba(255,215,0,0.4)}.buy-btn:disabled{opacity:0.5;cursor:not-allowed}
    .game-btn:hover,.movie-btn:hover,.tvshow-btn:hover{background:rgba(91,141,239,0.3);border-color:var(--accent);box-shadow:0 4px 20px rgba(91,141,239,0.4);transform:translateY(-2px)}
    .empty{margin:0;color:var(--muted);font-weight:700;font-size:14px}
    .notification{position:fixed;bottom:20px;right:20px;background:rgba(19,23,41,0.95);backdrop-filter:blur(20px);border:2px solid var(--accent);border-radius:16px;padding:16px 24px;display:flex;align-items:center;gap:12px;box-shadow:0 8px 32px rgba(91,141,239,0.3);transform:translateX(150%);transition:transform 0.5s cubic-bezier(0.68,-0.55,0.265,1.55);z-index:10000;max-width:400px}
    .notification.show{transform:translateX(0)}.notification.success{border-color:var(--success)}.notification.warning{border-color:#ffaa00}.notification.error{border-color:var(--alert)}
    .notification-icon{font-size:24px}.notification-text{font-weight:700;font-size:14px;color:var(--text)}
    .badge-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:16px;margin-top:16px}
    .badge{background:rgba(19,23,41,0.6);backdrop-filter:blur(10px);border:1px solid var(--border);border-radius:14px;padding:16px;text-align:center;transition:all 0.3s;cursor:pointer;position:relative}
    .badge.unlocked{border-color:var(--coin-gold);box-shadow:0 4px 16px rgba(255,215,0,0.3)}.badge.locked{opacity:0.4;filter:grayscale(100%)}.badge.code-required{border-style:dashed}.badge:hover{transform:translateY(-4px)}
    .badge-icon{font-size:48px;margin-bottom:8px}.badge-name{font-weight:700;font-size:14px;margin-bottom:4px}.badge-desc{font-size:11px;color:var(--muted);margin-bottom:8px}
    .badge-tag{font-size:10px;font-weight:700;padding:3px 8px;border-radius:6px;display:inline-block}
    .badge-tag.auto{background:rgba(0,255,136,0.15);color:var(--success);border:1px solid rgba(0,255,136,0.3)}.badge-tag.code{background:rgba(255,215,0,0.15);color:var(--coin-gold);border:1px solid rgba(255,215,0,0.3)}.badge-tag.earned{background:rgba(91,141,239,0.15);color:var(--accent);border:1px solid rgba(91,141,239,0.3)}
    .badge-code-area{margin-top:10px;display:none;flex-direction:column;gap:8px}.badge-code-area.show{display:flex}
    .badge-code-input{width:100%;padding:8px 12px;border-radius:8px;border:1px solid var(--border);background:rgba(91,141,239,0.05);color:var(--text);font-size:13px;font-weight:600;outline:none;transition:all 0.3s}
    .badge-code-input:focus{border-color:var(--accent);background:rgba(91,141,239,0.1)}
    .badge-code-submit{padding:7px 12px;border-radius:8px;border:1px solid var(--accent);background:rgba(91,141,239,0.15);color:var(--text);font-weight:700;cursor:pointer;font-size:12px;transition:all 0.3s}.badge-code-submit:hover{background:rgba(91,141,239,0.3)}
    .status-update{display:flex;align-items:center;gap:12px;padding:12px;background:rgba(91,141,239,0.05);border:1px solid var(--border);border-radius:12px}
    .status-input{flex:1;background:transparent;border:none;color:var(--text);outline:none;font-weight:500}
    /* SHORTCUTS */
    .shortcut-key{display:inline-block;padding:4px 8px;background:rgba(91,141,239,0.1);border:1px solid var(--border);border-radius:6px;font-family:'Courier New',monospace;font-size:12px;font-weight:700;margin:0 4px}
    .shortcut-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:rgba(91,141,239,0.05);border:1px solid var(--border);border-radius:8px;margin-bottom:8px;cursor:pointer;transition:all 0.3s}
    .shortcut-item:hover{border-color:var(--accent);background:rgba(91,141,239,0.1)}
    .shortcut-action{font-weight:600}.shortcut-keys{display:flex;gap:4px;align-items:center}
    .shortcut-recording{background:rgba(255,68,68,0.15);border:1px dashed var(--alert);border-radius:8px;padding:4px 10px;font-size:12px;font-weight:700;color:var(--alert);animation:recordPulse 1s ease-in-out infinite}
    @keyframes recordPulse{0%,100%{opacity:1}50%{opacity:0.5}}
    /* EVENTS */
    .events-banner{background:linear-gradient(135deg,rgba(255,68,68,0.15),rgba(255,136,0,0.15));border:2px solid rgba(255,68,68,0.4);border-radius:16px;padding:24px 28px;margin-bottom:20px;position:relative;overflow:hidden}
    .events-banner::before{content:"\26A0\FE0F";font-size:80px;position:absolute;right:20px;top:50%;transform:translateY(-50%);opacity:0.15}
    .events-banner h2{color:var(--alert);margin:0 0 8px;font-size:20px}.events-banner p{color:var(--text);margin:0;font-size:15px;line-height:1.6}
    .event-card{background:rgba(19,23,41,0.7);border:1px solid var(--border);border-radius:14px;padding:20px 24px;margin-bottom:16px;transition:all 0.3s}.event-card:hover{border-color:var(--accent)}
    .event-tag{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:10px}
    .event-tag.red{background:rgba(255,68,68,0.2);color:var(--alert);border:1px solid rgba(255,68,68,0.4)}.event-tag.blue{background:rgba(91,141,239,0.2);color:var(--accent);border:1px solid rgba(91,141,239,0.4)}
    .event-card h3{margin:0 0 8px;font-size:17px}.event-card p{margin:0;font-size:14px;color:var(--muted)}
    /* CATEGORY */
    .category-filter{display:flex;gap:8px;margin:16px 0;flex-wrap:wrap}
    .category-btn{padding:8px 16px;background:rgba(91,141,239,0.1);border:1px solid var(--border);border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;transition:all 0.3s}.category-btn:hover{background:rgba(91,141,239,0.2);border-color:var(--accent)}.category-btn.active{background:var(--accent);color:white;border-color:var(--accent)}
    /* MODAL */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);display:none;align-items:center;justify-content:center;z-index:10001;animation:fadeIn 0.3s ease}.modal.show{display:flex}
    .modal-content{background:rgba(19,23,41,0.95);backdrop-filter:blur(20px);border:2px solid var(--coin-gold);border-radius:20px;padding:40px;max-width:500px;text-align:center;box-shadow:0 16px 64px rgba(255,215,0,0.4);animation:slideUp 0.5s ease}
    @keyframes slideUp{from{opacity:0;transform:translateY(50px)}to{opacity:1;transform:translateY(0)}}
    .reward-icon{font-size:80px;margin-bottom:20px;animation:bounce 1s ease infinite}
    @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
    .reward-title{font-size:32px;font-weight:800;color:var(--coin-gold);margin-bottom:12px}.reward-text{font-size:18px;color:var(--muted);margin-bottom:24px}
    /* PLAYER */
    .player{position:fixed;inset:0;background:#000;display:none;z-index:9999;animation:fadeIn 0.3s ease}.player.open{display:block}
    .player-topbar{position:absolute;top:0;left:0;right:0;height:60px;display:flex;justify-content:space-between;align-items:center;padding:0 20px;background:rgba(0,0,0,0.8);backdrop-filter:blur(10px);color:#fff;border-bottom:1px solid rgba(255,255,255,0.1)}
    .player-exit{padding:10px 20px;border-radius:12px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,68,68,0.2);color:#fff;font-weight:800;cursor:pointer;transition:all 0.3s}.player-exit:hover{background:rgba(255,68,68,0.4);transform:scale(1.05)}
    .player-frame{position:absolute;top:60px;left:0;width:100%;height:calc(100% - 60px);border:0}
    form{max-width:600px;margin-top:12px}
    label{display:inline-block;margin-bottom:8px;font-weight:800;color:var(--text);font-size:12px;text-transform:uppercase;letter-spacing:0.12em}
    select,textarea,input[type="text"],input[type="password"],input[type="number"],input[type="file"]{width:100%;padding:12px 16px;margin-bottom:18px;border-radius:12px;border:1px solid var(--border);background:rgba(91,141,239,0.05);color:var(--text);outline:none;font-weight:600;transition:all 0.3s;font-family:inherit}
    select:focus,textarea:focus,input[type="text"]:focus,input[type="password"]:focus,input[type="number"]:focus{border-color:var(--accent);box-shadow:0 0 20px rgba(91,141,239,0.2);background:rgba(91,141,239,0.1)}
    textarea{resize:vertical;min-height:140px}select option{background:var(--panel);color:var(--text)}
    #status{margin-top:16px;color:var(--muted);font-weight:700;padding:12px;border-radius:12px;background:rgba(91,141,239,0.05)}.status-ok{color:var(--success);background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3)}.status-bad{color:var(--alert);background:rgba(255,68,68,0.1);border:1px solid rgba(255,68,68,0.3)}
    .google-sites-button{font-family:'Inter',Arial,sans-serif;font-size:14px;font-weight:700;letter-spacing:0.5px;text-transform:uppercase;padding:14px 32px;border-radius:12px;border:1px solid var(--accent);cursor:pointer;color:var(--text);background:rgba(91,141,239,0.15);box-shadow:0 4px 16px rgba(91,141,239,0.2);transition:all 0.3s}
    .google-sites-button:hover{background:rgba(91,141,239,0.3);box-shadow:0 8px 32px rgba(91,141,239,0.4);transform:translateY(-4px)}
    /* ADMIN */
    .admin-section{max-width:900px}.admin-section h1{background:linear-gradient(135deg,#ff4444,#ff8800);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .admin-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:20px;margin-top:24px}
    .admin-card{background:rgba(19,23,41,0.7);backdrop-filter:blur(20px);border:1px solid rgba(255,68,68,0.2);border-radius:18px;padding:24px;transition:all 0.3s}.admin-card:hover{border-color:rgba(255,68,68,0.4);box-shadow:0 8px 32px rgba(255,68,68,0.1)}
    .admin-card h2{font-size:16px;font-weight:800;text-transform:uppercase;letter-spacing:0.1em;color:var(--alert);margin:0 0 16px;display:flex;align-items:center;gap:8px}
    .admin-input{width:100%;padding:10px 14px;margin-bottom:10px;border-radius:10px;border:1px solid rgba(255,68,68,0.2);background:rgba(255,68,68,0.04);color:var(--text);outline:none;font-weight:600;transition:all 0.3s;font-family:inherit;font-size:13px}
    .admin-input:focus{border-color:var(--alert);box-shadow:0 0 16px rgba(255,68,68,0.2);background:rgba(255,68,68,0.08)}
    .admin-btn{padding:10px 20px;border-radius:10px;border:1px solid rgba(255,68,68,0.4);background:rgba(255,68,68,0.15);color:var(--text);font-weight:800;cursor:pointer;font-size:13px;transition:all 0.3s;font-family:inherit}.admin-btn:hover{background:rgba(255,68,68,0.3);border-color:var(--alert);box-shadow:0 4px 16px rgba(255,68,68,0.3);transform:translateY(-1px)}
    .admin-btn.green{border-color:rgba(0,255,136,0.4);background:rgba(0,255,136,0.1)}.admin-btn.green:hover{background:rgba(0,255,136,0.25);border-color:var(--success)}
    .admin-btn.blue{border-color:rgba(91,141,239,0.4);background:rgba(91,141,239,0.1)}.admin-btn.blue:hover{background:rgba(91,141,239,0.25);border-color:var(--accent)}
    .admin-feedback{margin-top:10px;font-size:12px;font-weight:700;color:var(--accent);min-height:18px}.admin-feedback.ok{color:var(--success)}.admin-feedback.err{color:var(--alert)}
    .admin-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .admin-badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:800;background:rgba(255,68,68,0.2);border:1px solid rgba(255,68,68,0.4);color:var(--alert);letter-spacing:0.05em;margin-bottom:12px}
    /* CHAT */
    #chat.page-section{padding:0;overflow:hidden}
    .nova-chat-wrap{display:grid;grid-template-columns:72px 240px 1fr 260px;height:100%;overflow:hidden;background:rgba(8,11,24,0.85)}
    .chat-icon-rail{display:flex;flex-direction:column;align-items:center;padding:16px 0;gap:8px;border-right:1px solid var(--border);background:rgba(5,7,18,0.9)}
    .rail-icon{width:44px;height:44px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:all 0.25s;border:1px solid transparent;position:relative;color:var(--muted)}
    .rail-icon:hover{background:var(--hover);border-color:var(--accent);color:var(--text)}.rail-icon.active{background:var(--active);border-color:var(--accent);color:var(--accent);box-shadow:0 0 16px rgba(91,141,239,0.3)}
    .rail-icon .rail-tooltip{position:absolute;left:calc(100% + 10px);top:50%;transform:translateY(-50%);background:rgba(19,23,41,0.98);border:1px solid var(--border);border-radius:8px;padding:6px 10px;font-size:12px;font-weight:700;white-space:nowrap;color:var(--text);pointer-events:none;opacity:0;transition:opacity 0.2s;z-index:100}
    .rail-icon:hover .rail-tooltip{opacity:1}
    .rail-divider{width:32px;height:1px;background:var(--border);margin:4px 0}.rail-spacer{flex:1}
    .chat-sidebar-panel{display:flex;flex-direction:column;border-right:1px solid var(--border);background:rgba(10,13,28,0.8);overflow:hidden}
    .sidebar-header{padding:16px 18px 12px;border-bottom:1px solid var(--border);background:rgba(5,7,18,0.6)}
    .sidebar-header-title{font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:0.15em;color:var(--accent);margin-bottom:10px;display:flex;align-items:center;gap:8px}
    .sidebar-header-title::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--accent);box-shadow:0 0 8px var(--accent);display:inline-block}
    .chat-search-box{display:flex;align-items:center;gap:8px;background:rgba(91,141,239,0.06);border:1px solid var(--border);border-radius:10px;padding:8px 12px;transition:all 0.3s}.chat-search-box:focus-within{border-color:var(--accent);background:rgba(91,141,239,0.1)}
    .chat-search-box span{color:var(--muted);font-size:14px}.chat-search-box input{background:transparent;border:none;outline:none;color:var(--text);font-size:13px;font-weight:500;width:100%;padding:0;margin:0}
    .sidebar-section-label{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:0.15em;color:var(--muted);padding:12px 18px 6px;display:flex;align-items:center;justify-content:space-between}
    .sidebar-section-label button{background:none;border:none;color:var(--muted);cursor:pointer;font-size:16px;line-height:1;padding:0;transition:color 0.2s}.sidebar-section-label button:hover{color:var(--accent)}
    .sidebar-list{overflow-y:auto;flex:1;padding-bottom:12px}.sidebar-list::-webkit-scrollbar{width:4px}.sidebar-list::-webkit-scrollbar-thumb{background:rgba(91,141,239,0.2);border-radius:2px}
    .chat-entry{display:flex;align-items:center;gap:10px;padding:9px 18px;cursor:pointer;transition:all 0.2s;border-left:2px solid transparent;position:relative}
    .chat-entry:hover{background:rgba(91,141,239,0.08);border-left-color:rgba(91,141,239,0.4)}.chat-entry.active-chat{background:rgba(91,141,239,0.15);border-left-color:var(--accent)}
    .chat-entry-avatar{width:36px;height:36px;border-radius:10px;flex-shrink:0;background:rgba(91,141,239,0.2);border:1px solid var(--border);overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--accent)}
    .chat-entry-avatar img{width:100%;height:100%;object-fit:cover;border-radius:9px}
    .online-dot{position:absolute;bottom:-2px;right:-2px;width:10px;height:10px;border-radius:50%;background:var(--online);border:2px solid rgba(5,7,18,0.9)}
    .chat-entry-info{flex:1;overflow:hidden}.chat-entry-name{font-size:13px;font-weight:700;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chat-entry-preview{font-size:11px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:1px}
    .chat-entry-meta{display:flex;flex-direction:column;align-items:flex-end;gap:4px}.chat-entry-time{font-size:10px;color:var(--muted)}
    .chat-remove-btn{background:none;border:none;color:transparent;cursor:pointer;font-size:12px;padding:2px 4px;border-radius:4px;transition:all 0.2s}
    .chat-entry:hover .chat-remove-btn{color:rgba(255,68,68,0.6)}.chat-entry:hover .chat-remove-btn:hover{color:var(--alert);background:rgba(255,68,68,0.1)}
    .add-friend-btn{display:flex;align-items:center;gap:8px;margin:8px 18px;padding:10px 14px;background:rgba(91,141,239,0.08);border:1px dashed rgba(91,141,239,0.3);border-radius:10px;cursor:pointer;transition:all 0.3s;font-size:13px;font-weight:600;color:var(--muted)}.add-friend-btn:hover{background:rgba(91,141,239,0.15);border-color:var(--accent);color:var(--text)}
    .chat-main-area{display:flex;flex-direction:column;background:rgba(8,11,24,0.7);overflow:hidden;position:relative}
    .chat-topbar{display:flex;align-items:center;gap:12px;padding:14px 20px;border-bottom:1px solid var(--border);background:rgba(5,7,18,0.7);backdrop-filter:blur(10px);flex-shrink:0}
    .chat-topbar-avatar{width:38px;height:38px;border-radius:10px;background:rgba(91,141,239,0.2);border:1px solid var(--border);overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:var(--accent);cursor:pointer;transition:all 0.2s}.chat-topbar-avatar:hover{border-color:var(--accent);box-shadow:0 0 12px var(--accent-glow)}.chat-topbar-avatar img{width:100%;height:100%;object-fit:cover}
    .chat-topbar-info{flex:1}.chat-topbar-name{font-size:15px;font-weight:800;color:var(--text);cursor:pointer}.chat-topbar-name:hover{color:var(--accent)}.chat-topbar-status{font-size:11px;color:var(--muted);display:flex;align-items:center;gap:5px}
    .chat-topbar-status .status-dot{width:6px;height:6px;border-radius:50%;background:var(--online);display:inline-block}
    .topbar-actions{display:flex;gap:8px}
    .topbar-btn{width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:rgba(91,141,239,0.08);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;color:var(--muted);position:relative}.topbar-btn:hover{background:rgba(91,141,239,0.2);border-color:var(--accent);color:var(--text)}
    .topbar-btn .rail-tooltip{left:auto;right:calc(100% + 10px)}
    .chat-messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:2px;background:rgba(8,11,24,0.4)}.chat-messages::-webkit-scrollbar{width:6px}.chat-messages::-webkit-scrollbar-thumb{background:rgba(91,141,239,0.2);border-radius:3px}
    .msg-date-sep{display:flex;align-items:center;gap:12px;margin:16px 0;font-size:11px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.1em}.msg-date-sep::before,.msg-date-sep::after{content:'';flex:1;height:1px;background:var(--border)}
    .nova-msg{display:flex;gap:10px;padding:4px 8px;border-radius:10px;transition:background 0.15s;position:relative}.nova-msg:hover{background:rgba(255,255,255,0.03)}.nova-msg.is-me{flex-direction:row-reverse}
    .nova-msg-avatar{width:34px;height:34px;border-radius:8px;flex-shrink:0;background:rgba(91,141,239,0.2);border:1px solid var(--border);overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--accent);cursor:pointer;align-self:flex-end;margin-bottom:2px}.nova-msg-avatar img{width:100%;height:100%;object-fit:cover}
    .nova-msg-body{max-width:68%;display:flex;flex-direction:column}.nova-msg.is-me .nova-msg-body{align-items:flex-end}
    .nova-msg-header{display:flex;align-items:baseline;gap:8px;margin-bottom:3px}.nova-msg.is-me .nova-msg-header{flex-direction:row-reverse}
    .nova-msg-sender{font-size:12px;font-weight:800;color:var(--accent);cursor:pointer}.nova-msg-sender:hover{text-decoration:underline}.nova-msg-time{font-size:10px;color:var(--muted)}
    .nova-msg-bubble{padding:10px 14px;border-radius:14px;font-size:14px;line-height:1.55;word-wrap:break-word;background:rgba(255,255,255,0.05);border:1px solid var(--border);border-bottom-left-radius:4px}
    .nova-msg.is-me .nova-msg-bubble{background:linear-gradient(135deg,rgba(91,141,239,0.35),rgba(74,123,216,0.35));border-color:rgba(91,141,239,0.4);border-bottom-right-radius:4px;border-bottom-left-radius:14px}
    .nova-msg-status{font-size:10px;color:var(--muted);margin-top:3px;text-align:right}
    .typing-indicator{display:none;align-items:center;gap:8px;padding:8px 20px;font-size:12px;color:var(--muted);font-style:italic}.typing-indicator.show{display:flex}
    .typing-dots{display:flex;gap:3px}.typing-dots span{width:5px;height:5px;border-radius:50%;background:var(--muted);animation:typingPulse 1.4s ease-in-out infinite}.typing-dots span:nth-child(2){animation-delay:0.2s}.typing-dots span:nth-child(3){animation-delay:0.4s}
    @keyframes typingPulse{0%,60%,100%{transform:translateY(0);opacity:0.4}30%{transform:translateY(-4px);opacity:1}}
    .chat-input-bar{padding:16px 20px;border-top:1px solid var(--border);background:rgba(5,7,18,0.8);backdrop-filter:blur(10px);flex-shrink:0}
    .chat-input-inner{display:flex;align-items:center;gap:10px;background:rgba(91,141,239,0.06);border:1px solid var(--border);border-radius:14px;padding:10px 14px;transition:all 0.3s}.chat-input-inner:focus-within{border-color:var(--accent);background:rgba(91,141,239,0.1);box-shadow:0 0 20px rgba(91,141,239,0.15)}
    .input-action-btn{width:32px;height:32px;border-radius:8px;border:none;background:transparent;cursor:pointer;color:var(--muted);font-size:16px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;flex-shrink:0}.input-action-btn:hover{background:rgba(91,141,239,0.15);color:var(--text)}
    .nova-chat-input{flex:1;background:transparent;border:none;outline:none;color:var(--text);font-size:14px;font-weight:500;font-family:inherit;resize:none;max-height:100px;line-height:1.5}.nova-chat-input::placeholder{color:var(--muted)}
    .send-btn{width:36px;height:36px;border-radius:10px;flex-shrink:0;background:linear-gradient(135deg,var(--accent),#4a7bd8);border:none;cursor:pointer;color:white;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;box-shadow:0 2px 12px rgba(91,141,239,0.4)}.send-btn:hover{transform:scale(1.05);box-shadow:0 4px 20px rgba(91,141,239,0.6)}.send-btn:active{transform:scale(0.95)}
    .chat-empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--muted);text-align:center;padding:40px}.chat-empty-icon{font-size:64px;margin-bottom:16px;opacity:0.5}.chat-empty-title{font-size:20px;font-weight:700;margin-bottom:8px;color:var(--text);opacity:0.6}.chat-empty-desc{font-size:14px}
    .chat-right-panel{border-left:1px solid var(--border);background:rgba(10,13,28,0.8);display:flex;flex-direction:column;overflow:hidden}
    .right-panel-header{padding:16px 18px;border-bottom:1px solid var(--border);font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:0.15em;color:var(--muted);display:flex;align-items:center;gap:8px}
    .right-panel-body{overflow-y:auto;flex:1;padding:12px}.right-panel-body::-webkit-scrollbar{width:4px}.right-panel-body::-webkit-scrollbar-thumb{background:rgba(91,141,239,0.2);border-radius:2px}
    .member-card{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;cursor:pointer;transition:all 0.2s;margin-bottom:4px}.member-card:hover{background:rgba(91,141,239,0.1)}
    .member-avatar{width:36px;height:36px;border-radius:10px;background:rgba(91,141,239,0.2);border:1px solid var(--border);overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--accent);flex-shrink:0;position:relative}.member-avatar img{width:100%;height:100%;object-fit:cover}
    .member-name{font-size:13px;font-weight:700}.member-status{font-size:11px;color:var(--muted)}.member-offline{opacity:0.5}
    .right-panel-stat{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-radius:10px;background:rgba(91,141,239,0.06);border:1px solid var(--border);margin-bottom:8px}
    .stat-label{font-size:11px;color:var(--muted);font-weight:600}.stat-value{font-size:14px;font-weight:800;color:var(--accent)}
    /* PROFILE PAGE */
    .profile-container{max-width:700px;margin:0 auto}
    .requests-section{margin-top:32px}.requests-section h3{font-size:20px;margin-bottom:16px}
    .request-item{display:flex;align-items:center;justify-content:space-between;padding:16px;background:rgba(19,23,41,0.6);border:1px solid var(--border);border-radius:14px;margin-bottom:12px;transition:all 0.3s}
    body.light-mode .request-item{background:rgba(255,255,255,0.8)}.request-item:hover{border-color:var(--accent);box-shadow:0 4px 20px rgba(91,141,239,0.2)}
    .request-user{display:flex;align-items:center;gap:14px}.request-actions{display:flex;gap:10px}
    .accept-btn{background:rgba(0,255,136,0.2);color:var(--success);border:1px solid var(--success);padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:800;transition:all 0.3s}.accept-btn:hover{background:rgba(0,255,136,0.3)}
    .decline-btn{background:rgba(255,68,68,0.2);color:var(--alert);border:1px solid var(--alert);padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:800;transition:all 0.3s}.decline-btn:hover{background:rgba(255,68,68,0.3)}
    .avatar-circle{width:40px;height:40px;border-radius:50%;background:rgba(0,0,0,0.5);border:2px solid var(--border);object-fit:cover;margin-right:14px}
    .auth-status-msg{margin-top:10px;font-weight:700;font-size:13px;padding:8px 12px;border-radius:8px;display:none}.auth-status-msg.show{display:block}
    .auth-status-msg.error{color:var(--alert);background:rgba(255,68,68,0.1);border:1px solid rgba(255,68,68,0.3)}.auth-status-msg.success{color:var(--success);background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.3)}.auth-status-msg.warning{color:#ffaa00;background:rgba(255,170,0,0.1);border:1px solid rgba(255,170,0,0.3)}
    #image-popup-overlay{position:fixed;inset:0;z-index:99999;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center}#image-popup-overlay.show{display:flex}
    #image-popup-img{max-width:90vw;max-height:90vh;border-radius:16px;box-shadow:0 16px 64px rgba(0,0,0,0.8)}
    @media(max-width:1100px){.nova-chat-wrap{grid-template-columns:72px 220px 1fr}.chat-right-panel{display:none}}
    @media(max-width:768px){.app{grid-template-columns:1fr}aside{display:none}.header-info{display:none}.nova-chat-wrap{grid-template-columns:1fr}.chat-icon-rail,.chat-sidebar-panel{display:none}.admin-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="bg-container">
  <div class="custom-bg" id="custom-bg"></div>
  <div class="gradient-wave"></div>
  <div class="orb orb-1"></div><div class="orb orb-2"></div><div class="orb orb-3"></div>
  <div class="particles" id="particles-container"></div>
  <div class="grid-overlay"></div>
  <div class="scanline"></div>
  <div class="energy-ring"></div><div class="energy-ring"></div><div class="energy-ring"></div>
</div>

<div class="app">
  <header>
    <div class="brand">Nova</div>
    <div class="header-info">
      <div class="info-item"><span class="info-label">Time</span><span class="info-value" id="current-time">00:00:00</span></div>
      <div class="info-item"><span class="info-label">Status</span><span class="info-value" id="auth-display">Guest</span></div>
      <div class="coin-display" onclick="showPage('shop')"><div class="coin-icon">ü™ô</div><span id="coin-count">0</span> NC</div>
    </div>
  </header>

  <aside>
    <div class="nav-title">Navigation</div>
    <nav class="nav">
      <a data-page="home" class="active">üè† <span>Home</span><div class="dot"></div></a>
      <a data-page="games">üéÆ <span>Games</span><div class="dot"></div></a>
      <a data-page="movies">üé¨ <span>Movies & TV</span><div class="dot"></div></a>
      <a data-page="shop">üõí <span>Shop</span><div class="dot"></div></a>
      <a data-page="chat">üí¨ <span>Chat</span><div class="dot"></div></a>
      <a data-page="events">üì¢ <span>Events</span><div class="dot"></div></a>
      <a data-page="badges">üèÖ <span>Badges</span><div class="dot"></div></a>
      <a data-page="settings">‚öôÔ∏è <span>Settings</span><div class="dot"></div></a>
      <a data-page="profile">üë§ <span>Profile</span><div class="dot"></div></a>
      <a data-page="admin" id="admin-nav" style="display:none" class="admin-nav-item">üõ°Ô∏è <span>Admin</span><div class="dot"></div></a>
    </nav>
  </aside>

  <main>
    <!-- HOME -->
    <section id="home" class="page-section active">
      <div class="card">
        <h1>Welcome to Nova üöÄ</h1>
        <p>Your gateway to entertainment, community, and fun. Earn Nova Coins, unlock badges, and explore everything.</p>
        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:8px">
          <button class="btn" onclick="showPage('games')">üéÆ Games</button>
          <button class="btn" onclick="showPage('movies')">üé¨ Movies</button>
          <button class="btn" onclick="showPage('shop')">üõí Shop</button>
          <button class="btn" onclick="showPage('chat')">üí¨ Chat</button>
        </div>
      </div>
      <div class="row">
        <div class="row-title">Featured Games</div>
        <div class="scroller" id="home-games-scroller"></div>
      </div>
    </section>

    <!-- GAMES -->
    <section id="games" class="page-section">
      <div class="card">
        <h1>üéÆ Games</h1>
        <p>Play browser games, proxied titles, and more. Earn coins while you play!</p>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button class="btn" onclick="toggleGridMode()">‚äû Toggle Grid</button>
          <button class="btn" onclick="openWaterGame()">üíß Water Game</button>
        </div>
        <div class="search-wrap">
          <input class="search-input" id="game-search" placeholder="Search games..." oninput="filterGames()">
          <button class="clear-btn" onclick="clearSearch('game-search',filterGames)">‚úï Clear</button>
        </div>
        <div class="category-filter" id="game-categories"></div>
      </div>
      <div class="row"><div class="row-title">All Games</div><div class="scroller" id="games-scroller"></div></div>
    </section>

    <!-- MOVIES -->
    <section id="movies" class="page-section">
      <div class="card">
        <h1>üé¨ Movies & TV</h1>
        <p>Stream movies and shows right in your browser.</p>
        <div class="search-wrap">
          <input class="search-input" id="movie-search" placeholder="Search titles..." oninput="filterMovies()">
          <button class="clear-btn" onclick="clearSearch('movie-search',filterMovies)">‚úï Clear</button>
        </div>
        <div class="category-filter" id="movie-categories"></div>
      </div>
      <div class="row"><div class="row-title">Movies</div><div class="scroller" id="movies-scroller"></div></div>
      <div class="row"><div class="row-title">TV Shows</div><div class="scroller" id="shows-scroller"></div></div>
    </section>

    <!-- SHOP -->
    <section id="shop" class="page-section">
      <div class="card">
        <h1>üõí Nova Shop</h1>
        <p>Spend your Nova Coins on backgrounds, games, and exclusive banners!</p>
        <div class="coin-display" style="display:inline-flex;margin-top:8px"><div class="coin-icon">ü™ô</div><span id="shop-coin-count">0</span> NC available</div>
      </div>
      <div class="row">
        <div class="row-title">üé® Profile Banners</div>
        <div class="scroller" id="banner-shop-scroller"></div>
      </div>
      <div class="row">
        <div class="row-title">üñºÔ∏è Backgrounds</div>
        <div class="scroller" id="bg-shop-scroller"></div>
      </div>
      <div class="row">
        <div class="row-title">üéÆ Premium Games</div>
        <div class="scroller" id="shop-games-scroller"></div>
      </div>
    </section>

    <!-- CHAT -->
    <section id="chat" class="page-section">
      <div class="nova-chat-wrap">
        <div class="chat-icon-rail">
          <div class="rail-icon active" title="Friends" onclick="switchChatPanel('friends')">üë•<span class="rail-tooltip">Friends</span></div>
          <div class="rail-icon" title="Groups" onclick="switchChatPanel('groups')">üåê<span class="rail-tooltip">Groups</span></div>
          <div class="rail-divider"></div>
          <div class="rail-icon" title="Nova Global" onclick="openGlobalChat()">üåç<span class="rail-tooltip">Global Chat</span></div>
          <div class="rail-spacer"></div>
          <div class="rail-icon" title="Settings" onclick="showPage('settings')">‚öôÔ∏è<span class="rail-tooltip">Settings</span></div>
        </div>
        <div class="chat-sidebar-panel">
          <div class="sidebar-header">
            <div class="sidebar-header-title" id="chat-panel-title">FRIENDS</div>
            <div class="chat-search-box"><span>üîç</span><input placeholder="Search..." id="chat-search-input" oninput="filterChatList()"></div>
          </div>
          <div class="sidebar-list" id="friend-list"></div>
          <div class="add-friend-btn" onclick="promptAddFriend()">‚ûï Add Friend</div>
        </div>
        <div class="chat-main-area">
          <div class="chat-empty-state" id="chat-empty">
            <div class="chat-empty-icon">üí¨</div>
            <div class="chat-empty-title">No Conversation Selected</div>
            <div class="chat-empty-desc">Select a friend or group to start chatting</div>
          </div>
          <div id="chat-active" style="display:none;flex-direction:column;height:100%">
            <div class="chat-topbar">
              <div class="chat-topbar-avatar" id="chat-partner-avatar" onclick="openChatPartnerProfile()">?</div>
              <div class="chat-topbar-info">
                <div class="chat-topbar-name" id="chat-partner-name" onclick="openChatPartnerProfile()">Select a chat</div>
                <div class="chat-topbar-status"><span class="status-dot"></span><span id="chat-partner-status">Online</span></div>
              </div>
              <div class="topbar-actions">
                <div class="topbar-btn" title="Profile" onclick="openChatPartnerProfile()">üë§<span class="rail-tooltip">Profile</span></div>
                <div class="topbar-btn" title="Clear Chat" onclick="clearCurrentChat()">üóëÔ∏è<span class="rail-tooltip">Clear</span></div>
              </div>
            </div>
            <div class="chat-messages" id="chat-messages"></div>
            <div class="typing-indicator" id="typing-indicator"><div class="typing-dots"><span></span><span></span><span></span></div><span id="typing-name">is typing...</span></div>
            <div class="chat-input-bar">
              <div class="chat-input-inner">
                <button class="input-action-btn" onclick="pickEmoji()" title="Emoji">üòä</button>
                <textarea class="nova-chat-input" id="chat-input" placeholder="Message..." rows="1" onkeydown="handleChatKey(event)" oninput="autoResize(this)"></textarea>
                <button class="send-btn" onclick="sendMessage()">‚û§</button>
              </div>
            </div>
          </div>
        </div>
        <div class="chat-right-panel">
          <div class="right-panel-header">üìä Chat Info</div>
          <div class="right-panel-body" id="chat-right-panel-body">
            <div class="right-panel-stat"><span class="stat-label">Messages Sent</span><span class="stat-value" id="stat-sent">0</span></div>
            <div class="right-panel-stat"><span class="stat-label">Friends Online</span><span class="stat-value" id="stat-online">0</span></div>
            <div style="font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:0.15em;color:var(--muted);margin:16px 0 8px">Online Members</div>
            <div id="online-members-list"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- EVENTS -->
    <section id="events" class="page-section">
      <div class="events-banner">
        <h2>‚ö†Ô∏è Active Warning</h2>
        <p><strong>Admin Abuse during school and after school.</strong> Multiple reports have been submitted regarding administrator misconduct both during school hours and after school. If you have experienced or witnessed admin abuse, please report it using the form below.</p>
      </div>
      <div class="event-card">
        <span class="event-tag red">üî¥ ONGOING</span>
        <h3>Admin Abuse ‚Äî School Hours</h3>
        <p>Reports indicate misuse of administrative privileges during school hours. This includes unfair bans, unauthorized data access, and harassment. Investigation is ongoing.</p>
      </div>
      <div class="event-card">
        <span class="event-tag red">üî¥ ONGOING</span>
        <h3>Admin Abuse ‚Äî After School</h3>
        <p>After-school incidents have also been reported. Admins are urged to follow community guidelines at all times. Any proven abuse will result in immediate removal of admin access.</p>
      </div>
      <div class="event-card">
        <span class="event-tag blue">‚ÑπÔ∏è INFO</span>
        <h3>How to Report</h3>
        <p>To report admin abuse, contact a Nova Moderator directly in the Chat, or use the Admin panel's report function if available. All reports are confidential and taken seriously.</p>
      </div>
    </section>

    <!-- BADGES -->
    <section id="badges" class="page-section">
      <div class="card"><h1>üèÖ Badges</h1><p>Earn badges by using Nova, entering codes, or reaching milestones.</p></div>
      <div class="badge-container" id="badge-container"></div>
    </section>

    <!-- SETTINGS -->
    <section id="settings" class="page-section">
      <div class="card settings-container">
        <h1>‚öôÔ∏è Settings</h1>
        <div class="settings-group">
          <h2>üîê Account</h2>
          <div class="setting-item">
            <div class="setting-info"><div class="setting-title">Register</div><div class="setting-desc">Create a new Nova account</div></div>
          </div>
          <form id="register-form" onsubmit="event.preventDefault(); registerUser()">
            <label>Username</label><input type="text" id="reg-username" placeholder="Choose a username" autocomplete="off">
            <label>Password</label><input type="password" id="reg-password" placeholder="Choose a password">
            <label>Email (optional)</label><input type="text" id="reg-email" placeholder="your@email.com">
            <button type="submit" class="btn">Create Account</button>
            <div class="auth-status-msg" id="register-status"></div>
          </form>
          <div class="setting-item" style="margin-top:24px">
            <div class="setting-info"><div class="setting-title">Login</div><div class="setting-desc">Sign into your account</div></div>
          </div>
          <form id="login-form" onsubmit="event.preventDefault(); loginUser()">
            <label>Username</label><input type="text" id="login-username" placeholder="Your username" autocomplete="off">
            <label>Password</label><input type="password" id="login-password" placeholder="Your password">
            <button type="submit" class="btn">Login</button>
            <div class="auth-status-msg" id="login-status"></div>
          </form>
          <button class="btn" style="margin-top:16px;background:rgba(255,68,68,0.15);border-color:rgba(255,68,68,0.4)" onclick="logoutUser()">Logout</button>
        </div>
        <div class="settings-group">
          <h2>üé® Appearance</h2>
          <div class="setting-item">
            <div class="setting-info"><div class="setting-title">Light Mode</div><div class="setting-desc">Switch to light theme</div></div>
            <div class="toggle-switch" id="light-toggle" onclick="toggleSetting('lightMode')"></div>
          </div>
          <div class="setting-item">
            <div class="setting-info"><div class="setting-title">Performance Mode</div><div class="setting-desc">Disable animations for better performance</div></div>
            <div class="toggle-switch" id="perf-toggle" onclick="toggleSetting('performanceMode')"></div>
          </div>
          <div class="setting-item">
            <div class="setting-info"><div class="setting-title">Custom Background</div><div class="setting-desc">Upload your own background image</div></div>
            <div class="file-input-wrapper">
              <input type="file" id="bg-upload" accept="image/*" onchange="uploadBackground(event)">
              <label class="file-input-label" for="bg-upload">üìÅ Choose Image</label>
            </div>
          </div>
          <div class="setting-item">
            <div class="setting-info"><div class="setting-title">Remove Background</div><div class="setting-desc">Revert to default animated background</div></div>
            <button class="btn" onclick="removeBackground()">üóëÔ∏è Remove</button>
          </div>
        </div>
        <div class="settings-group">
          <h2>‚å®Ô∏è Shortcuts</h2>
          <p style="color:var(--muted);font-size:13px;margin-bottom:16px">Click any shortcut to rebind it. Press a key combo (Ctrl/Alt/Shift + key) to set it.</p>
          <div id="shortcuts-list"></div>
        </div>
        <div class="settings-group">
          <h2>üîî Notifications</h2>
          <div class="setting-item">
            <div class="setting-info"><div class="setting-title">Sound Effects</div><div class="setting-desc">Play sounds for messages</div></div>
            <div class="toggle-switch" id="sound-toggle" onclick="toggleSetting('soundEnabled')"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile" class="page-section">
      <div class="profile-container">
        <div class="card" style="padding:0;overflow:hidden" id="profile-card">
          <div class="profile-header-with-banner">
            <div class="profile-banner-wrapper" onclick="showPage('shop')" title="Get banners in the Shop">
              <div class="profile-banner" id="profile-banner-display">
                <span style="opacity:0.3;font-size:36px;font-weight:900;letter-spacing:8px">NOVA</span>
              </div>
              <div class="profile-banner-label">Click to browse banners</div>
            </div>
            <div class="profile-header-overlay">
              <div class="profile-pic-wrapper">
                <img class="profile-pic" id="profile-pic" src="https://via.placeholder.com/100" alt="Profile Picture">
                <button class="change-pic-btn" onclick="document.getElementById('pic-upload').click()" title="Change picture">‚úèÔ∏è</button>
                <input type="file" id="pic-upload" accept="image/*" style="display:none" onchange="uploadProfilePic(event)">
              </div>
              <div class="profile-info">
                <h2 id="profile-username">Guest</h2>
                <p class="status" id="profile-status">Offline</p>
              </div>
            </div>
          </div>
          <div style="padding:0 24px 24px">
            <div class="status-update">
              <input class="status-input" id="status-input" placeholder="Set a status..." onkeydown="if(event.key==='Enter'){updateStatus();event.preventDefault()}">
              <button class="btn" onclick="updateStatus()">Update</button>
            </div>
          </div>
        </div>

        <div class="requests-section">
          <h3>üë• Friend Requests</h3>
          <div id="requests-list"><p class="empty">No pending requests</p></div>
        </div>

        <!-- VIEW USER PROFILE (hidden by default) -->
        <div id="view-profile-section" style="display:none">
          <div class="card" style="padding:0;overflow:hidden">
            <div class="profile-header-with-banner">
              <div class="profile-banner-wrapper" style="cursor:default">
                <div class="profile-banner" id="view-banner-display">
                  <span style="opacity:0.3;font-size:36px;font-weight:900;letter-spacing:8px">NOVA</span>
                </div>
              </div>
              <div class="profile-header-overlay">
                <div class="profile-pic-wrapper">
                  <img class="profile-pic" id="view-pic" src="https://via.placeholder.com/100" alt="Profile">
                </div>
                <div class="profile-info">
                  <h2 id="view-username">User</h2>
                  <p class="status" id="view-status">Offline</p>
                </div>
              </div>
            </div>
            <div style="padding:0 24px 24px;display:flex;gap:12px;flex-wrap:wrap">
              <button class="btn" onclick="sendFriendRequestToUser()">‚ûï Add Friend</button>
              <button class="btn" onclick="messageUser()">üí¨ Message</button>
              <button class="btn" style="background:rgba(255,68,68,0.1);border-color:rgba(255,68,68,0.3)" onclick="closeViewProfile()">‚úï Close</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="admin" class="page-section">
      <div class="admin-section">
        <div class="card" style="border-color:rgba(255,68,68,0.3)">
          <h1>üõ°Ô∏è Admin Panel</h1>
          <div class="admin-badge">RESTRICTED ACCESS</div>
          <p>Administrative controls for Nova. Handle with care.</p>
        </div>
        <div class="admin-grid">
          <div class="admin-card">
            <h2>üí∞ Manage Coins</h2>
            <input class="admin-input" id="admin-target-user" placeholder="Target username">
            <input class="admin-input" id="admin-coin-amount" type="number" placeholder="Coin amount">
            <div class="admin-row">
              <button class="admin-btn green" onclick="adminGiveCoins()">‚ûï Give Coins</button>
              <button class="admin-btn" onclick="adminRemoveCoins()">‚ûñ Remove Coins</button>
            </div>
            <div class="admin-feedback" id="admin-coins-fb"></div>
          </div>
          <div class="admin-card">
            <h2>üèÖ Manage Badges</h2>
            <input class="admin-input" id="admin-badge-user" placeholder="Target username">
            <input class="admin-input" id="admin-badge-id" placeholder="Badge ID">
            <button class="admin-btn blue" onclick="adminGrantBadge()">üèÖ Grant Badge</button>
            <div class="admin-feedback" id="admin-badge-fb"></div>
          </div>
          <div class="admin-card">
            <h2>üì¢ Broadcast</h2>
            <textarea class="admin-input" id="admin-broadcast-msg" placeholder="Message to broadcast..." style="min-height:80px"></textarea>
            <button class="admin-btn blue" onclick="adminBroadcast()">üì¢ Send to All</button>
            <div class="admin-feedback" id="admin-broadcast-fb"></div>
          </div>
          <div class="admin-card">
            <h2>üë§ User Lookup</h2>
            <input class="admin-input" id="admin-lookup-user" placeholder="Username to look up">
            <button class="admin-btn blue" onclick="adminLookup()">üîç Lookup</button>
            <div class="admin-feedback" id="admin-lookup-fb" style="white-space:pre-line"></div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<!-- MODAL -->
<div class="modal" id="reward-modal">
  <div class="modal-content">
    <div class="reward-icon" id="modal-icon">üéâ</div>
    <div class="reward-title" id="modal-title">Congratulations!</div>
    <div class="reward-text" id="modal-text">You earned something!</div>
    <button class="btn" onclick="closeModal()">Awesome! üöÄ</button>
  </div>
</div>

<!-- VIDEO PLAYER -->
<div class="player" id="player">
  <div class="player-topbar">
    <span id="player-title">Now Playing</span>
    <button class="player-exit" onclick="closePlayer()">‚úï Exit</button>
  </div>
  <iframe class="player-frame" id="player-frame" allowfullscreen></iframe>
</div>

<!-- IMAGE POPUP -->
<div id="image-popup-overlay" onclick="this.classList.remove('show')"><img id="image-popup-img" src="" alt=""></div>

<!-- NOTIFICATION -->
<div class="notification" id="notification">
  <span class="notification-icon" id="notif-icon">‚úÖ</span>
  <span class="notification-text" id="notif-text">Done!</span>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
<script>
// ============================================
// FIREBASE CONFIG
// ============================================
const firebaseConfig = {
  apiKey: "AIzaSyDxL3K4nkGKkAqNr-BEh7cq6RfHuZ6GV8c",
  authDomain: "nova-platform-app.firebaseapp.com",
  databaseURL: "https://nova-platform-app-default-rtdb.firebaseio.com",
  projectId: "nova-platform-app",
  storageBucket: "nova-platform-app.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:abcdef"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ============================================
// GLOBAL STATE
// ============================================
let novaCoins = 0;
let purchasedGames = [];
let purchasedBgs = [];
let settings = { lightMode: false, performanceMode: false, soundEnabled: true };
let favorites = {};
let currentChatPartner = null;
let chatPanel = 'friends';
let messagesSentCount = 0;
let coinInterval = null;
let viewedUserName = null;
let recordingShortcut = null;

// Custom shortcuts store (action -> {mods, key})
let customShortcuts = {
  'home': { mods: ['Ctrl'], key: 'H', label: 'Go to Home' },
  'games': { mods: ['Ctrl'], key: 'G', label: 'Go to Games' },
  'chat': { mods: ['Ctrl'], key: 'M', label: 'Go to Chat' },
  'shop': { mods: ['Ctrl'], key: 'S', label: 'Go to Shop' }
};

// ============================================
// BANNER SYSTEM
// ============================================
const BANNER_COLORS = [
  { id: 'default', name: 'Default', bg: 'linear-gradient(135deg,#3a3a4a 0%,#2a2a3a 100%)', text: 'NOVA', price: 0 },
  { id: 'ocean', name: 'Ocean', bg: 'linear-gradient(135deg,#006994,#00b4db)', text: 'NOVA', price: 10 },
  { id: 'fire', name: 'Fire', bg: 'linear-gradient(135deg,#ff4500,#ff8c00)', text: 'NOVA', price: 10 },
  { id: 'forest', name: 'Forest', bg: 'linear-gradient(135deg,#1a472a,#2e7d32)', text: 'NOVA', price: 10 },
  { id: 'sunset', name: 'Sunset', bg: 'linear-gradient(135deg,#ff6b6b,#feca57)', text: 'NOVA', price: 10 },
  { id: 'galaxy', name: 'Galaxy', bg: 'linear-gradient(135deg,#141e30,#243b55)', text: 'NOVA', price: 10 },
  { id: 'candy', name: 'Candy', bg: 'linear-gradient(135deg,#f953c6,#b91d73)', text: 'NOVA', price: 10 },
  { id: 'neon', name: 'Neon', bg: 'linear-gradient(135deg,#0f0c29,#302b63,#24243e)', text: 'NOVA', price: 10 },
  { id: 'aurora', name: 'Aurora', bg: 'linear-gradient(135deg,#00b09b,#96c93d)', text: 'NOVA', price: 10 },
  { id: 'rose', name: 'Rose Gold', bg: 'linear-gradient(135deg,#b76e79,#e8c4c4)', text: 'NOVA', price: 10 },
  { id: 'midnight', name: 'Midnight', bg: 'linear-gradient(135deg,#0f2027,#203a43,#2c5364)', text: 'NOVA', price: 10 },
  { id: 'lava', name: 'Lava', bg: 'linear-gradient(135deg,#200122,#6f0000)', text: 'NOVA', price: 10 },
  { id: 'custom', name: 'Custom Screenshot', bg: 'linear-gradient(135deg,#ffd700,#ff8c00)', text: 'üì∏', price: 100 }
];

function loadBannerData() {
  const equipped = localStorage.getItem('nova_equipped_banner') || 'default';
  const owned = JSON.parse(localStorage.getItem('nova_owned_banners') || '["default"]');
  return { equipped, owned };
}
function saveBannerData(equipped, owned) {
  localStorage.setItem('nova_equipped_banner', equipped);
  localStorage.setItem('nova_owned_banners', JSON.stringify(owned));
}
function applyBannerToProfile(targetId = 'profile-banner-display') {
  const { equipped, owned } = loadBannerData();
  const banner = BANNER_COLORS.find(b => b.id === equipped) || BANNER_COLORS[0];
  const el = document.getElementById(targetId);
  if (!el) return;
  if (equipped === 'custom') {
    const img = localStorage.getItem('nova_custom_banner_img');
    if (img) {
      el.style.background = 'none';
      el.style.backgroundImage = 'url(' + img + ')';
      el.style.backgroundSize = 'cover';
      el.style.backgroundPosition = 'center';
      el.innerHTML = '';
      return;
    }
  }
  el.style.background = banner.bg;
  el.style.backgroundImage = '';
  el.innerHTML = '<span style="opacity:0.4;font-size:36px;font-weight:900;letter-spacing:8px;color:rgba(255,255,255,0.7);text-shadow:0 2px 8px rgba(0,0,0,0.3)">' + banner.text + '</span>';
}
function equipBanner(id) {
  const { owned } = loadBannerData();
  if (!owned.includes(id)) { showNotification('You don't own this banner!', 'warning'); return; }
  saveBannerData(id, owned);
  applyBannerToProfile();
  showNotification('Banner equipped!', 'success');
  renderBannerShop();
  if (owned.filter(b => b !== 'default').length >= 2) unlockBadge('banner-collector');
}
function purchaseBanner(id) {
  const banner = BANNER_COLORS.find(b => b.id === id);
  if (!banner) return;
  const { equipped, owned } = loadBannerData();
  if (owned.includes(id)) { equipBanner(id); return; }
  if (novaCoins < banner.price) { showNotification('Not enough Nova Coins!', 'error'); return; }
  if (id === 'custom') {
    const input = document.createElement('input');
    input.type = 'file'; input.accept = 'image/*';
    input.onchange = function(e) {
      const file = e.target.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        novaCoins -= banner.price; updateCoinDisplay();
        if (window.myName) db.ref("users/" + window.myName + "/coins").set(novaCoins);
        const newOwned = [...owned, id];
        localStorage.setItem('nova_custom_banner_img', ev.target.result);
        saveBannerData(id, newOwned);
        applyBannerToProfile();
        showNotification('Custom banner uploaded!', 'success');
        renderBannerShop();
      };
      reader.readAsDataURL(file);
    };
    input.click(); return;
  }
  novaCoins -= banner.price; updateCoinDisplay();
  if (window.myName) db.ref("users/" + window.myName + "/coins").set(novaCoins);
  const newOwned = [...owned, id];
  saveBannerData(id, newOwned);
  equipBanner(id);
  showNotification(banner.name + ' banner purchased!', 'success');
}
function renderBannerShop() {
  const scroller = document.getElementById('banner-shop-scroller');
  if (!scroller) return;
  const { equipped, owned } = loadBannerData();
  scroller.innerHTML = '';
  BANNER_COLORS.forEach(banner => {
    const isOwned = owned.includes(banner.id);
    const isEquipped = equipped === banner.id;
    const item = document.createElement('div');
    item.className = 'banner-shop-item';
    item.innerHTML =
      '<div class="banner-preview" style="background:' + banner.bg + '">' +
        '<span style="opacity:0.5;font-weight:900;color:rgba(255,255,255,0.8)">' + banner.text + '</span>' +
      '</div>' +
      '<strong>' + banner.name + '</strong>' +
      (banner.price > 0 ? '<div class="banner-price">ü™ô ' + banner.price + ' NC</div>' : '<div class="banner-price" style="color:var(--success)">FREE</div>') +
      '<button class="buy-btn" ' + (isEquipped ? 'disabled' : '') + ' onclick="purchaseBanner('' + banner.id + '')">' +
        (isEquipped ? '‚úÖ Equipped' : isOwned ? 'üé® Equip' : 'üõí Buy') +
      '</button>';
    scroller.appendChild(item);
  });
}

// ============================================
// SHORTCUTS
// ============================================
function formatShortcutLabel(sc) {
  return sc.mods.join('+') + '+' + sc.key;
}
function renderShortcutKeys() {
  const container = document.getElementById('shortcuts-list');
  if (!container) return;
  container.innerHTML = '';
  Object.entries(customShortcuts).forEach(([action, sc]) => {
    const item = document.createElement('div');
    item.className = 'shortcut-item';
    item.id = 'shortcut-' + action;
    item.onclick = () => startRecordingShortcut(action);
    item.innerHTML =
      '<span class="shortcut-action">' + sc.label + '</span>' +
      '<div class="shortcut-keys">' +
        sc.mods.map(m => '<span class="shortcut-key">' + m + '</span>').join('') +
        '<span class="shortcut-key">' + sc.key + '</span>' +
      '</div>';
    container.appendChild(item);
  });
}
function startRecordingShortcut(action) {
  if (recordingShortcut) stopRecordingShortcut(false);
  recordingShortcut = action;
  const el = document.getElementById('shortcut-' + action);
  if (el) el.innerHTML = '<span class="shortcut-action">' + customShortcuts[action].label + '</span><span class="shortcut-recording">Press new key combo...</span>';
  showNotification('Press a key combo (Ctrl/Alt/Shift + key)', 'warning');
}
function stopRecordingShortcut(save, mods, key) {
  if (!recordingShortcut) return;
  if (save && mods && key) {
    customShortcuts[recordingShortcut] = { ...customShortcuts[recordingShortcut], mods, key };
    showNotification('Shortcut updated: ' + mods.join('+') + '+' + key, 'success');
    saveSettings();
  }
  recordingShortcut = null;
  renderShortcutKeys();
}

// ============================================
// PARTICLES
// ============================================
function createParticles() {
  const container = document.getElementById('particles-container');
  if (!container) return;
  for (let i = 0; i < 30; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.style.cssText = 'left:' + Math.random() * 100 + '%;animation-duration:' + (8 + Math.random() * 15) + 's;animation-delay:' + Math.random() * 10 + 's;--drift:' + (Math.random() * 200 - 100) + 'px;opacity:' + (0.3 + Math.random() * 0.5);
    container.appendChild(p);
  }
}

// ============================================
// TIME
// ============================================
function updateTime() {
  const el = document.getElementById('current-time');
  if (el) el.textContent = new Date().toLocaleTimeString();
}

// ============================================
// NAVIGATION
// ============================================
function showPage(page) {
  document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
  const section = document.getElementById(page);
  if (section) section.classList.add('active');
  const navItem = document.querySelector('.nav a[data-page="' + page + '"]');
  if (navItem) navItem.classList.add('active');
  if (page === 'profile') loadProfile();
  if (page === 'chat') loadFriendList();
  if (page === 'shop') { renderBannerShop(); renderShop(); }
  if (page === 'settings') { loadSettingsUI(); renderShortcutKeys(); }
  if (page === 'badges') renderBadges();
}
document.querySelectorAll('.nav a[data-page]').forEach(a => {
  a.addEventListener('click', () => showPage(a.dataset.page));
});

// ============================================
// COINS
// ============================================
function updateCoinDisplay() {
  document.querySelectorAll('#coin-count,#shop-coin-count').forEach(el => { if (el) el.textContent = novaCoins; });
}
function earnCoin() {
  if (!window.myName) return;
  novaCoins++; updateCoinDisplay();
  db.ref("users/" + window.myName + "/coins").set(novaCoins);
}
function startCoinEarning() { if (!coinInterval) coinInterval = setInterval(earnCoin, 60000); }
function stopCoinEarning() { if (coinInterval) { clearInterval(coinInterval); coinInterval = null; } }

// ============================================
// CTRL+W PREVENTION
// ============================================
window.addEventListener('keydown', function(e) {
  if (e.key === 'w' && (e.ctrlKey || e.metaKey)) {
    e.preventDefault(); e.stopPropagation(); e.stopImmediatePropagation();
    showNotification('Tab close blocked by Nova! üõ°Ô∏è', 'warning');
    return false;
  }
  // Custom shortcuts
  if (recordingShortcut) {
    if (!e.ctrlKey && !e.altKey && !e.shiftKey) return;
    const mods = [];
    if (e.ctrlKey) mods.push('Ctrl');
    if (e.altKey) mods.push('Alt');
    if (e.shiftKey) mods.push('Shift');
    const key = e.key.toUpperCase();
    if (!['CONTROL','ALT','SHIFT','META'].includes(key)) {
      e.preventDefault();
      stopRecordingShortcut(true, mods, key);
    }
    return;
  }
  // Execute shortcuts
  Object.entries(customShortcuts).forEach(([action, sc]) => {
    const ctrl = sc.mods.includes('Ctrl'); const alt = sc.mods.includes('Alt'); const shift = sc.mods.includes('Shift');
    if (e.ctrlKey === ctrl && e.altKey === alt && e.shiftKey === shift && e.key.toUpperCase() === sc.key) {
      e.preventDefault(); showPage(action);
    }
  });
}, true);

// ============================================
// WATER GAME
// ============================================
function openWaterGame() {
  const url = 'https://cgxlyxnlynjpbmdiywnrc3rhcnrtewvkdwnhdglvbml0d2fzc29sawdtd2.familyguy.in/signin.html';
  const w = window.open('about:blank', '_blank');
  if (w) w.location.href = url;
}

// ============================================
// SETTINGS
// ============================================
function loadSettings() {
  const saved = localStorage.getItem('nova_settings');
  if (saved) {
    const parsed = JSON.parse(saved);
    settings = { ...settings, ...parsed };
    if (parsed.shortcuts) customShortcuts = { ...customShortcuts, ...parsed.shortcuts };
  }
  applySettings();
}
function saveSettings() {
  localStorage.setItem('nova_settings', JSON.stringify({ ...settings, shortcuts: customShortcuts }));
}
function applySettings() {
  document.body.classList.toggle('light-mode', !!settings.lightMode);
  document.body.classList.toggle('performance-mode', !!settings.performanceMode);
  const bg = localStorage.getItem('nova_custom_bg');
  if (bg) { document.getElementById('custom-bg').style.backgroundImage = 'url(' + bg + ')'; document.getElementById('custom-bg').classList.add('active'); }
}
function loadSettingsUI() {
  document.getElementById('light-toggle')?.classList.toggle('active', !!settings.lightMode);
  document.getElementById('perf-toggle')?.classList.toggle('active', !!settings.performanceMode);
  document.getElementById('sound-toggle')?.classList.toggle('active', !!settings.soundEnabled);
}
function toggleSetting(key) {
  settings[key] = !settings[key]; saveSettings(); applySettings(); loadSettingsUI();
  showNotification(key + ' ' + (settings[key] ? 'enabled' : 'disabled'), 'success');
}
function uploadBackground(event) {
  const file = event.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    localStorage.setItem('nova_custom_bg', e.target.result);
    document.getElementById('custom-bg').style.backgroundImage = 'url(' + e.target.result + ')';
    document.getElementById('custom-bg').classList.add('active');
    showNotification('Background updated!', 'success');
  };
  reader.readAsDataURL(file);
}
function removeBackground() {
  localStorage.removeItem('nova_custom_bg');
  document.getElementById('custom-bg').classList.remove('active');
  document.getElementById('custom-bg').style.backgroundImage = '';
  showNotification('Background removed', 'success');
}

// ============================================
// AUTH
// ============================================
function clearAuthStatus() {
  ['register-status','login-status'].forEach(id => { const el = document.getElementById(id); if (el) { el.className = 'auth-status-msg'; el.textContent = ''; } });
}
function showAuthStatus(id, msg, type) {
  const el = document.getElementById(id); if (!el) return;
  el.textContent = msg; el.className = 'auth-status-msg show ' + type;
}
function registerUser() {
  const user = document.getElementById('reg-username').value.trim();
  const pass = document.getElementById('reg-password').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  if (!user || !pass) { showAuthStatus('register-status', 'Username and password required.', 'error'); return; }
  db.ref("users/" + user).once("value", snap => {
    if (snap.exists()) { showAuthStatus('register-status', 'Username already taken.', 'error'); return; }
    db.ref("users/" + user).set({ password: pass, coins: 0, email: email || '', status: 'online', pfp: '' });
    showAuthStatus('register-status', 'Account created! Logging in...', 'success');
    setTimeout(() => { document.getElementById('login-username').value = user; document.getElementById('login-password').value = pass; loginUser(); }, 800);
  });
}
function loginUser() {
  const user = document.getElementById('login-username').value.trim();
  const pass = document.getElementById('login-password').value.trim();
  if (!user || !pass) { showAuthStatus('login-status', 'Username and password required.', 'error'); return; }
  db.ref("users/" + user).once("value", snap => {
    if (!snap.exists()) { showAuthStatus('login-status', 'User not found.', 'error'); return; }
    const data = snap.val();
    if (data.password !== pass) { showAuthStatus('login-status', 'Incorrect password.', 'error'); return; }
    window.myName = user;
    novaCoins = data.coins || 0;
    purchasedGames = Object.keys(data.purchasedGames || {});
    purchasedBgs = Object.keys(data.purchasedBgs || {});
    updateCoinDisplay(); updateProfileDisplay();
    localStorage.setItem("nexus_user", JSON.stringify({ name: user, pass }));
    db.ref("users/" + user + "/status").set("online");
    showAuthStatus('login-status', 'Welcome back, ' + user + '!', 'success');
    startCoinEarning(); checkAdminAccess(); loadFriendList();
    showNotification('Welcome, ' + user + '! üéâ', 'success');
    unlockBadge('early-adopter');
  });
}
function checkAdminAccess() {
  const ADMINS = ['admin', 'nova_admin', 'moderator'];
  const el = document.getElementById('admin-nav');
  if (el) el.style.display = (window.myName && ADMINS.includes(window.myName.toLowerCase())) ? 'flex' : 'none';
}
function autoLogin() {
  const saved = localStorage.getItem("nexus_user");
  if (!saved) return;
  try {
    const { name, pass } = JSON.parse(saved);
    document.getElementById('login-username').value = name;
    document.getElementById('login-password').value = pass;
    loginUser();
  } catch(e) { localStorage.removeItem("nexus_user"); }
}
function updateStatus() {
  if (!window.myName) { showNotification('Please login first', 'warning'); return; }
  const val = document.getElementById('status-input').value.trim();
  if (!val) return;
  db.ref("users/" + window.myName + "/customStatus").set(val);
  showNotification('Status updated!', 'success');
}

// ============================================
// NOTIFICATIONS
// ============================================
let notifTimer = null;
function showNotification(text, type = 'success') {
  const n = document.getElementById('notification');
  const icons = { success: '‚úÖ', warning: '‚ö†Ô∏è', error: '‚ùå', info: '‚ÑπÔ∏è' };
  document.getElementById('notif-icon').textContent = icons[type] || '‚úÖ';
  document.getElementById('notif-text').textContent = text;
  n.className = 'notification show ' + type;
  if (notifTimer) clearTimeout(notifTimer);
  notifTimer = setTimeout(() => n.classList.remove('show'), 3000);
}

// ============================================
// MODAL
// ============================================
function showModal(icon, title, text) {
  document.getElementById('modal-icon').textContent = icon;
  document.getElementById('modal-title').textContent = title;
  document.getElementById('modal-text').textContent = text;
  document.getElementById('reward-modal').classList.add('show');
}
function closeModal() { document.getElementById('reward-modal').classList.remove('show'); }

// ============================================
// MEDIA PLAYER
// ============================================
function openPlayer(url, title) {
  document.getElementById('player-title').textContent = title || 'Now Playing';
  document.getElementById('player-frame').src = url;
  document.getElementById('player').classList.add('open');
}
function closePlayer() {
  document.getElementById('player').classList.remove('open');
  document.getElementById('player-frame').src = '';
}

// ============================================
// GRID MODE
// ============================================
function toggleGridMode() {
  document.body.classList.toggle('grid-mode');
  showNotification('View mode toggled', 'success');
}

// ============================================
// BADGE SYSTEM
// ============================================
const BADGES = [
  { id: 'early-adopter', icon: 'üåü', name: 'Early Adopter', desc: 'Login to Nova', type: 'auto' },
  { id: 'first-friend', icon: 'ü§ù', name: 'First Friend', desc: 'Accept a friend request', type: 'auto' },
  { id: 'profile-editor', icon: 'üé®', name: 'Profile Editor', desc: 'Upload a profile picture', type: 'auto' },
  { id: 'banner-collector', icon: 'üñºÔ∏è', name: 'Banner Collector', desc: 'Own 3+ banners', type: 'auto' },
  { id: 'big-spender', icon: 'üí∏', name: 'Big Spender', desc: 'Purchase something from the shop', type: 'auto' },
  { id: 'chatter', icon: 'üí¨', name: 'Chatter', desc: 'Send 10 messages', type: 'auto' },
  { id: 'vip', icon: 'üëë', name: 'VIP', desc: 'Enter the VIP code', type: 'code' },
  { id: 'nova-og', icon: 'üöÄ', name: 'Nova OG', desc: 'Enter the OG code', type: 'code' },
  { id: 'secret-1', icon: 'üîÆ', name: 'Mystic', desc: 'Discover the secret', type: 'code' }
];
const BADGE_CODES = { 'NOVA-VIP-2024': 'vip', 'ORIGINAL-NOVA': 'nova-og', 'MYSTIC-SECRET': 'secret-1' };
let unlockedBadges = JSON.parse(localStorage.getItem('nova_badges') || '[]');

function unlockBadge(id) {
  if (unlockedBadges.includes(id)) return;
  unlockedBadges.push(id); localStorage.setItem('nova_badges', JSON.stringify(unlockedBadges));
  const badge = BADGES.find(b => b.id === id);
  if (badge) showModal(badge.icon, 'Badge Unlocked!', badge.name + ' - ' + badge.desc);
  if (window.myName) db.ref("users/" + window.myName + "/badges/" + id).set(true);
  renderBadges();
}
function renderBadges() {
  const container = document.getElementById('badge-container'); if (!container) return;
  container.innerHTML = '';
  BADGES.forEach(badge => {
    const locked = !unlockedBadges.includes(badge.id);
    const div = document.createElement('div');
    div.className = 'badge ' + (locked ? (badge.type === 'code' ? 'locked code-required' : 'locked') : 'unlocked');
    div.innerHTML = '<div class="badge-icon">' + badge.icon + '</div><div class="badge-name">' + badge.name + '</div><div class="badge-desc">' + badge.desc + '</div><div class="badge-tag ' + badge.type + '">' + badge.type.toUpperCase() + '</div>';
    if (badge.type === 'code' && locked) {
      div.innerHTML += '<div class="badge-code-area" id="code-area-' + badge.id + '"><input class="badge-code-input" placeholder="Enter code..." id="code-input-' + badge.id + '"><button class="badge-code-submit" onclick="tryBadgeCode('' + badge.id + '')">Submit</button></div>';
      div.onclick = () => document.getElementById('code-area-' + badge.id)?.classList.toggle('show');
    }
    container.appendChild(div);
  });
}
function tryBadgeCode(badgeId) {
  const val = document.getElementById('code-input-' + badgeId)?.value?.trim().toUpperCase();
  if (!val) return;
  if (BADGE_CODES[val] === badgeId) { unlockBadge(badgeId); showNotification('Code accepted! Badge unlocked!', 'success'); }
  else showNotification('Invalid code', 'error');
}

// ============================================
// GAMES DATA
// ============================================
const GAMES = [
  { id: 'slope', name: 'Slope', thumb: 'https://via.placeholder.com/260x180/1a1a2e/5b8def?text=Slope', url: 'https://slope-game.github.io/', cat: 'Arcade', premium: false },
  { id: 'snake', name: 'Snake', thumb: 'https://via.placeholder.com/260x180/1a2e1a/00ff88?text=Snake', url: 'https://www.google.com/fbx?fbx=snake_arcade', cat: 'Classic', premium: false },
  { id: 'tetris', name: 'Tetris', thumb: 'https://via.placeholder.com/260x180/2e1a1a/ff4444?text=Tetris', url: 'https://tetris.com/play-tetris', cat: 'Classic', premium: false },
  { id: '2048', name: '2048', thumb: 'https://via.placeholder.com/260x180/2e2e1a/ffd700?text=2048', url: 'https://play2048.co/', cat: 'Puzzle', premium: false },
  { id: 'flappy', name: 'Flappy Bird', thumb: 'https://via.placeholder.com/260x180/1a2e2e/00b4db?text=Flappy', url: 'https://flappybird.io/', cat: 'Arcade', premium: false },
  { id: 'chess', name: 'Chess', thumb: 'https://via.placeholder.com/260x180/2e1a2e/b76e79?text=Chess', url: 'https://www.chess.com/play/online', cat: 'Strategy', premium: true, price: 15 },
  { id: 'minecraft', name: 'Minecraft Classic', thumb: 'https://via.placeholder.com/260x180/1a2e1a/8bc34a?text=Minecraft', url: 'https://classic.minecraft.net/', cat: 'Adventure', premium: true, price: 20 }
];
const MOVIES = [
  { id: 'inception', name: 'Inception', thumb: 'https://via.placeholder.com/260x180/0a0a1a/5b8def?text=Inception', url: 'https://www.youtube.com/embed/YoHD9XEInc0', cat: 'Sci-Fi' },
  { id: 'interstellar', name: 'Interstellar', thumb: 'https://via.placeholder.com/260x180/1a0a0a/ff8c00?text=Interstellar', url: 'https://www.youtube.com/embed/zSWdZVtXT7E', cat: 'Sci-Fi' },
  { id: 'avengers', name: 'Avengers', thumb: 'https://via.placeholder.com/260x180/1a0a0a/ff4444?text=Avengers', url: 'https://www.youtube.com/embed/hA6hldpSTF8', cat: 'Action' }
];
const SHOWS = [
  { id: 'bb', name: 'Breaking Bad', thumb: 'https://via.placeholder.com/260x180/0a1a0a/00ff88?text=Breaking+Bad', url: 'https://www.youtube.com/embed/HhesaQXLuRY', cat: 'Drama' },
  { id: 'got', name: 'Game of Thrones', thumb: 'https://via.placeholder.com/260x180/1a1a0a/ffd700?text=Game+of+Thrones', url: 'https://www.youtube.com/embed/bjqUs8K1WFQ', cat: 'Fantasy' }
];
const BG_SHOP = [
  { id: 'space', name: 'Deep Space', url: 'https://images.unsplash.com/photo-1538370965046-79c0d6907d47?w=1920', price: 20 },
  { id: 'city', name: 'City Lights', url: 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=1920', price: 20 },
  { id: 'forest', name: 'Forest', url: 'https://images.unsplash.com/photo-1448375240586-882707db888b?w=1920', price: 20 }
];

function renderGames(list, scroller) {
  const el = document.getElementById(scroller); if (!el) return;
  el.innerHTML = '';
  (list || GAMES).forEach(g => {
    const owned = purchasedGames.includes(g.id) || !g.premium;
    const fav = favorites['game-' + g.id];
    const div = document.createElement('div'); div.className = 'game';
    div.innerHTML = '<button class="favorite-btn ' + (fav ? 'active' : '') + '" onclick="event.stopPropagation();toggleFavorite('game-'+'' + g.id + '',this)">‚≠ê</button>' +
      '<img class="thumb" src="' + g.thumb + '" loading="lazy">' +
      '<strong>' + g.name + '</strong>' +
      '<span style="font-size:12px;color:var(--muted)">' + g.cat + (g.premium ? ' ¬∑ Premium' : '') + '</span>' +
      '<button class="game-btn" onclick="' + (owned ? 'openPlayer('' + g.url + '','' + g.name + '')' : 'buyGame('' + g.id + '',' + g.price + ',this)') + '">' +
        (owned ? '‚ñ∂ Play' : 'ü™ô ' + g.price + ' NC') + '</button>';
    el.appendChild(div);
  });
}
function filterGames() {
  const q = document.getElementById('game-search')?.value.toLowerCase();
  renderGames(q ? GAMES.filter(g => g.name.toLowerCase().includes(q) || g.cat.toLowerCase().includes(q)), 'games-scroller');
}
function filterMovies() {
  const q = document.getElementById('movie-search')?.value.toLowerCase();
  renderMovies(q ? MOVIES.filter(m => m.name.toLowerCase().includes(q) || m.cat.toLowerCase().includes(q)), 'movies-scroller');
  renderShows(q ? SHOWS.filter(s => s.name.toLowerCase().includes(q) || s.cat.toLowerCase().includes(q)), 'shows-scroller');
}
function renderMovies(list, scroller) {
  const el = document.getElementById(scroller); if (!el) return; el.innerHTML = '';
  (list || MOVIES).forEach(m => {
    const div = document.createElement('div'); div.className = 'movie';
    div.innerHTML = '<img class="thumb" src="' + m.thumb + '" loading="lazy"><strong>' + m.name + '</strong><span style="font-size:12px;color:var(--muted)">' + m.cat + '</span><button class="movie-btn" onclick="openPlayer('' + m.url + '','' + m.name + '')">‚ñ∂ Watch</button>';
    el.appendChild(div);
  });
}
function renderShows(list, scroller) {
  const el = document.getElementById(scroller); if (!el) return; el.innerHTML = '';
  (list || SHOWS).forEach(s => {
    const div = document.createElement('div'); div.className = 'tvshow';
    div.innerHTML = '<img class="thumb" src="' + s.thumb + '" loading="lazy"><strong>' + s.name + '</strong><span style="font-size:12px;color:var(--muted)">' + s.cat + '</span><button class="tvshow-btn" onclick="openPlayer('' + s.url + '','' + s.name + '')">‚ñ∂ Watch</button>';
    el.appendChild(div);
  });
}
function clearSearch(inputId, fn) { document.getElementById(inputId).value = ''; fn(); }

function buyGame(id, price, btn) {
  if (novaCoins < price) { showNotification('Not enough coins!', 'error'); return; }
  novaCoins -= price; updateCoinDisplay();
  purchasedGames.push(id);
  if (window.myName) {
    db.ref("users/" + window.myName + "/coins").set(novaCoins);
    db.ref("users/" + window.myName + "/purchasedGames/" + id).set(true);
  }
  btn.textContent = '‚ñ∂ Play';
  btn.onclick = function() { const g = GAMES.find(g => g.id === id); if (g) openPlayer(g.url, g.name); };
  showNotification('Game purchased!', 'success'); unlockBadge('big-spender');
}
function renderShop() {
  const bgEl = document.getElementById('bg-shop-scroller');
  if (bgEl) {
    bgEl.innerHTML = '';
    BG_SHOP.forEach(bg => {
      const owned = purchasedBgs.includes(bg.id);
      const div = document.createElement('div'); div.className = 'shop-item';
      div.innerHTML = '<img class="thumb" src="' + bg.url + '" loading="lazy"><strong>' + bg.name + '</strong><div class="price"><div class="coin-icon">ü™ô</div>' + bg.price + ' NC</div><button class="buy-btn" ' + (owned ? 'disabled' : '') + ' onclick="buyBg('' + bg.id + '',' + bg.price + ','' + bg.url + '',this)">' + (owned ? '‚úÖ Owned' : 'üõí Buy') + '</button>';
      bgEl.appendChild(div);
    });
  }
  const gameEl = document.getElementById('shop-games-scroller');
  if (gameEl) {
    gameEl.innerHTML = '';
    GAMES.filter(g => g.premium).forEach(g => {
      const owned = purchasedGames.includes(g.id);
      const div = document.createElement('div'); div.className = 'shop-item';
      div.innerHTML = '<img class="thumb" src="' + g.thumb + '" loading="lazy"><strong>' + g.name + '</strong><div class="price"><div class="coin-icon">ü™ô</div>' + g.price + ' NC</div><button class="buy-btn" ' + (owned ? 'disabled' : '') + ' onclick="buyGame('' + g.id + '',' + g.price + ',this)">' + (owned ? '‚úÖ Owned' : 'üõí Buy') + '</button>';
      gameEl.appendChild(div);
    });
  }
}
function buyBg(id, price, url, btn) {
  if (novaCoins < price) { showNotification('Not enough coins!', 'error'); return; }
  novaCoins -= price; updateCoinDisplay(); purchasedBgs.push(id);
  if (window.myName) { db.ref("users/" + window.myName + "/coins").set(novaCoins); db.ref("users/" + window.myName + "/purchasedBgs/" + id).set(true); }
  localStorage.setItem('nova_custom_bg', url);
  document.getElementById('custom-bg').style.backgroundImage = 'url(' + url + ')';
  document.getElementById('custom-bg').classList.add('active');
  btn.textContent = '‚úÖ Owned'; btn.disabled = true;
  showNotification('Background applied!', 'success'); unlockBadge('big-spender');
}

// ============================================
// FAVORITES
// ============================================
function toggleFavorite(key, btn) {
  favorites[key] = !favorites[key]; btn.classList.toggle('active', favorites[key]);
  localStorage.setItem('nova_favorites', JSON.stringify(favorites));
  showNotification(favorites[key] ? 'Added to favorites!' : 'Removed from favorites', favorites[key] ? 'success' : 'warning');
}

// ============================================
// CHAT
// ============================================
let chatListeners = {};
function loadFriendList() {
  if (!window.myName) { document.getElementById('friend-list').innerHTML = '<p class="empty" style="padding:12px">Please login to chat</p>'; return; }
  db.ref("users/" + window.myName + "/friends").on("value", snap => {
    const fl = document.getElementById('friend-list'); if (!fl) return;
    fl.innerHTML = '';
    if (!snap.exists() || snap.numChildren() === 0) { fl.innerHTML = '<p class="empty" style="padding:12px">No friends yet</p>'; return; }
    snap.forEach(child => {
      const friend = child.key;
      const entry = document.createElement('div'); entry.className = 'chat-entry'; entry.id = 'chat-entry-' + friend;
      entry.onclick = () => openChat(friend);
      entry.innerHTML = '<div class="chat-entry-avatar" id="entry-avatar-' + friend + '"><div class="online-dot" id="dot-' + friend + '" style="display:none"></div>?</div>' +
        '<div class="chat-entry-info"><div class="chat-entry-name">' + friend + '</div><div class="chat-entry-preview" id="preview-' + friend + '">Click to chat</div></div>' +
        '<div class="chat-entry-meta"><span class="chat-entry-time" id="time-' + friend + '"></span><button class="chat-remove-btn" onclick="event.stopPropagation();removeFriend('' + friend + '')">√ó</button></div>';
      fl.appendChild(entry);
      db.ref("users/" + friend + "/pfp").on("value", s => { const av = document.getElementById('entry-avatar-' + friend); if (av) av.innerHTML = s.val() ? '<img src="' + s.val() + '">' : friend[0].toUpperCase(); });
      db.ref("users/" + friend + "/status").on("value", s => { const dot = document.getElementById('dot-' + friend); if (dot) dot.style.display = s.val() === 'online' ? 'block' : 'none'; });
    });
    updateOnlineStats();
  });
}
function removeFriend(friend) {
  db.ref("users/" + window.myName + "/friends/" + friend).remove();
  db.ref("users/" + friend + "/friends/" + window.myName).remove();
  if (currentChatPartner === friend) { currentChatPartner = null; document.getElementById('chat-empty').style.display = 'flex'; document.getElementById('chat-active').style.display = 'none'; }
  showNotification(friend + ' removed', 'warning');
}
function filterChatList() {
  const q = document.getElementById('chat-search-input')?.value.toLowerCase();
  document.querySelectorAll('#friend-list .chat-entry').forEach(e => { e.style.display = (!q || e.textContent.toLowerCase().includes(q)) ? '' : 'none'; });
}
function openChat(friend) {
  currentChatPartner = friend;
  document.querySelectorAll('.chat-entry').forEach(e => e.classList.remove('active-chat'));
  document.getElementById('chat-entry-' + friend)?.classList.add('active-chat');
  document.getElementById('chat-empty').style.display = 'none';
  document.getElementById('chat-active').style.display = 'flex';
  document.getElementById('chat-partner-name').textContent = friend;
  document.getElementById('chat-messages').innerHTML = '';
  db.ref("users/" + friend + "/pfp").once("value", s => {
    const av = document.getElementById('chat-partner-avatar');
    if (av) av.innerHTML = s.val() ? '<img src="' + s.val() + '">' : friend[0].toUpperCase();
  });
  const chatKey = [window.myName, friend].sort().join('_');
  if (chatListeners[chatKey]) db.ref("messages/" + chatKey).off();
  db.ref("messages/" + chatKey).limitToLast(100).on("child_added", snap => {
    appendMessage(snap.val()); scrollChat();
    document.getElementById('preview-' + friend) && (document.getElementById('preview-' + friend).textContent = snap.val().text?.slice(0, 30) || '');
  });
  chatListeners[chatKey] = true;
}
function appendMessage(msg) {
  const container = document.getElementById('chat-messages'); if (!container) return;
  const isMe = msg.sender === window.myName;
  const div = document.createElement('div'); div.className = 'nova-msg' + (isMe ? ' is-me' : '');
  const time = msg.timestamp ? new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '';
  div.innerHTML = '<div class="nova-msg-avatar" onclick="viewUserProfile('' + msg.sender + '')">' + (msg.sender || '?')[0].toUpperCase() + '</div>' +
    '<div class="nova-msg-body"><div class="nova-msg-header"><span class="nova-msg-sender">' + msg.sender + '</span><span class="nova-msg-time">' + time + '</span></div>' +
    '<div class="nova-msg-bubble">' + escapeHtml(msg.text || '') + '</div></div>';
  container.appendChild(div);
}
function escapeHtml(str) { return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function scrollChat() { const c = document.getElementById('chat-messages'); if (c) c.scrollTop = c.scrollHeight; }
function sendMessage() {
  if (!window.myName || !currentChatPartner) { showNotification('Please select a chat', 'warning'); return; }
  const input = document.getElementById('chat-input'); const text = input.value.trim(); if (!text) return;
  const chatKey = [window.myName, currentChatPartner].sort().join('_');
  db.ref("messages/" + chatKey).push({ sender: window.myName, text, timestamp: Date.now() });
  input.value = ''; autoResize(input);
  messagesSentCount++; document.getElementById('stat-sent').textContent = messagesSentCount;
  if (messagesSentCount >= 10) unlockBadge('chatter');
}
function handleChatKey(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } }
function autoResize(el) { el.style.height = 'auto'; el.style.height = Math.min(el.scrollHeight, 100) + 'px'; }
function clearCurrentChat() {
  if (!currentChatPartner || !window.myName) return;
  const chatKey = [window.myName, currentChatPartner].sort().join('_');
  db.ref("messages/" + chatKey).remove();
  document.getElementById('chat-messages').innerHTML = '';
  showNotification('Chat cleared', 'success');
}
function switchChatPanel(panel) {
  chatPanel = panel;
  document.querySelectorAll('.rail-icon').forEach((ic, i) => ic.classList.toggle('active', i === (panel === 'friends' ? 0 : 1)));
  document.getElementById('chat-panel-title').textContent = panel.toUpperCase();
}
function openGlobalChat() { showNotification('Global chat coming soon!', 'info'); }
function promptAddFriend() {
  const name = prompt('Enter username to add:');
  if (!name || !window.myName) return;
  db.ref("users/" + name).once("value", snap => {
    if (!snap.exists()) { showNotification('User not found', 'error'); return; }
    db.ref("requests/" + name + "/" + window.myName).set(true);
    showNotification('Friend request sent to ' + name + '!', 'success');
  });
}
function openChatPartnerProfile() { if (currentChatPartner) viewUserProfile(currentChatPartner); }
function pickEmoji() {
  const emojis = ['üòä','üòÇ','‚ù§Ô∏è','üëç','üî•','‚ú®','üéâ','ü§î','üòé','üíØ'];
  const e = emojis[Math.floor(Math.random() * emojis.length)];
  const input = document.getElementById('chat-input'); input.value += e; input.focus();
}
function updateOnlineStats() {
  if (!window.myName) return;
  db.ref("users/" + window.myName + "/friends").once("value", snap => {
    let online = 0;
    const promises = []; const names = [];
    snap.forEach(c => { names.push(c.key); promises.push(db.ref("users/" + c.key + "/status").once("value")); });
    Promise.all(promises).then(snaps => {
      const membersEl = document.getElementById('online-members-list'); if (membersEl) membersEl.innerHTML = '';
      snaps.forEach((s, i) => {
        if (s.val() === 'online') {
          online++;
          if (membersEl) {
            const m = document.createElement('div'); m.className = 'member-card';
            m.innerHTML = '<div class="member-avatar">' + names[i][0].toUpperCase() + '</div><div><div class="member-name">' + names[i] + '</div><div class="member-status">Online</div></div>';
            m.onclick = () => viewUserProfile(names[i]);
            membersEl.appendChild(m);
          }
        }
      });
      document.getElementById('stat-online').textContent = online;
    });
  });
}

// ============================================
// VIEW USER PROFILE
// ============================================
function viewUserProfile(username, returnPage) {
  viewedUserName = username;
  document.getElementById('view-profile-section').style.display = 'block';
  document.getElementById('view-username').textContent = username;
  document.getElementById('view-status').textContent = 'Loading...';
  document.getElementById('view-pic').src = 'https://via.placeholder.com/100';
  showPage('profile');
  db.ref("users/" + username).once("value", snap => {
    if (!snap.exists()) return;
    const data = snap.val();
    if (data.pfp) document.getElementById('view-pic').src = data.pfp;
    document.getElementById('view-status').textContent = data.status || 'Offline';
    // Try to load their banner
    const bannerEl = document.getElementById('view-banner-display');
    if (bannerEl) bannerEl.innerHTML = '<span style="opacity:0.3;font-size:36px;font-weight:900;letter-spacing:8px">NOVA</span>';
  });
}
function closeViewProfile() {
  document.getElementById('view-profile-section').style.display = 'none';
  viewedUserName = null;
}

// ============================================
// ADMIN
// ============================================
function adminGiveCoins() {
  const user = document.getElementById('admin-target-user').value.trim();
  const amount = parseInt(document.getElementById('admin-coin-amount').value);
  if (!user || isNaN(amount)) { setAdminFb('admin-coins-fb', 'Invalid input', 'err'); return; }
  db.ref("users/" + user + "/coins").once("value", snap => {
    const current = snap.val() || 0;
    db.ref("users/" + user + "/coins").set(current + amount);
    setAdminFb('admin-coins-fb', '‚úÖ Gave ' + amount + ' coins to ' + user, 'ok');
  });
}
function adminRemoveCoins() {
  const user = document.getElementById('admin-target-user').value.trim();
  const amount = parseInt(document.getElementById('admin-coin-amount').value);
  if (!user || isNaN(amount)) { setAdminFb('admin-coins-fb', 'Invalid input', 'err'); return; }
  db.ref("users/" + user + "/coins").once("value", snap => {
    const current = snap.val() || 0;
    db.ref("users/" + user + "/coins").set(Math.max(0, current - amount));
    setAdminFb('admin-coins-fb', '‚úÖ Removed ' + amount + ' coins from ' + user, 'ok');
  });
}
function adminGrantBadge() {
  const user = document.getElementById('admin-badge-user').value.trim();
  const badge = document.getElementById('admin-badge-id').value.trim();
  if (!user || !badge) { setAdminFb('admin-badge-fb', 'Invalid input', 'err'); return; }
  db.ref("users/" + user + "/badges/" + badge).set(true);
  setAdminFb('admin-badge-fb', '‚úÖ Granted badge ' + badge + ' to ' + user, 'ok');
}
function adminBroadcast() {
  const msg = document.getElementById('admin-broadcast-msg').value.trim();
  if (!msg) { setAdminFb('admin-broadcast-fb', 'No message', 'err'); return; }
  db.ref("broadcast").push({ from: window.myName, text: msg, timestamp: Date.now() });
  setAdminFb('admin-broadcast-fb', '‚úÖ Broadcast sent!', 'ok');
}
function adminLookup() {
  const user = document.getElementById('admin-lookup-user').value.trim();
  if (!user) { setAdminFb('admin-lookup-fb', 'Enter a username', 'err'); return; }
  db.ref("users/" + user).once("value", snap => {
    if (!snap.exists()) { setAdminFb('admin-lookup-fb', 'User not found', 'err'); return; }
    const d = snap.val();
    setAdminFb('admin-lookup-fb', 'Coins: ' + (d.coins || 0) + '\nStatus: ' + (d.status || 'offline') + '\nEmail: ' + (d.email || 'none'), 'ok');
  });
}
function setAdminFb(id, msg, cls) { const el = document.getElementById(id); if (el) { el.textContent = msg; el.className = 'admin-feedback ' + cls; } }

// ============================================
// BROADCAST LISTENER
// ============================================
db.ref("broadcast").limitToLast(1).on("child_added", snap => {
  const d = snap.val(); if (!d) return;
  if (Date.now() - d.timestamp < 10000) showNotification('üì¢ ' + d.from + ': ' + d.text, 'info');
});

// ============================================
// INIT
// ============================================
document.addEventListener('DOMContentLoaded', () => {
  createParticles();
  loadSettings();
  renderGames(null, 'games-scroller');
  renderGames(GAMES.slice(0, 5), 'home-games-scroller');
  renderMovies(null, 'movies-scroller');
  renderShows(null, 'shows-scroller');
  renderBadges();
  favorites = JSON.parse(localStorage.getItem('nova_favorites') || '{}');
  updateCoinDisplay();
  setInterval(updateTime, 1000); updateTime();
  autoLogin();
  
  // Auth display
  setInterval(() => {
    const el = document.getElementById('auth-display');
    if (el) el.textContent = window.myName || 'Guest';
  }, 2000);
});

function messageUser() {
  if (!window.myName) { showNotification('Please login first', 'warning'); return; }
  if (!viewedUserName) return;
  showPage('chat');
  setTimeout(() => {
    let found = false;
    document.querySelectorAll('#friend-list .chat-entry').forEach(item => { if (item.textContent.includes(viewedUserName)) { item.click(); found = true; } });
    if (!found) showNotification('You need to be friends to send messages!', 'warning');
  }, 500);
}
function logoutUser() {
  if (window.myName) db.ref("users/" + window.myName + "/status").set("offline");
  stopCoinEarning(); window.myName = null; localStorage.removeItem("nexus_user");
  novaCoins = 0; purchasedGames = []; updateCoinDisplay(); updateProfileDisplay();
  clearAuthStatus(); checkAdminAccess();
  showNotification('Logged out', 'success');
}
function updateProfileDisplay() {
  if (window.myName) {
    document.getElementById('profile-username').textContent = window.myName;
    document.getElementById('profile-status').textContent = 'Online';
    db.ref("users/" + window.myName + "/pfp").on("value", (snap) => { document.getElementById('profile-pic').src = snap.val() || "https://via.placeholder.com/120"; });
    db.ref("users/" + window.myName + "/customStatus").on("value", (snap) => { document.getElementById('status-input').placeholder = snap.val() || "What's on your mind?"; });
  } else {
    document.getElementById('profile-username').textContent = 'Guest';
    document.getElementById('profile-status').textContent = 'Offline';
    document.getElementById('profile-pic').src = 'https://via.placeholder.com/120';
  }
}
function uploadProfilePic(event) {
  if (!window.myName) { showNotification('Please login first', 'warning'); return; }
  const file = event.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    db.ref("users/" + window.myName + "/pfp").set(e.target.result);
    document.getElementById('profile-pic').src = e.target.result;
    showNotification('Profile picture updated!', 'success'); unlockBadge('profile-editor');
  };
  reader.readAsDataURL(file);
}
function loadProfile() {
  if (!window.myName) return;
  applyBannerToProfile();
  db.ref("requests/" + window.myName).on("value", (snap) => {
    const requestsList = document.getElementById('requests-list'); requestsList.innerHTML = '';
    if (!snap.exists() || snap.numChildren() === 0) { requestsList.innerHTML = '<p class="empty">No pending requests</p>'; return; }
    snap.forEach((req) => {
      const requester = req.key; const div = document.createElement('div'); div.className = 'request-item';
      div.innerHTML = '<div class="request-user" style="cursor:pointer;" onclick="viewUserProfile(\'' + requester + '\')"><img class="avatar-circle" src="https://via.placeholder.com/34" id="req-pfp-' + requester + '"><span>' + requester + '</span></div><div class="request-actions"><button class="accept-btn" onclick="event.stopPropagation(); acceptRequest(\'' + requester + '\')">Accept</button><button class="decline-btn" onclick="event.stopPropagation(); declineRequest(\'' + requester + '\')">Decline</button></div>';
      requestsList.appendChild(div);
      db.ref("users/" + requester + "/pfp").once("value", (pSnap) => { const img = document.getElementById('req-pfp-' + requester); if (img && pSnap.val()) img.src = pSnap.val(); });
    });
  });
}
function acceptRequest(requester) {
  db.ref("users/" + window.myName + "/friends/" + requester).set(true);
  db.ref("users/" + requester + "/friends/" + window.myName).set(true);
  db.ref("requests/" + window.myName + "/" + requester).remove();
  showNotification('You are now friends with ' + requester + '!', 'success'); unlockBadge('first-friend');
}
function declineRequest(requester) { db.ref("requests/" + window.myName + "/" + requester).remove(); showNotification('Request declined', 'success'); }
function sendFriendRequestToUser() {
  if (!window.myName) { showNotification('Please login first', 'warning'); return; }
  if (!viewedUserName) return;
  db.ref("requests/" + viewedUserName + "/" + window.myName).set(true);
  showNotification('Friend request sent to ' + viewedUserName + '!', 'success');
}
</script>
</body>
</html>
